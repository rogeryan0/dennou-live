<?xml version="1.0" ?>
<!DOCTYPE html 
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>getting_started.rd</title>
</head>
<body>
<h1><a name="label-0" id="label-0">GPhys, GGraphチュートリアル (その1)</a></h1><!-- RDLabel: "GPhys, GGraphチュートリアル (その1)" -->
<h2><a name="label-1" id="label-1">はじめる前に</a></h2><!-- RDLabel: "はじめる前に" -->
<p>本チュートリアルを始める前の準備です．</p>
<p><a name="index-0" id="index-0">&lt;div class=summary&gt;</a></p>
<h4><a name="label-2" id="label-2">この章の概要</a></h4><!-- RDLabel: "この章の概要" -->
<ul>
<li>GPhys/GGraph用スタートアップファイル <a href="irbrc_ggraph.rb">irbrc_ggraph.rb</a> をダウンロードし，irb を立ち上げてみます．</li>
<li>サンプルとして使う気象データ
  <a href="ncep2.Jan.clim.1981-2010.nc">ncep2.Jan.clim.1981-2010.nc</a>,
  <a href="air.2012-01.nc">air.2012-01.nc</a>,
  <a href="hgt.2012-01.nc">hgt.2012-01.nc</a>
  をダウンロードします．</li>
</ul>
<p><!-- Index, but conflict -->&lt;/div&gt;<!-- Index end --></p>
<h4><a name="label-3" id="label-3">目次</a></h4><!-- RDLabel: "目次" -->

<h3><a name="label-4" id="label-4">インストール</a></h3><!-- RDLabel: "インストール" -->
<p>GPhys は多次元データ解析可視化ライブラリです．GGraph は GPhys 付属の可視化ライブラリです．</p>
<p>このチュートリアルは，GPhys はインストールしてあるものとして進めます．
もしもまだなら <a href="http://ruby.gfd-dennou.org/products/gphys/">GPhysホームページ</a>
を参考にインストールしてください．</p>
<h3><a name="label-5" id="label-5">Ruby の実行</a></h3><!-- RDLabel: "Ruby の実行" -->
<p>Ruby で書くプログラムは通常，.rb という拡張子で終わるファイルに保存し，
ruby コマンドで実行します．例えば hoge.rb という名前のファイルに保存したプログラムは，
コマンドライン端末で</p>
<pre>$ ruby hoge.rb</pre>
<p>と実行します．ここではプロンプトを $ で表しました（以後も同様に表します）．</p>
<p>他の方法として，次のように対話的インタープリターによる実行もできます．</p>
<h3><a name="label-6" id="label-6">irb について</a></h3><!-- RDLabel: "irb について" -->
<p>irb は Ruby の対話的インタープリターです．
本チュートリアルでは irb を多く使います．</p>
<p>コマンドライン端末で irb を立ち上げると,
1行入力する度にRubyコードとして実行され，結果が表示されます.
irb を立ち上げるには，で irb と入力します．
すると，入力待ちのプロンプト（irb(main):001:0&gt; といった文字列）が表示されるので，とりあえず四則演算でもやってみましょう("1 + 2"がユーザーの入力です)．</p>
<pre>$ irb
<span class=irb_input>1 + 2</span>
=&gt; 3</pre>
<h4><a name="label-7" id="label-7">irb の初期設定と立ち上げ方．</a></h4><!-- RDLabel: "irb の初期設定と立ち上げ方．" -->
<p>対話的可視化用設定ファイル <a href="irbrc_ggraph.rb">irbrc_ggraph.rb</a> をダウンロードしてホームディレクトリに置きます 
(ホームディレクトリは UNIX 系 OS では ~/ と表せます. 
Windows等では適当なフォルダーに置き，以下の ~/ はそれに読み替えてください).</p>
<p>この設定ファイルを読み込んで irb を立ち上げるには</p>
<pre>$ irb -r ~/irbrc_ggraph.rb</pre>
<p>とします．毎回これをタイプするのは面倒ですので，次の 1, 2 のいずれかによって，もっと簡単に使えるようにしましょう．</p>
<ol>
<li><p>スタートアップファイルへの登録．</p>
<p>ホームディレクトリに .irbrc というファイルを作り，中身に次の行を書きます．</p>
<pre>require "~/irbrc_ggraph.rb"</pre>
<p>すると，単にコマンドラインで irb と入力するだけで irbrc_ggraph.rb が読み込まれます．</p></li>
<li><p>別名の設定　(linuxなどUNIX系のOSのみ)</p>
<p>もしも必要なときだけ irbrc_ggraph.rb を読み込むようにしたければ，別名を設定しましょう．
例えば bash を使ってる場合，~/.bashrc に次の行を加えます．</p>
<pre>alias irb_ggraph="irb -r ~/irbrc_ggraph.rb"</pre>
<p>これで，</p>
<pre>$ irb_ggraph</pre>
<p>とすれば irbrc_ggraph.rb が読み込んで irb が始まります.
別名を登録しておけばコマンド名のタブ補完が効きますので，名前を全部覚えてなくても大丈夫です.</p></li>
</ol>
<p>本チュートリアルでは (2) の方法を使います．(1) の方法を使う場合，
$ irb_ggraph と書いてあれば $ irb と読み替えてください．</p>
<h3><a name="label-8" id="label-8">サンプルデータのダウンロード</a></h3><!-- RDLabel: "サンプルデータのダウンロード" -->
<p>本チュートリアルでは次のデータを使います．
ダウンロードして適当なディレクトリー（フォルダー）においてください．
チュートリアルはすべてそのディレクトリーで実行します．</p>
<ul>
<li><a href="ncep2.Jan.clim.1981-2010.nc">ncep2.Jan.clim.1981-2010.nc</a> : 1981年から2010年までの30年間のデータより得られた月毎の気候値（「平年値」）です．収録物理量は次です（コロンの前はファイル中の変数名です）．
<ul>
<li>mslp : 海面更正気圧 (Pa)</li>
<li>air : 気温 (K)</li>
<li>hgt : 等圧面高度 (m)</li>
<li>uwnd : 東西風 (m/s)</li>
<li>vwnd : 南北風 (m/s)</li>
</ul></li>
<li><a href="air.2012-01.nc">air.2012-01.nc</a> : 2012年1月の気温の日平均値(K)です．収録変数名は air</li>
<li><a href="hgt.2012-01.nc">hgt.2012-01.nc</a> : 2012年1月の等圧面高度の日平均値(m)です．収録変数名は hgt</li>
</ul>
<p>これらは <a href="http://www.esrl.noaa.gov/psd/data/gridded/data.ncep.reanalysis2.html">NCEP-DOE Rananalysis2</a>
による客観解析(再解析)データで，ファイル形式は <a href="http://www.unidata.ucar.edu/software/netcdf/">NetCDF</a> です．</p>
<p>いずれも経度緯度2.5度の等間隔データで，mslp 以外は鉛直には気圧座標のデータとなります(1000, 925, 850, 700, 600, 500, 400, 300, 250, 200, 150, 
100, 70, 50, 30, 20, 10 hPa の17層)．1000 hPa などは「地面の下」（つまり実際にはその気圧の箇所は存在しない）ところも多いですが，その場合補外となっています（だから南極やチベット高原でも 1000 hPa の「気温」が定義されています）．</p>
<p>これらのファイルは上記のサイトから取得できるデータを <a href="tool/">こちら</a> 
に置いた Ruby プログラムで加工して作りました（GPhysを使っています．なお1月の気候値のみの切り出しは対話的に行いました）．</p>
<h3><a name="label-9" id="label-9">NetCDF データの内容確認</a></h3><!-- RDLabel: "NetCDF データの内容確認" -->
<p>コマンドラインで NetCDF データの内容を確認するには ncdump コマンドを使います
（オプション -h をつけます）．以下で2行目以降は ncdump の出力です．</p>
<pre>$ ncdump -h air.2012-01.nc 
netcdf air.2012-01 {
dimensions:
        lon = 144 ;
        lat = 73 ;
        level = 17 ;
        time = 31 ;
variables:
        float lon(lon) ;
                lon:units = "degrees_east" ;
                lon:long_name = "Longitude" ;
                lon:actual_range = 0.f, 357.5f ;
                lon:standard_name = "longitude" ;
                lon:axis = "X" ;
        float lat(lat) ;
                lat:units = "degrees_north" ;
                lat:actual_range = 90.f, -90.f ;
                lat:long_name = "Latitude" ;
                lat:standard_name = "latitude" ;
                lat:axis = "Y" ;
        float level(level) ;
                level:units = "millibar" ;
                level:actual_range = 1000.f, 10.f ;
                level:long_name = "Level" ;
                level:positive = "down" ;
                level:GRIB_id = 100s ;
                level:GRIB_name = "hPa" ;
                level:axis = "Z" ;
        double time(time) ;
                time:units = "hours since 1-1-1 00:00:0.0" ;
                time:long_name = "Time" ;
                time:actual_range = 17628096., 17629344. ;
                time:delta_t = "0000-00-01 00:00:00" ;
                time:avg_period = "0000-00-01 00:00:00" ;
                time:standard_name = "time" ;
                time:axis = "T" ;
        short air(time, level, lat, lon) ;
                air:long_name = "mean Daily Air temperature" ;
                air:unpacked_valid_range = 150.f, 350.f ;
                air:actual_range = 185.3f, 314.275f ;
                air:units = "degK" ;
                air:add_offset = 477.66f ;
                air:scale_factor = 0.01f ;
                air:missing_value = 32766s ;
                air:precision = 2s ;
                air:least_significant_digit = 1s ;
                air:GRIB_id = 11s ;
                air:GRIB_name = "TMP" ;
                air:var_desc = "Air temperature" ;
                air:dataset = "NCEP Reanalysis Daily Averages" ;
                air:level_desc = "Multiple levels" ;
                air:statistic = "Mean" ;
                air:parent_stat = "Individual Obs" ;
                air:valid_range = -32766s, -12766s ;

// global attributes:
                :Conventions = "COARDS" ;
                :title = "mean daily NMC reanalysis (2012)" ;
                :history = "created 2011/12 by Hoop (netCDF2.3)\n",
                        "2012-02-28 18:40:29 JST horinout&gt; extractJan.rb wrote air" ;
                :description = "Data is from NMC initialized reanalysis\n",
                        "(4x/day).  It consists of most variables interpolated to\n",
                        "pressure surfaces from model (sigma) surfaces." ;
                :platform = "Model" ;
                :references = "http://www.esrl.noaa.gov/psd/data/gridded/data.ncep.reanalysis.html" ;
}</pre>

</body>
</html>
