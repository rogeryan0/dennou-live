<?xml version="1.0" encoding="euc-jp" ?>
<!DOCTYPE html 
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
<meta http-equiv="Content-type" content="text/html; charset=euc-jp" />
<title>Spml  Installation Guide</title>
<link href="/library/dcmodel/htmltools/dcmodel.css" type="text/css" rel="stylesheet" />
</head>
<body>
<h1><a name="Title:" href="#Title:">Title:</a> <a name="label-0">Spml  Installation Guide</a></h1><!-- RDLabel: "Spml  Installation Guide" -->

<h2><a name="1" href="#1">1</a> <a name="label-1">Operation Environment</a></h2><!-- RDLabel: "Operation Environment" -->

<p>Spml library is operated by following environments.</p>
<ul>
<li>OS: <a href="http//www.debian.org/">Debian GNU/Linux</a></li>
<li>Fortran Compiler
<ul>
<li><a href="http://www.g95.org/">G95 Fortran Compiler ver. 0.91</a>
<ul>
<li>with <a href="http://www.mcs.anl.gov/research/projects/mpich2/">MPICH2 1.0.7</a></li>
</ul></li>
<li><a href="http://www.fqs.fujitsu.com/fort-c/">Fujitsu Fortran Driver ver.1.0(Japanese)</a>
<ul>
<li>with <a href="http://www.mcs.anl.gov/research/projects/mpich2/">MPICH2 1.0.7</a></li>
</ul></li>
<li><a href="http://www.fqs.fujitsu.com/fort-c/">Fujitsu Fortran Compiler ver.5.0(Japanese)</a>
<ul>
<li>with <a href="http://www.mcs.anl.gov/research/projects/mpich2/">MPICH2 1.0.7</a></li>
</ul></li>
<li><a href="http://www.intel.com/software/products/compilers/flin/">Intel Fortran Compiler ver 10.0, 11.0</a></li>
</ul></li>
</ul>
<p>Spml library was operated by following environments in the past.
Latest version may be operated (unconfirmed).</p>
<ul>
<li>Cray XT4 + PGI Fortran</li>
<li>NEC SX-6 + FORTRAN90/SX</li>
<li>NEC SX-8 + FORTRAN90/SX</li>
<li>NEC SX-8R + FORTRAN90/SX</li>
<li>NEC SX-9 + FORTRAN90/SX</li>
<li>Linux + PGI Fortran</li>
</ul>
<h2><a name="2" href="#2">2</a> <a name="label-2">General outline</a></h2><!-- RDLabel: "General outline" -->

<p>Install spml as follows. Refer each items for details.</p>
<ol>
<li>Satisfy <a href="#label-3">Software Requirements</a>.</li>
<li>Build the library following <a href="#label-4">How to build</a>.</li>
<li>Install the library following <a href="#label-36">How to install</a>.</li>
<li>Check whether the installed library functions normally
      following <a href="#label-37">Execute test programs</a>.</li>
<li><a href="#label-38">Set PATH</a>.</li>
</ol>
<h2><a name="3" href="#3">3</a> <a name="label-3">Software Requirements</a></h2><!-- RDLabel: "Software Requirements" -->

<p>The following software needs to use spml</p>
<ul>
<li><a href="http://www.gfd-dennou.org/library/netcdf">netCDF</a>, version 3.6</li>
<li><a href="http://www.gfd-dennou.org/library/gtool">gtool5</a></li>
<li><a href=":http://www.gfd-dennou.org/library/ispack">ispack</a></li>
</ul>
<h2><a name="4" href="#4">4</a> <a name="label-4">How to build</a></h2><!-- RDLabel: "How to build" -->

<h3><a name="4.1" href="#4.1">4.1</a> <a name="label-5">Extract TGZ Package</a></h3><!-- RDLabel: "Extract TGZ Package" -->

<p>Make an empty directory, and extract archive.
A directory `spml-<var>version</var>'
created at the current working directory.</p>
<pre>$ tar xvzf spml_current.tgz</pre>
<p>or</p>
<pre>$ zcat spml_current.tar.gz | tar -xvf -</pre>
<h3><a name="4.2" href="#4.2">4.2</a> <a name="label-6">Specify Fortran Compiler</a></h3><!-- RDLabel: "Specify Fortran Compiler" -->

<p>Specify Fortran compiler to environment variable <em> FC </em>.
For example, if you use "frt",</p>
<ul>
<li><p>sh, bash</p>
<pre>$ FC=frt ; export FC</pre></li>
<li><p>csh, tcsh</p>
<pre>$ setenv FC frt</pre></li>
</ul>
<p>Specify Fortran compiler options for optimization and debug to
environment variable <em> SYSFFLAGS </em>.
For example, if you set options for automatic optimization and
automatic parallelization to Fujitsu Fortran,</p>
<ul>
<li><p>sh, bash</p>
<pre>$ FFLAGS="-Kfast,parallel" ; export FFLAGS</pre></li>
<li><p>csh, tcsh</p>
<pre>$ setenv FFLAGS "-Kfast,parallel"</pre></li>
</ul>
<h3><a name="4.3" href="#4.3">4.3</a> <a name="label-7">Create `Config.mk'</a></h3><!-- RDLabel: "Create `Config.mk'" -->

<p>Move created directroy, and excute `<code> ./configure </code>'.
You should set necessary library location, netCDF, gtool5, ispack.
If your path of netCDF library is `/usr/local/netcdf/lib/libnetcdf.a',
gtool5 library is `/usr/local/gtool5/lib/libgtool5.a',
ISPACK library is `/usr/local/ispack/lib/libisp.a',
you should set options as follow.
Then a configure file `Config.mk' will be created at
the current working directory.
If the netCDF library is a shared library, <code> --with-netcdff= </code>
option may be needed.
See details of options as follows.</p>
<pre>$ ./configure --with-netcdf=/usr/local/netcdf/lib/libnetcdf.a \
              --with-gtool5=/usr/local/gtool5/lib/libgtool5.a \
              --with-ispack=/usr/local/ispack/lib/libisp.a </pre>
<p>If spml is built for MPI, see <a href="#label-32">How to build for MPI</a>.</p>
<p>GNU make is needed to build, so configure automatically inquires
into GNU make in PATH. However, it returns error when GNU make is
not found. In that case, please set the GNU make command for
environment variable <em> MAKE </em>. And rerun execute `<code> ./configure </code>'.</p>
<p>If you want to change directory to which the library and the module, etc.
are installed, please set <code> --help </code> option as follow. Available
options are showed.</p>
<pre>$ ./configure --help</pre>
<p>Descriptions about principal options are listed below.</p>
<dl>
<dt><a name="label-8" id="label-8"><code>--with-netcdf=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-netcdf=ARG" -->
<dd>
Specify <!-- Reference, RDLabel "netCDF library needed for build" doesn't exist --><em class="label-not-found">netCDF library needed for build</em><!-- Reference end --> to <var>ARG</var>.
You must specify explicitly.
</dd>
<dt><a name="label-9" id="label-9"><code>--with-netcdff=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-netcdff=ARG" -->
<dd>
If the netCDF library is a shared library, the library may be divided
C library from Fortran library. In the case, specify the C library
to above option, and specify 
<!-- Reference, RDLabel "the Fortran library" doesn't exist --><em class="label-not-found">the Fortran library</em><!-- Reference end --> to <var>ARG</var> in this option.
</dd>
<dt><a name="label-10" id="label-10"><code>--with-netcdf-include=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-netcdf-include=ARG" -->
<dd>
Set location of netCDF header files, if you need.
</dd>
<dt><a name="label-11" id="label-11"><code>--with-gtool5=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-gtool5=ARG" -->
<dd>
Specify <!-- Reference, RDLabel "gtool5 library needed for build" doesn't exist --><em class="label-not-found">gtool5 library needed for build</em><!-- Reference end --> to <var>ARG</var>.
You must specify explicitly.
</dd>
<dt><a name="label-12" id="label-12"><code>--with-ispack=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-ispack=ARG" -->
<dd>
Specify <!-- Reference, RDLabel "ispack library needed for build" doesn't exist --><em class="label-not-found">ispack library needed for build</em><!-- Reference end --> to <var>ARG</var>.
You must specify explicitly.
</dd>
<dt><a name="label-13" id="label-13"><code>--with-ssl2=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-ssl2=ARG" -->
<dt><a name="label-14" id="label-14"><code>--with-ssl2tp=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-ssl2tp=ARG" -->
<dt><a name="label-15" id="label-15"><code>--with-lapack=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-lapack=ARG" -->
<dd>
Specify <!-- Reference, RDLabel "library using solve eigenvalue problem" doesn't exist --><em class="label-not-found">library using solve eigenvalue problem </em><!-- Reference end --> to <var>ARG</var>,
if you need.
</dd>
<dt><a name="label-16" id="label-16"><code>--with-fftw=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-fftw=ARG" -->
<dt><a name="label-17" id="label-17"><code>--with-rfftw=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-rfftw=ARG" -->
<dd>
Specify <!-- Reference, RDLabel "library using FFTW ver.2" doesn't exist --><em class="label-not-found">library using FFTW ver.2</em><!-- Reference end -->.
You must specify explicitly if you build ispack library with -FFTW2 option.
</dd>
<dt><a name="label-18" id="label-18"><code>--with-mpifc=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-mpifc=ARG" -->
<dd>
Specify <!-- Reference, RDLabel "MPI Fortran Compiler" doesn't exist --><em class="label-not-found">MPI Fortran Compiler</em><!-- Reference end --> to <var>ARG</var> if you want to build MPI support.
</dd>
<dt><a name="label-19" id="label-19"><code>--prefix=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;prefix=ARG" -->
<dd>
Specify prefix to <var>ARG</var>.
Default value is <code> /usr/local/spml </code>.
</dd>
<dt><a name="label-20" id="label-20"><code>--host=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;host=ARG" -->
<dd>
When cross-compiling, specify
the type of system on which the package will run to
<var>ARG</var>.
</dd>
<dt><a name="label-21" id="label-21"><code>--libdir=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;libdir=ARG" -->
<dd>
Specify directory to which the library is installed to <var>ARG</var>.
Default value is <code> /usr/local/spml/lib </code>.
</dd>
<dt><a name="label-22" id="label-22"><code>--includedir=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;includedir=ARG" -->
<dd>
Specify directory to which the module is installed to <var>ARG</var>.
Default value is <code> /usr/local/spml/include </code>.
</dd>
<dt><a name="label-23" id="label-23"><code>--bindir=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;bindir=ARG" -->
<dd>
Specify directory to which the executable file is installed to <var>ARG</var>.
Default value is <code> /usr/local/spml/bin </code>.
</dd>
<dt><a name="label-24" id="label-24"><code>--with-docdir=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-docdir=ARG" -->
<dd>
Specify directory to which the documentation file is installed to <var>ARG</var>.
Default value is <code> /usr/local/spml/doc </code>.
</dd>
<dt><a name="label-25" id="label-25"><code>--with-abort=</code><var>ARG</var></a></dt><!-- RDLabel: "&shy;&shy;with-abort=ARG" -->
<dd>
Specify one of <code>abort, errtra-setrcd, exit, setrcd, stop</code> to
<var>ARG</var>.
Default value is <code> abort </code>.
<dl>
<dt><a name="label-26" id="label-26">abort</a></dt><!-- RDLabel: "abort" -->
<dd>
Stop by intrinsic subroutine "abort".
</dd>
<dt><a name="label-27" id="label-27">errtra-setrcd</a></dt><!-- RDLabel: "errtra-setrcd" -->
<dd>
Stop by Fujitsu Fortran service subroutine "ERRTRA".
And outputs error trace back map.
</dd>
<dt><a name="label-28" id="label-28">exit</a></dt><!-- RDLabel: "exit" -->
<dd>
Stop by intrinsic subroutine "exit".
</dd>
<dt><a name="label-29" id="label-29">setrcd</a></dt><!-- RDLabel: "setrcd" -->
<dd>
Stop by Fujitsu Fortran service subroutine "SETRCD".
And outputs error trace back map.
</dd>
<dt><a name="label-30" id="label-30">stop</a></dt><!-- RDLabel: "stop" -->
<dd>
Stop by intrinsic subroutine "stop".
</dd>
</dl>
</dd>
<dt><a name="label-31" id="label-31"><code>--config-cache or -C</code></a></dt><!-- RDLabel: "&shy;&shy;config-cache or -C" -->
<dd>
<p><code> config.cache </code> is created at the same time as <code> Config.mk </code>'s
being generated.
<code> config.cache </code> stores information investigated with
<code> ./configure </code>.</p>
<p>If you set this option, when you execute <code> ./configure </code> again,
<code>config.cache</code> is loaded.
If you want to ignore <code>config.cache</code>, don't set this option</p>
<p>For example, execute <code> ./configure </code> as follows.</p>
<pre>$ ./configure -C --with-netcdf=/usr/local/netcdf/lib/libnetcdf.a \
                 --with-gtool5=/usr/local/gtool5/lib/libgtool5.a \
                 --with-ispack=/usr/local/ispack/lib/libisp.a </pre>
<p>Then, information such as the locations of libraries is
succeeded by executing <code> ./configure </code> as follows after next time.</p>
<pre>$ ./configure -C</pre>
</dd>
</dl>
<h3><a name="4.4" href="#4.4">4.4</a> <a name="label-32">How to build for MPI</a></h3><!-- RDLabel: "How to build for MPI" -->

<p>If spml is built for MPI, install MPI library to a system, and build gtool5
library with MPI support, see
<a href="http://www.gfd-dennou.org/library/gtool5/INSTALL.htm.en">Gtool5 Installation Guide</a>.</p>
<p>When "Config.mk" is edited, specify a compile commend like as "mpif90"
to environment variable <em> FC </em>.
And specify "--with-mpiexec" option of "configure".</p>
<pre>$ ./configure -C --with-netcdf=/usr/local/netcdf/lib/libnetcdf.a \
                 --with-gtool5=/usr/local/gtool5/lib/libgtool5.a \
                 --with-ispack=/usr/local/ispack/lib/libisp.a \
                 --with-mpifc=/usr/local/mpich/mpif90</pre>
<p>See <a href="#label-7">Create `Config.mk'</a> about other options. </p>
<h3><a name="4.5" href="#4.5">4.5</a> <a name="label-33">Edit `Config.mk'</a></h3><!-- RDLabel: "Edit `Config.mk'" -->

<p>Edit `<code>Config.mk</code>' manually, if you want to change. 
If you do not understand following settings, 
go forward to <a href="#label-34">Compile source code</a> tentatively. </p>
<pre>FC          : Fortran Compiler

SYSFFLAGS   : Flags needed when compiled and linked

SYSLDFLAGS  : Flags needed when linked

SYSLDLIBS   : Libraries needed when linked

F90MODTYPE  : Information of Modules
              (std.mod, HP.mod, fqs.mod, intel.d, hitachi.f90)

DEST_LIB    : Directory to which the library file is installed

DEST_INC    : directory to which the module files are installed

DEST_BIN    : directory to which the executable files are installed

DEST_DOC    : directory to which the documantation files are installed

MODS        : Extensions of Module Files used when "make clean"

MAKE        : GNU make command

AR          : Archive command

ARFLAGS     : Flags of AR

RANLIB      : Generate index to archive</pre>
<h3><a name="4.6" href="#4.6">4.6</a> <a name="label-34">Compile source code</a></h3><!-- RDLabel: "Compile source code" -->

<p>You must use GNU make to build. No other "make" program is acceptable.
"make" tentatively means GNU make at the following.
Replace them with GNU make of your system.</p>
<p>When ./configure is executed, the command name of GNU make is
displayed as follows. Execute GNU make according to this
message.</p>
<pre>Execute GNU make in the current directory, as follows.

  /usr/bin/make</pre>
<h3><a name="4.7" href="#4.7">4.7</a> <a name="label-35">Generate documentations</a></h3><!-- RDLabel: "Generate documentations" -->

<p>To generate documentations, execute the following command
in current directory. If you get from
<a href="http://www.gfd-dennou.org/library/spmodel/spml.tar.gz">Spml TGZ package</a>, 
documentations are already generated.</p>
<pre>$ make doc
$ make install</pre>
<h2><a name="5" href="#5">5</a> <a name="label-36">How to install</a></h2><!-- RDLabel: "How to install" -->

<p>In current directory, execute following command.
If you install to system, you need to be administrator.
(By default, you install to system).</p>
<pre># make install</pre>
<h2><a name="6" href="#6">6</a> <a name="label-37">Execute test programs</a></h2><!-- RDLabel: "Execute test programs" -->

<p>In current directry, execute following command.
If message "<code> *** Compilation and installation are succeeded !! *** </code>"
are showed without error, installation is completed.</p>
<pre>$ make test</pre>
<h2><a name="7" href="#7">7</a> <a name="label-38">Set PATH</a></h2><!-- RDLabel: "Set PATH" -->

<p>If the installation is correctly done as stated above,
shell script <em>spmfrt</em> is made under the directory
<code>--prefix=</code><var>ARG</var>/bin
(By default, <code> /usr/local/spml/bin/ </code> ).</p>
<p>Please specify PATH to this directory.
It is an example as follows when <em>spmfrt</em> is installed in
<code>/usr/local/spml/bin/</code> .</p>
<ul>
<li><p>sh, bash</p>
<pre>$ PATH=$PATH:/usr/local/spml/bin ; export PATH</pre></li>
<li><p>csh, tcsh</p>
<pre>$ setenv PATH $PATH:/usr/local/spml/bin</pre></li>
</ul>
<p><em>spmfrt</em> is a shell script in order to easily compile and link
Fortran programs which utilizes the spml library.
Link to the gtool5 library and directory appointment to the modules
are done automatically by using spmfrt in place of command of the
Fortran compiler.</p>
<pre>$ spmfrt test.f90

/usr/bin/g95 -I/usr/local/spml/include \
             -I/usr/local/gtool5/include -O test.f90 \
             -L/usr/local/gtool5/lib \
             -L/usr/local/netcdf/lib \
             -L/usr/local/ispack/lib \
             -L/usr/local/spml/lib \
             -lgtool5 -lnetcdf -lisp -lspml</pre>

</body>
</html>
