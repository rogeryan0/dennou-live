<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>mouse_cut (NumRu::GPhys)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File interpolate.rb, line 31</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mouse_cut</span>(<span class="ruby-identifier">dimx</span>, <span class="ruby-identifier">dimy</span>, <span class="ruby-identifier">num</span>=<span class="ruby-value">2</span>)

      <span class="ruby-comment cmt"># &lt; preparation &gt;</span>

      <span class="ruby-identifier">dimx</span> = <span class="ruby-identifier">dim_index</span>(<span class="ruby-identifier">dimx</span>)
      <span class="ruby-identifier">dimy</span> = <span class="ruby-identifier">dim_index</span>(<span class="ruby-identifier">dimy</span>)

      <span class="ruby-identifier">rundef</span> = <span class="ruby-constant">DCL</span>.<span class="ruby-identifier">glpget</span>(<span class="ruby-value str">&quot;rundef&quot;</span>)
      <span class="ruby-identifier">line</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">while</span>(<span class="ruby-keyword kw">true</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;\n*** Waiting for mouse click. Click #{num} points in the current viewport.&quot;</span>
        <span class="ruby-identifier">line</span> = <span class="ruby-constant">DCLMouseLine</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">num</span>)
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">ux</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">rundef</span>)
          <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;** The points specified include one(s) outside the U window. Do it again.&quot;</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-keyword kw">break</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">line</span>.<span class="ruby-identifier">draw</span>
      <span class="ruby-identifier">vx</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">vx</span>
      <span class="ruby-identifier">vy</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">vy</span>
      <span class="ruby-identifier">ux</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">ux</span>
      <span class="ruby-identifier">uy</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">uy</span>
      <span class="ruby-identifier">len</span> = <span class="ruby-identifier">ux</span>.<span class="ruby-identifier">length</span>
      <span class="ruby-identifier">kx</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">ky</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">cut</span> = [<span class="ruby-keyword kw">true</span>]<span class="ruby-operator">*</span><span class="ruby-identifier">rank</span>
      <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">in</span> <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">len</span>
        <span class="ruby-identifier">cut</span>[<span class="ruby-identifier">dimx</span>] = <span class="ruby-identifier">ux</span>[<span class="ruby-identifier">i</span>]
        <span class="ruby-identifier">cut</span>[<span class="ruby-identifier">dimy</span>] = <span class="ruby-identifier">uy</span>[<span class="ruby-identifier">i</span>]
        <span class="ruby-identifier">dummy</span>, <span class="ruby-identifier">sl</span> = <span class="ruby-identifier">grid</span>.<span class="ruby-identifier">cut</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cut</span>)
        <span class="ruby-identifier">kx</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">sl</span>[<span class="ruby-identifier">dimx</span>]
        <span class="ruby-identifier">ky</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">sl</span>[<span class="ruby-identifier">dimy</span>]
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">ndiv</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">ndsum</span> = [<span class="ruby-value">0</span>]
      <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">in</span> <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">len</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>
        <span class="ruby-identifier">ndiv</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-constant">Math</span>.<span class="ruby-identifier">sqrt</span>( (<span class="ruby-identifier">kx</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">kx</span>[<span class="ruby-identifier">i</span>])<span class="ruby-operator">**</span><span class="ruby-value">2</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">ky</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">ky</span>[<span class="ruby-identifier">i</span>])<span class="ruby-operator">**</span><span class="ruby-value">2</span>).<span class="ruby-identifier">to_i</span>
        <span class="ruby-identifier">ndsum</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">ndsum</span>[<span class="ruby-value">-1</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">ndiv</span>[<span class="ruby-identifier">i</span>]   <span class="ruby-comment cmt"># 0, ndiv[0], ndiv[0]+ndiv[1], ...</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">ndtot</span> = <span class="ruby-identifier">ndsum</span>[<span class="ruby-value">-1</span>]
      <span class="ruby-identifier">vxdiv</span> = <span class="ruby-constant">NArray</span>.<span class="ruby-identifier">float</span>(<span class="ruby-identifier">ndtot</span>)
      <span class="ruby-identifier">vydiv</span> = <span class="ruby-constant">NArray</span>.<span class="ruby-identifier">float</span>(<span class="ruby-identifier">ndtot</span>)
      <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">in</span> <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">len</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>
        <span class="ruby-identifier">a</span> = <span class="ruby-constant">NArray</span>.<span class="ruby-identifier">float</span>(<span class="ruby-identifier">ndiv</span>[<span class="ruby-identifier">i</span>]).<span class="ruby-identifier">indgen</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">ndiv</span>[<span class="ruby-identifier">i</span>]
        <span class="ruby-identifier">vxdiv</span>[<span class="ruby-identifier">ndsum</span>[<span class="ruby-identifier">i</span>]<span class="ruby-operator">...</span><span class="ruby-identifier">ndsum</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]] = (<span class="ruby-value">1.0</span><span class="ruby-operator">-</span><span class="ruby-identifier">a</span>)<span class="ruby-operator">*</span><span class="ruby-identifier">vx</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">a</span><span class="ruby-operator">*</span><span class="ruby-identifier">vx</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]
        <span class="ruby-identifier">vydiv</span>[<span class="ruby-identifier">ndsum</span>[<span class="ruby-identifier">i</span>]<span class="ruby-operator">...</span><span class="ruby-identifier">ndsum</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]] = (<span class="ruby-value">1.0</span><span class="ruby-operator">-</span><span class="ruby-identifier">a</span>)<span class="ruby-operator">*</span><span class="ruby-identifier">vy</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">a</span><span class="ruby-operator">*</span><span class="ruby-identifier">vy</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">uxdiv</span> = <span class="ruby-constant">NArray</span>.<span class="ruby-identifier">float</span>(<span class="ruby-identifier">ndtot</span>)
      <span class="ruby-identifier">uydiv</span> = <span class="ruby-constant">NArray</span>.<span class="ruby-identifier">float</span>(<span class="ruby-identifier">ndtot</span>)
      <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">in</span> <span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">ndtot</span>
        <span class="ruby-identifier">uxdiv</span>[<span class="ruby-identifier">i</span>], <span class="ruby-identifier">uydiv</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-constant">DCL</span>.<span class="ruby-identifier">stitrf</span>(<span class="ruby-identifier">vxdiv</span>[<span class="ruby-identifier">i</span>], <span class="ruby-identifier">vydiv</span>[<span class="ruby-identifier">i</span>])
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">cx</span> = <span class="ruby-identifier">coord</span>(<span class="ruby-identifier">dimx</span>)
      <span class="ruby-identifier">xcrd</span> = <span class="ruby-constant">VArray</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uxdiv</span>, <span class="ruby-identifier">cx</span>, <span class="ruby-identifier">cx</span>.<span class="ruby-identifier">name</span>)
      <span class="ruby-identifier">cy</span> = <span class="ruby-identifier">coord</span>(<span class="ruby-identifier">dimy</span>)
      <span class="ruby-identifier">ycrd</span> = <span class="ruby-constant">VArray</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uydiv</span>, <span class="ruby-identifier">cy</span>, <span class="ruby-identifier">cy</span>.<span class="ruby-identifier">name</span>)
      <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">vxdiv</span>[<span class="ruby-value">-1</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">vxdiv</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">abs</span> <span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">vydiv</span>[<span class="ruby-value">-1</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">vydiv</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">abs</span>
        <span class="ruby-identifier">cutter</span> = [<span class="ruby-identifier">xcrd</span>,<span class="ruby-identifier">ycrd</span>]  <span class="ruby-comment cmt"># x will be the main coord var if not map proj</span>
        <span class="ruby-identifier">crd</span> = <span class="ruby-identifier">xcrd</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">cutter</span> = [<span class="ruby-identifier">ycrd</span>,<span class="ruby-identifier">xcrd</span>]  <span class="ruby-comment cmt"># x will be the main coord var if not map proj</span>
        <span class="ruby-identifier">crd</span> = <span class="ruby-identifier">ycrd</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">axnm</span> = <span class="ruby-identifier">crd</span>.<span class="ruby-identifier">name</span>
      <span class="ruby-identifier">itr</span> = <span class="ruby-constant">DCL</span>.<span class="ruby-identifier">sgqtrn</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">itr</span><span class="ruby-operator">&gt;=</span><span class="ruby-value">10</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">itr</span><span class="ruby-operator">&lt;=</span><span class="ruby-value">40</span>
        <span class="ruby-identifier">newcrd</span> = <span class="ruby-identifier">__sp_dist</span>(<span class="ruby-identifier">xcrd</span>,<span class="ruby-identifier">ycrd</span>)
        <span class="ruby-identifier">modifier</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">gp</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">newax</span> = <span class="ruby-constant">Axis</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">set_pos</span>(<span class="ruby-identifier">newcrd</span>)
          <span class="ruby-identifier">gp</span>.<span class="ruby-identifier">grid</span>.<span class="ruby-identifier">set_axis</span>(<span class="ruby-identifier">axnm</span>,<span class="ruby-identifier">newax</span>)
          <span class="ruby-identifier">g</span> = <span class="ruby-constant">Grid</span>.<span class="ruby-identifier">new</span>( <span class="ruby-identifier">newax</span> )
          <span class="ruby-identifier">gxcrd</span> = <span class="ruby-constant">GPhys</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">g</span>,<span class="ruby-identifier">xcrd</span>)
          <span class="ruby-identifier">gycrd</span> = <span class="ruby-constant">GPhys</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">g</span>,<span class="ruby-identifier">ycrd</span>)
          <span class="ruby-identifier">gp</span>.<span class="ruby-identifier">set_assoc_coords</span>([<span class="ruby-identifier">gxcrd</span>, <span class="ruby-identifier">gycrd</span>])
          <span class="ruby-identifier">gp</span>
        }
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">modifier</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-ivar">@@interpo_previous_cutter</span> = <span class="ruby-identifier">cutter</span>
      <span class="ruby-ivar">@@interpo_previous_modifier</span> = <span class="ruby-identifier">modifier</span>

      <span class="ruby-comment cmt"># &lt; do the job &gt;</span>

      <span class="ruby-identifier">gpnew</span> = <span class="ruby-identifier">interpolate</span>(<span class="ruby-identifier">cutter</span>)
      <span class="ruby-identifier">gpnew</span> = <span class="ruby-identifier">modifier</span>[<span class="ruby-identifier">gpnew</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">modifier</span>
      [<span class="ruby-identifier">gpnew</span>, <span class="ruby-identifier">line</span>]
    <span class="ruby-keyword kw">end</span></pre>
</body>
</html>