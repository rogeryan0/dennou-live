require "numru/netcdf"

include NumRu

class File
  def words
    self.gets.split
  end
end

open('./grads.ctl','r'){|file|
  file.words
  $title = file.words[1..-1].join(' ')
  $rmiss = file.words[1].to_f
  array = file.words
  $idim,x0,xstep, = array[1].to_i,array[3].to_f,array[4].to_f
  $x = Array.new($idim)
  for i in 0..$idim-1
    $x[i] = x0+i*xstep
  end
  $jdim = file.words[1].to_i
  $y = Array.new($jdim)
  for i in 1..$jdim/8
    file.words[0..-1].each_with_index{|str,j| $y[j+(i-1)*8] = str.to_f}
  end
  $kdim = file.words[1].to_i
  $z = file.words.collect{|str| str.to_f}
  $tdim = file.words[1].to_i
  $nvar = file.words[1].to_i
  $name = Array.new($nvar)
  $longname = Hash.new($nvar)
  $unit = Hash.new($nvar)
  for i in 0..$nvar-1
    array = file.words
    name =  array[0]
    $name[i] = name
    str = array[3..-1].join(' ')
    $longname[name] = str[0..str.index('[')-2]
    $unit[name] = str[str.index('[')+1..-3]
  end
}
