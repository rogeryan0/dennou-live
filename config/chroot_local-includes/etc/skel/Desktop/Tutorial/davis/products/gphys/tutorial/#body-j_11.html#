<html>
</body>

<hr>
<a name="h2:toriaezu">
<p><h2>ȁꁤā끲</h2><br>
</a>

<a name="h3:saisoku contour">
<p><h3>ǁɁ(󁥁)</h3><br>
</a>

<p> ށ򁽁񁤁Ɓ߁聤. GPhys ǁہɁہсÁˁ, GPhysā끲́с
遥ՁÁ遥ց遥ꁡ GGraph ށށ쁤Ɓ끤΁, 쁤́с끤ȁˁ. 
GGraph ρ⁥偡끤ȁʁÁƁ, Ɂ聥ၥÁɁ򁥁⁥偡끴؁􁤁ȁƁā
. ΁つЁ󁥁ށ򁽁񁤁ၥÁ(⁥偡끴؁)
<tt>GGraph::contour</tt> ǁ. ʁ, GPhys  GGraph , 
ŁŁǁ Ruby 遥ց遥ꁡƁ́, NumRu ȁ⁥偡끤ˁƁ쁤
́ցʁ݁Ɓ. 
<a name="full_name_numru"></a>
聤Á, Ձ끥́ <tt>NumRu::GPhys</tt>,
<tt>NumRu::GGraph</tt> ʁɁȁʁ. 
</p><br>

<p> GGraphˁ끣Ɂ聥ၥÁ(<tt>contour</tt>, <tt>tone</tt>)
ǁ, ́遤쁤ǁʁ偤ʁ, 3,4,..́܁ˁāƁ
ǁ遤΁ʁҁŁ򁼁ƁŁˁց聤ˁʁÁƁ. Á, 
ʁ΁ׁ큥遥, 3́܁΁ǁ遤΁ʁҁŁၺǁ(1000hPa)΁Ɂ
(ԁȁց恤ρ́΁ʁ؁΁ၤˁɁՁƁ. ݁ˁρށށ쁤ʁ). 

<p><a href="contour1000mb_1.rb">contour1000mb_1.rb</a>
   <a name="contour1000mb_1"></a>
<table width=80%><tr><td><pre class="source">
1: require "numru/ggraph"
2: include NumRu
3: gphys = GPhys::IO.open('T.jan.nc', 'T')
4: DCL.gropn(1)
5: DCL.sgpset('lcntl', false) ; DCL.uzfact(0.7)
6: GGraph.contour( gphys )
7: DCL.grcls
</pre></td></tr></table>

<p> ʁ΁聤ˁԁ. 

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby contour1000mb_1.rb</span>
</pre></td></tr></table>

<p> 끤, ΁ށ́́ˁɁ쁤. 
</p><br>

<p><a href='contour1000mb_1.png'>
contour1000mb_1.rbԁ끲<br><img src='contour1000mb_1s.jpg'></a><br>

<p>偵ׁ큥遥΁1, 2ԁ́܁ρˁ聲󁸁Ɓցށʁǁ. 
ǁ遤<tt>require "numru/ggraph"</tt> ρɁׁ́ʁ遥ց遥ꁡ
Ɓ큡Ɂ. <tt>include NumRu</tt> ρʁƁ⁤聤, 
΁쁹 <tt>GGraph</tt> <tt>DCL</tt> ρف
<a href="#full_name_numru">Ձ끥́,</a>
āށ
<tt>NumRu::GGraph</tt>  <tt>NumRu::DCL</tt> ǁƁЁ́Ёʁ遤ʁ. 
</p><br>

<p>3ԁ́ <tt>gphys = GPhys::IO.open('T.jan.nc', 'T')</tt>
ǁ, Ձ <tt>T.jan.nc</tt> Á恤΁ʁс
<tt>T</tt> ˁЁ, GPhys ցȁ򁹁, ʁс́ <tt>gphys</tt>
򁳁䁤ŁƁƁ. 
<tt>GPhys::IO.open</tt> ρՁ끤΁΁򁼁Ɓȁʁ́, 
쁤쁤ˁЁ⁥偡끤ˁ́Łꁤ. 󁤁
NetCDF ǁ끤, ݁ˁ <tt>GPhys::NetCDF_IO.open</tt> 
ƁЁ쁤. , ⁥偡 <tt>GPhys::NetCDF_IO</tt>  NetCDF
Ձ끤΁򁼁ၤ򁻁ʁ. 恡ƁÁˁ؁āꁤʁ, 
NetCDF恡ɁˁÁ󁥁ف󁥁灥󁲁򁼁ၤԁ쁤. 
, ́ʁс́΁끡끤ˁÁƁɁʁс(lon, lat, level)⁲򁼁ၤ, 
GPhys ց (ǁρʁс́<tt>gphys</tt>) Ɓ⁤ˁȁʁ݁쁤. 
ǁˁāƁ⁲򁼁ၤԁ,  <tt>valid_range</tt> 
<tt>missing_value</tt> ؁āꁤ쁤Ɓ끾쁹, 
΁߁򁹁́΁. ΁ŁˁρÁ́򁼁聽Ё݁ʁ偽ҁˁρÁ́ɁՁ
NArray  NArrayMiss 遥΁ցȁʁց끤聤ˁʁ. 
</p><br>

<p> 4ԁ́ <tt>DCL.gropn(1)</tt> , DCL ΁遥ՁÁÁց遴ǁ. 
􁤁 1 ΁쁹, Áˁ́́ˁɁ쁤. 
5ԁ́܁ρā́Ɂׁ́ʁ, ǁρʁ
򁼁ၤ́ށ(<tt>DCL.sgpset('lcntl', false)</tt> 󁥁
ŁƁÁʁȁƁ򁼁ၤ쁤ʁ聤ˁ), Ɂˁāʁ΁灤
0.7 ǁ܁ˁƁ (<tt>DCL.uzfact(0.7)</tt>). 
</p><br>

<p> 6ԁ́܁ǁ聤Ɂ聤ǁ. <tt>GGraph.contour(gphys)</tt>
, 􁤁ˁ́遤쁤 GPhys ցȁ΁ǁŁɁ. 
ҁ΁聤, ́܁ʁ߁ˁ؁ƁρƁŁˁǁ遤΁ŁЁ쁤끤΁, 
1000 mb ˁ끿ʁʁɁہ΁ׁ큥Áȁȁʁ. 1000 mb Ё쁤ȁ, 
ށ΁偤΁ρȁˁɁ쁤 <tt>level=1000 milibar</tt>΁Ɂ遤. 
<!-- ʁ, ΁ށǁρɁفʁ΁󁤁ā΁ 'm' ʁ߁Ɂ쁤Ɓʁ. 
쁤򁲁ȁ򁤁ʁˁρ偽ҁ. -->
ށ遤끤聤, <tt>GGraph.contour</tt>
ρƁŁˁɁŁ΁򁼁ၤ򁹁ԁx, y񁤁쁤Ɓ끤ȁˁÁ큰Ձ. 
, 5ԁ́܁ǁʁ򁼁ၤ́ށ΁, Ɂ쁤 x, y ΁Á́
󁥁ށށ쁤Ɓ끤遤ǁ. 
</p><br>

<p> 7ԁ́܁ DCL ΁΁́ǁ. 

<p> ʁ, ɁɁׁ́ʁ5ԁ́܁򁽁, Ɂ􁤁6ԁǁՁ끤΁
ׁ󁤁遲ā끲, ΁́ށǁԁ. ށ򁥁ށʁˁρ偤ǁҁف. 
΁, ׁ큥遥ށˁāʁÁꁤʁ΁݁󁥁ȁǁ. 
</p><br>

<a name="h3:saisoku line">
<p><h3>ǁɁ(ށ)</h3><br>
</a>

<p>Ɓׁ́΁΁ǁށɁƁ߁聤. 偤΁ׁ큥遥 6 ԁ́܁
<tt>GGraph.contour(gphys)</tt>  <tt>GGraph.line(gphys)</tt>
ˁʁс쁤Ё聤. Á쁤ȁ́(ށŁ)ˁ؁, ǁ遤΁ʁҁŁ
ʁāށˁ́ˁˁЁ쁤Ɓށ́́ǁ򁤁ʁ. , Ɓˁ܁ɁՁၤ
āׁ큥Ձ끤ɁƁ߁聤. GPhys΁ၥÁ <tt>cut</tt>
ρցǁ΁ځꁽЁ򁹁ԁ. 쁤ρ򁽁ȁցˁ؁āꁤʁˁ, 
́ǁ؁āꁤʁˁ΁ā́ꁤ΁ȁʁǁ. 
ʁ2ԁρƁ끲́ȁʁ. <a name="cut introduced"></a>

<table width=80%><tr><td><pre class="source">
gp_jpn = gphys.cut(135,35,true)
gp_jpn = gphys.cut('lon'=>135,'lat'=>35)
</pre></td></tr></table>

<p>ǁ遤΁쁹灤΁􁤁΁؁āʁˁ NArray  [] ၥÁɁȁƁ́́ǁ. 
Á, ́ǁ؁āꁤ쁹灤ȁƁ́́ˁʁǁՁ΁(rank)΁ǁ
ˁЁ끤ˁ, ΁聤 true ǁʁ false ˁ聤끡ց遥Ёׁ򁻁ȁЁ΁Ɂ. 
遥ЁρǁՁā true (ȁρρ΁؁ā) ˁŁ. 

<table width=80%><tr><td><pre class="source">
gp_jpn = gphys.cut(135,35,false)
</pre></td></tr></table>

<p>ʁ́Á́ yorick ȁ쁤ǁρ遥Ё .. ȁɁ. 
āށ (135,35,..) ʁ. ΁ʁ́܁ꁤ䁤, Ruby ǁ
.. Ɓȁ΁끤ȁρǁʁ΁ǁȁʁ. 

</p><br>
<p>ǁ, ށɁƁ߁聤. 
</p><br>

<p><a href="line_1.rb">line_1.rb</a>
<table width=80%><tr><td><pre class="source">
1: require "numru/ggraph"
2: include NumRu
3: gphys = GPhys::IO.open('T.jan.nc', 'T')
4: DCL.gropn(1)
5: DCL.sgpset('lcntl', false) ; DCL.uzfact(0.7)
6: GGraph.line( gphys.cut(135,35,false) )
7: DCL.grcls
</pre></td></tr></table>

<p>끲́ρʁ끡
</p><br>

<p><a href='line_1.png'>line_1.rbԁ끲<br><img src='line_1s.jpg'></a><br>

<p>
ρȁˁ, "lon=130.0 degrees_east", "lat=40.0 degress_north" ȁɁ
쁤. cut ρȁցၤʁҁŁց聤ˁʁÁƁ, 灤ɁÁ
򁻁؁āꁤ쁹灤ρ聤ꁳʁҁŁȁց恤΁ʁЁ쁤. 
<a href="#ncdump T.jan.nc">ЁŁفρŁ쁢, ށŁفρˁ́Ɓˁʁǁ쁤Ɓ끤΁</a>, ΁聤ʁށŁفЁŁفЁ쁤끤΁ǁ. 
</p><br>

<p>, āɁǁ끰΁ρˁ́聤끤, 
Ɂⁱāׁ큥Ձ끤ǁ끤聤ʁʁ. 
, āȁƁ؁, ΁ρρЁ􁥁끤ǁɁƁ߁聤. 
āǁ, ρȁ偤΁ʁ󁤁ځ쁤ʁ聤́́Ɂˁ聤
(<tt>DCL.sgpset('lfull',true)</tt>). 
</p><br>

<a name='line_2'></a>
<p><a href="line_2.rb">line_2.rb</a>
<table width=80%><tr><td><pre class="source">
1: require "numru/ggraph"
2: include NumRu
3: gphys = GPhys::IO.open('T.jan.nc', 'T')
4: DCL.gropn(1)
5: DCL.sgpset('isub', 96)   # control character of subscription: '_' --> '`'
6: DCL.sgpset('lfull',true) ; DCL.uzfact(0.6)
7: GGraph.set_fig( 'itr'=> 2, 'viewport'=>[0.25,0.7,0.15,0.6] )
8: GGraph.line( gphys.cut(135,35,false), true, 'exchange'=>true )
9: DCL.grcls
</pre></td></tr></table>
</p><br>

<p><a href='line_2.png'>line_2.rbԁ끲<br><img src='line_2s.png'></a><br>

<p> 偤΁ׁ큥遥ǁ, āЁ􁥁ꁥ󁥁ˁ끤, 6ԁ́܁
GGraph.fig ΁ׁ灥 <tt>itr</tt> ߁āꁤƁ
(<a href="http://ruby.gfd-dennou.org/products/gphys/doc/ggraph.html" target=_top>GGraphށˁ健</a>). 
΁쁹, 󁥁ȁ큡ʁ́ˁ끤, ˁā끥遥ف끤ށȁʁʁ끤΁,
<tt>DCL.sgpset('lcntl', false)</tt> ǁ́ˁ끤΁ǁρʁ,
5ԁ́܁ <tt>DCL.sgpset('isub', 96)</tt> , ā򁼁 '_'  '`'
ˁʁс. 
遤, ́́ɁˁƁ, viewport ʁсƁ끡ʁǁՁ끥ȁÁ́
[0.2,0.8,0.2,0.8]. 
GGraph.fig ρށ΁ρȁāꁵ끥ၥÁɁǁ, 
GGraph.line ΁聣􁤁 true ΁ȁƁЁ쁤. 聣􁤁ρʁ΁āǁ
true ρǁՁ끥ȁÁ́ǁ. 
7ԁ́܁ GGraph.line 򁸁Ɓ󁤁ǁ끤, GGraph.line ΁ׁ灥󁤁ρ聣
(ʁ)ǁ끤΁, 2􁤁 true ́ہˁ߁āꁤƁ끡ʁցつ䁤
ǁ2􁤁 true/false ʁʁ΁びˁ聤ꁥ恡ˁā́Á΁끡. 
, ׁ灥󁤁ȁ <tt>'exchange'=>true</tt> 򁻁؁āꁤƁ. 
쁤ˁ聤, ǁՁ끥ȁȁՁ, Ɂ򁽁ā, ǁ򁲁ˁ񁤁聤ˁʁ. 
ׁ灥󁤁ˁāƁρށ偤ǁ⁤. 

<hr>
<a name="h2:file_fomats">
<p><h2>́́ʁՁ끷</h2><br>
</a>

<p> GPhys ǁ NetCDF, GrADS, grib ΁Ձ끤Ɓ聤
ȁЁ́聤. Á΁ȁ GrADS ǁ΁񁤁Ёρ݁ȁʁ.

<a name="h3:file_hanbetsu">
<p><h3>Ձ끷΁ȁʁ</h3><br>
</a>

<p> <tt>GPhys::IO.open(file, varname)</tt> ˁ, 
<tt>file</tt> ρʁ΁󁤁ǁɁс, ށ NumRu::NetCDF ŁՁ끤ā܁Ɂ끥遥΁ցȁ򁼁聤쁤.
с΁쁹, Ձ끤΁΁ρƁŁˁȁʁ́쁤. ΁끡끤ρ΁ā́ꁤǁ.
<ol>
 <li> ՁÁ 'nc', 'ctl', 'grib': 쁤 NetCDF, GrADS,
      grib 򁲁ā. 
 <li> 쁰ʁ. Ձ끤΁ǁ遤΁ہƁɁ󁤁ǁȁʁ́. 
</ol>

<p> Ձ끷́ہˁ؁āꁤƁƁɁ߁ȁ⁤ǁ. 쁤, 
    <tt>GPhys::NetCDF_IO.open</tt>, <tt>GPhys::GrADS_IO.open</tt>,
    <tt>GPhys::Grib_IO.open</tt> ́с.


<a name="h3:grads_grib_examples">
<p><h3>GrADS,gribՁɁ΁</h3><br>
</a>

<p> ΁ׁ큥遥, 偵
<a href="#contour1000mb_1">contour1000mb_1.rb</a>
3ԁ́܁ǁՁ́
<tt>T.jan.nc</tt>  <tt>T.jan.ctl</tt> ˁʁс΁⁤΁ǁ.
쁰ʁρƁׁ큥遥 GrADS ΁ǁɁ聤ǁ.

<p><a href="contour1000mb_grd.rb">contour1000mb_grd.rb</a>
   <a name="contour1000mb_grd"></a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/ggraph"
 2: include NumRu
 3: gphys = GPhys::IO.open('T.jan.ctl', 'T')
 4: DCL.gropn(1)
 5: DCL.sgpset('lcntl', false) ; DCL.uzfact(0.7)
 6: GGraph.contour( gphys )
 7: DCL.grcls
</pre></td></tr></table>
<br>

<p> Ɓ́́, ΁ׁ큥遥 grib Ձ끤΁ǁɁ聤.
ԁˁ, GPhys 0.4.0 ʁ偤Ɂׁ́ǁ.  

<p><a href="contour1000mb_grib.rb">contour1000mb_grib.rb</a>
   <a name="contour1000mb_grib"></a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/ggraph"
 2: include NumRu
 3: gphys = GPhys::IO.open('T.jan.grib', 'TMP')
 4: DCL.gropn(1)
 5: DCL.sgpset('lcntl', false) ; DCL.uzfact(0.7)
 6: GGraph.contour( gphys )
 7: DCL.grcls
</pre></td></tr></table>
<br>

<p> 偤ǁ, ʁс́쁤ށǁ 'T' ǁʁ 'TMP' ȁʁÁƁ끤ȁˁÁ큰.
gribՁÁ恤ǁρʁс􁤁ρ́򁻁, ʁс􁤁΁΁ˁƁ聤ށÁȁց
끤ǁ. <tt>GPhys::Grib_IO</tt> ˁƁρ΁ȁց恤
<a href="http://www.cpc.ncep.noaa.gov/products/wesley/wgrib.html">wgrib
</a>ǁȁ쁤Ɓ́򁳁䁤ŁƁƁ. 쁤, ˁ؁Ɓ
'TMP' ʁ΁ǁ. Á, 
wgrib ǁρƁʁс􁤁ǁ⁰ہʁʁ􁤁΁́ȁ쁤Ɓ끤ȁ끤΁, 
wgrib ށ󁥁Ɂ΁݁΁Ё΁ρ <tt>GPhys::Grib_IO</tt> 
ˁʁс́ρɁ⁰Áׁʁ. 
ǁρɁ쁤Ё΁ɁˁāƁρ򁻁ȁ΁.

<a name="h3:inspect_var_names">
<p><h3>ՁÁ恤΁ʁс́΁āفʁ</h3><br>
</a>

<p> NetCDFՁ끤ǁ쁤,
<a href="#h2:data">偵΁聤</a>ށ󁥁Ɂ遥󁤁 <tt>ncdump</tt>
ށ󁥁Ɂǁāف遤쁤. GrADSՁ끤ǁ쁤, 
󁥁ȁ큡끥Ձ끤ρƁȁʁ΁ǁ쁤򁸁쁤Ё聤.
, GPhys ́с쁤, Ձ끤΁΁ˁ́Ɓʁˁǁāف遤쁤.

<a name='inspect_varnames'></a>
<p><a href="inspect_varnames.rb">inspect_varnames.rb</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/gphys"
 2: p NumRu::GPhys::IO.var_names('T.jan.grib')
 3: p NumRu::GPhys::IO.var_names('T.jan.ctl')
 4: p NumRu::GPhys::IO.var_names('T.jan.nc')
</pre></td></tr></table>
</p><br>

<p> 끲́ρ΁ā́ꁤǁ.

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby inspect_varnames.rb</span>
["TMP"]
["T"]
["lon", "lat", "level", "T"]
</pre></td></tr></table>

<p> gribՁ끤ˁ "TMP", GrADS, NetCDF Ձ끤ˁ "T" 
ȁʁс􁤁끤ȁ. NetCDFՁ끤ǁρˁ"lon",
"lat", "level" ȁʁс́⁤ǁ끤, NetCDF 
ǁρ쁤遺Ɂʁс􁤁⁼ʁȁ򁺁Ɂʁс􁤁ȁ GPhys 
ցȁȁ <tt>GPhys::IO.open</tt> ǁȁǁ.
, 쁤΁ၤˁׁ큥遥򁥁Ձ끤ˁ끤΁ρ́́Ł݁ȁׁ쁤聤. , ЁρÁŁʁ́́сˁ򁾁ҁ.

<hr>
<a name="h2:irb">
<p><h2>irb́сЁρÁ́́(1)</h2><br>
</a>

<p> Ruby ˁɁŁɁՁ irb ȁށ󁥁Ɂ, 
ЁρÁŁʁÁ灥󁤁ˁ ruby ΁ׁ큥遥򁹁ԁÁ́ǁ򁼁ၤԁ
shell ΁聤ʁ⁤΁ǁ. , emacs 偤ǁԁ irb-shell
ȁ⁤΁⁤. ʁ,
<a href='#inspect_varnames'>偵΁ʁс́ā</a> irb 
ǁԁÁ끲́򁥁Áȁ󁥁Ɂځȁ⁤΁ǁ.
<tt>irb(main):001:0></tt>
Ł irb ΁ׁ큥󁥁ׁ, <tt>=></tt> ʁρƁԁ΁ԁ끲́΁Ё΁ρǁ. 

<table width=80%><tr><td><pre class="source">
% <span class="command">irb</span>
irb(main):001:0> <span class="command">require "numru/gphys"</span>
=> true
irb(main):002:0> <span class="command">include NumRu</span>
=> Object
irb(main):003:0> <span class="command">GPhys::IO.var_names('T.jan.grib')</span>
=> ["TMP"]
irb(main):004:0> <span class="command">GPhys::IO.var_names('T.jan.ctl')</span>
=> ["T"]
irb(main):005:0> <span class="command">GPhys::IO.var_names('T.jan.nc')</span>
=> ["lon", "lat", "level", "T"]
</pre></td></tr></table>

<p> 1ԁ́܁΁Ɓ΁ρ, 쁤ށǁ <tt>require "numru/ggraph"</tt>
ȁつ, <tt>require "numru/gphs"</tt> ȁʁÁƁ. 
끤 GPhys ˁ܁΁ƁɁ߁ށ, 
遥ՁÁ遥ց遥ꁡ GGraph ρƁɁ߁ށ쁤ʁ.
(́ށρށ򁽁񁤁ʁ쁹灤ǁ <tt>require "numru/ggraph"</tt> ǁʁ,
΁ہぴ΁偤ၤǁ큤.)

<p> irb ρǁՁ끥ȁǁρށ󁥁Ɂ΁ԁ끲́ p ǁɁ끤΁,
<a href='#inspect_varnames'>偵΁ׁ큥遥</a>ȁہʁ,
́ہˁ p 򁤁āƁʁ.

<a name="h3:irb_startup">
<p><h3>ȁÁׁՁ끤΁́́(1)</h3><br>
</a>

<p> irb ΁Á灥󁳁ρˁˁ聲 <tt>require "numru/gphys"</tt>,
<tt>include NumRu</tt> ʁɁ΁ցށʁׁ򁸁Ɓց΁ρ́́Ł݁ʁ΁,
ȁÁׁՁ끤́́сƁƁ끤ȁ΁Ɂ. 

<ul>
  <li> ʁˁ: ہǁ쁥ȁꁡ .irbrc ȁՁ끤́сՁ,
       ǁ遤ˁԁɁ򁽁񁤁Ɓ, irb ΁Ɓ require
       쁤. 
  <li> ʁˁ: irb́́с끤ȁˁˁˁ쁤ԁ쁤끤΁ǁ쁤,
       ŁŁʁՁ끤 require فɁ򁽁񁤁Ɓ,
       쁤򁼁ԁ irb ʁ́́ǁ́сՁ. 
</ul>

<p> Ɂԁρ΁ʁˁ򁼁聤ÁƁ. ʁˁ΁ʁ΁΁΁つ򁤁ၤ. 

<p><h4>.irbrc ́́с΁ (ʁˁ)</h4><br>

<p> GPhys ρ́́с끤, GGraph ρ́́сʁ쁹.

<table width=80%><tr><td><pre class="source">
% <span class="command">cat ~/.irbrc</span>
require "numru/gphys"
include NumRu
% <span class="command">irb</span>
irb(main):001:0> <span class="command">GPhys::IO.var_names('T.jan.grib')</span>
=> ["TMP"]
irb(main):002:0> <span class="command">GPhys::IO.var_names('T.jan.ctl')</span>
=> ["T"]
irb(main):003:0> <span class="command">GPhys::IO.var_names('T.jan.nc')</span>
=> ["lon", "lat", "level", "T"]
</pre></td></tr></table>

<p> GGraph ́́с끾쁹灤΁΁.

<table width=80%><tr><td><pre class="source">
% <span class="command">cat ~/.irbrc</span>
require "numru/ggraph"
include NumRu
include GGraph
DCL.swpset('iwidth',700)   # image width
DCL.swpset('iheight',700)  # image height
DCL.swpset('lwait',false)  # don't wait mouse click to show the next page
DCL.gropn(1)
DCL.sgpset('isub', 96)     # control character of subscription: '_' --> '`'
DCL.sgpset('lfprop',true)  # to use the propotional font
</pre></td></tr></table>

<p> ΁聤, <tt>require "numru/gphys"</tt>, <tt>include NumRu</tt>
ˁÁ, ށ򁤁끾偤ǁā́ˁƁց́΁ၤ򁼁ԁ끤聤ˁƁȁ΁Ɂ.
ʁ, 偤ǁρ́́΁ǁՁ끥ȁ 700700 ˁ,
Ɂ聻΁ԁ򁤁ʁƁށꁥÁʁǁ΁ځɁ쁤끤聤ˁ,
āŁɁၤ΁󁥁ȁ큡ʁ <tt>_</tt>  <tt>`</tt>
ˁʁс끤ʁɁƁ. ȁÁׁՁ끤߁āꁤƁ,
΁聤 irb Ɓ偤ˁԁƁ΁ρ끤ǁށЁ.
ʁ, html ΁Łԁ灾, 灸́ρсˁƁ.

<table width=80%><tr><td><pre class="source">
% <span class="command">irb</span>
 *** MESSAGE (SWDOPN) ***  GRPH1 : STARTED / IWS =  1.                         
irb(main):001:0> <span class="command">gphys = GPhys::IO.open('T.jan.nc', 'T')</span>
=> &lt;GPhys grid=&lt;3D grid &lt;axis pos=&lt;'lon' in 'T.jan.nc'  sfloat[36]&gt;&gt;
        &lt;axis pos=&lt;'lat' in 'T.jan.nc'  sfloat[19]&gt;&gt;
        &lt;axis pos=&lt;'level' in 'T.jan.nc'  sfloat[9]&gt;&gt;&gt;
   data=&lt;'T' in 'T.jan.nc'  sfloat[36, 19, 9]&gt;&gt;
irb(main):002:0> <span class="command">contour( gphys.mean(0) )</span>
=> nil
</pre></td></tr></table>

<p> , <tt>gphys = GPhys::IO.open('T.jan.nc', 'T')</tt>
΁끲́΁Ё΁ρ΁ʁρ偤ǁ⁤. 2ԁ́܁΁Ɓ΁ρˁ
<tt>mean(0)</tt> ρǁ遤΁(ၷЁŁ)ˁ؁ʁсǁ.
܁<a href="#h3:heikin sonota">遤򁻁</a>΁.

<p><a href='irbsample_contour1.png'>偵 irb Á灥󁼁ԁ끲<br><img src='irbsample_contour1s.png'></a><br><br>

<a name="h4:irb_start_up_no_irbrc">
<p><h4>.irbrc ́́сʁ΁ (ʁˁ)</h4><br>

<p>΁聤, irb ΁ȁÁׁՁ끤ȁƁρǁ쁤ʁ
́΁Ձ끤ˁԁ끥Ɂ򁽁񁤁ꁥǁƁ끤聤ˁ.
ʁ alias  .cshrc ʁɁˁ񁤁󁤁ǁȁ΁Ɂ.

<a name="souce .irbrc_ggraph">
<table width=80%><tr><td><pre class="source">
% <span class="command">alias irb_ggraph  'irb -r ~/.irbrc_ggraph'</span>
% <span class="command">cat ~/.irbrc_ggraph.rb</span>
require "numru/ggraph"
include NumRu
include GGraph
DCL.swpset('iwidth',700)   # image width
DCL.swpset('iheight',700)  # image height
DCL.swpset('lwait',false)  # don't wait mouse click to show the next page
DCL.gropn(1)
DCL.sgpset('isub', 96)     # control character of subscription: '_' --> '`'
DCL.sgpset('lfprop',true)  # to use the propotional font
</pre></td></tr></table>

<p>΁聤ˁ끤, GGraph ΁Á灥́с irb  irb_ggraph
ȁ́ǁ߁āꁤ쁤. 䁤ρꁲ΁聤2ԁǁށǁ.

<table width=80%><tr><td><pre class="source">
% <span class="command">irb_ggraph</span>
 *** MESSAGE (SWDOPN) ***  GRPH1 : STARTED / IWS =  1.                         
irb(main):001:0> <span class="command">gphys = GPhys::IO.open('T.jan.nc', 'T')</span>
=> &lt;GPhys grid=&lt;3D grid &lt;axis pos=&lt;'lon' in 'T.jan.nc'  sfloat[36]&gt;&gt;
        &lt;axis pos=&lt;'lat' in 'T.jan.nc'  sfloat[19]&gt;&gt;
        &lt;axis pos=&lt;'level' in 'T.jan.nc'  sfloat[9]&gt;&gt;&gt;
   data=&lt;'T' in 'T.jan.nc'  sfloat[36, 19, 9]&gt;&gt;
irb(main):002:0> <span class="command">contour( gphys.mean(0) )</span>
=> nil
</pre></td></tr></table>

<p> Ɂԁρ΁ʁˁ򁰁́сƁ.

<hr>
<a name="h2:gphys nakami">
<p><h2>GPhys΁Á恿ȁāف</h2><br>
</a>

<p>
ށ򁽁񁤁ˁǁ΁Á恿ȁ򁴁ʁÁˁāفʁˁ́. 
偤ǁҁ Ruby ΁ЁρÁ irb 򁻁ȁȁˁ聤. 
偡ȁꁥ끤ȁƁ΁ȁƁ́с΁,
ȁÁׁՁ끤ρȁʁ⁤΁ȁ. ȁÁƁ끾쁹灤
ǁ遤΁􁹁ԁŁʁ΁쁤Ё΁Ɂ.
ʁ kterm ΁́́򁥁Áȁ󁥁Ɂځȁ⁤΁ǁ끤, 
html ΁Łԁ灾, 灸́ρсˁƁ. 
<table width=80%><tr><td><pre class="source">
% <span class="command">irb</span>
irb(main):001:0> <span class="command">require "numru/gphys"</span>
=> true
irb(main):002:0> <span class="command">include NumRu</span>
=> Object
irb(main):003:0> <span class="command">T</span>   ǁ T ȁƁ쁤Ɓց򁣁Ɓ΁ (΁聤ˁՁ́Ёʁ⁤)
T.jan.ctl   T.jan.dat   T.jan.grib  T.jan.nc    ToDo        
irb(main):003:0> <span class="command">GPhys::IO.var_names('T.jan.nc')</span>  # for GPhys >= 0.4.0
=> ["lon", "lat", "level", "T"]
irb(main):004:0> <span class="command">gphys = GPhys::IO.open('T.jan.nc', 'T')</span>
=> &lt;GPhys grid=&lt;3D grid &lt;axis pos=&lt;'lon' in 'T.jan.nc'  sfloat[36]&gt;&gt;
        &lt;axis pos=&lt;'lat' in 'T.jan.nc'  sfloat[19]&gt;&gt;
        &lt;axis pos=&lt;'level' in 'T.jan.nc'  sfloat[9]&gt;&gt;&gt;
   data=&lt;'T' in 'T.jan.nc'  sfloat[36, 19, 9]&gt;&gt;
irb(main):005:0&gt; 
</pre></td></tr></table>

<p> irb ρƁԁ򁼁ԁ끲́, ǁɁ؁ p 򁻁ȁÁƁɁЁ΁ρˁЁ΁ρ. 
p ˁ聤ɁρɁ偺΁ȁρ遤ʁ, ʁ؁́ǁ. 
1,2ԁ́܁΁Ɓ΁(001,002)ρā⁤΁ށʁǁ. 
3ԁ́܁ǁ <tt>T</tt> ˁ TAB 2Ɓ΁ρƁ߁聤. 
΁ T 遻ρށ끥Ձ́΁ꁥȁɁ쁤끤ρǁ.
쁤ρ遤 irb ΁΁ǁǁʁ, Ɓ΁ρ򁻁ʁ readline
ȁ遥ց遥ꁡ΁ǁʁ΁, ʁ遤ʁ⁤.
Ɓ䁤āˁʁ끼݁3ԁ́܁΁Ɓ΁ (Łف́܁003) , GPhys 0.4.0
ǁ݁ȁ쁤؁ <tt>GPhys::IO.var_names</tt>
́сƁՁÁ恤 GPhys āǁʁʁс́Ɂ.
Ɓԁ́܁΁Ɓ΁ρǁρʁс 'T' ˁ؁ GPhys ցȁ򁺁
(<tt>gphys = GPhys::NetCDF_IO.open('T.jan.nc', 'T')</tt>). 
΁끲́ p ǁɁ쁤⁤΁ρԁˁÁƁ. ˁ, 
lon, lat, level ΁ǁ T ȁʁÁƁ, 쁤쁤Ձ
T.jan.nc ˁʁǁ쁤Ɓ끤ȁƁ聤쁤. Á́䁳Ɓ΁ā
Ɂ쁤Ɓ. ΁ʁفʁ Fortran ȁƁ́́,
ցȁցށ끡ׁǁ遤ˁ́聤(<a href="#ncdumped">򁻁</a>). 
</p><br>

<p>
ǁ, ΁ׁ큥遥򁼁ԁ聤. 
</p><br>

<a name='inspect'></a>
<p><a href="inspect.rb">inspect.rb</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/gphys"
 2: include NumRu
 3: p gphys = GPhys::NetCDF_IO.open('T.jan.nc', 'T')
 4: p 'name = '+gphys.name, 'rank:',gphys.rank, 'shape:', gphys.shape
 5: print '[1st dim]  name:', gphys.coord(0).name, 
 6:      '  long_name:',gphys.coord(0).get_att('long_name'),
 7:      '  units:',gphys.coord(0).get_att('units'),
 8:      "  min,max:#{gphys.coord(0).min},#{gphys.coord(0).max}\n"
 9: prs = gphys.coord(2).val
10: t_jpn = gphys.cut(135,35,true).val
11: print "\n#{gphys.coord(0).name}\t#{gphys.name}\n"
12: for i in 0...prs.length do
13:   print prs[i], "\t", t_jpn[i], "\n"
14:end
</pre></td></tr></table>
</p><br>

<p> Łف irb 򁻁ȁʁ΁ p ρ́ہˁƁЁʁ쁤Ёʁ遤ʁ (3ԁ́ etc). 
ʁˁԁ끲́򁼁. 
</p><br>

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby inspect.rb</span>
&lt;GPhys grid=&lt;3D grid &lt;axis pos=&lt;'lon' in 'T.jan.nc'  sfloat[36]&gt;&gt;
        &lt;axis pos=&lt;'lat' in 'T.jan.nc'  sfloat[19]&gt;&gt;
        &lt;axis pos=&lt;'level' in 'T.jan.nc'  sfloat[9]&gt;&gt;&gt;
   data=&lt;'T' in 'T.jan.nc'  sfloat[36, 19, 9]&gt;&gt;
"name = T"
"rank:"
3
"shape:"
[36, 19, 9]
[1st dim]  name:lon  long_name:Longitude  units:degrees_east  min,max:0.0 degrees_east,350.0 degrees_east

lon     T
1000.0  -5.50255870819092
850.0   -13.0088624954224
600.0   -23.8766059875488
400.0   -41.1900672912598
250.0   -52.6089935302734
150.0   -51.7955780029297
70.0    -55.255916595459
30.0    -51.0108757019043
10.0    -43.6157722473145
</pre></td></tr></table>

<p>
ׁ큥遥 4 ԁ́܁ʁ߁򁲁⁤聤. 
</p><br>

<p>
4 ԁ́:
<p>
<pre>
     p 'name = '+gphys.name, 'rank:',gphys.rank, 'shape:', gphys.shape
</pre>
<p>
 GPhys ցȁ΁́(name), 
(rank), Ɓ΁ā(shape)Ɂ. 
</p><br>

<p>
58 ԁ́:
<p>
<pre>
     print '[1st dim]  name:', gphys.coord(0).name, 
          '  long_name:',gphys.coord(0).get_att('long_name'),
          '  units:',gphys.coord(0).get_att('units'),
          "  min,max:#{gphys.coord(0).min},#{gphys.coord(0).max}\n"
</pre>
<p>
ρ΁́΁ၤǁ.  5,6,7 ԁ󁥁ށǁ끤, 
с΁Ɂׁ́́遤遤򁼁ၤ쁤. 
<tt>gphys.coord(<i>idim</i>)</tt> , <tt><i>idim</i></tt>ȁց́܁΁
(0避􁤁) ΁ɁÁ́򁳁ʁǁ끥ǁʁցʁʁ, GPhys
ρɁÁ́ʁˁ⁳Ɓˁ؁끾ʁ󁤁́ƁɁ́끤聤ˁʁÁƁ. 
Ɓˁ؁끾ʁ󁤁 <tt>gphys.axis(<i>idim</i>)</tt> ǁƁ遤, 
ɁÁ́ρ쁤 <tt>pos</tt> ၥÁɁŁ́с끤ȁǁƁ遤쁤. 
āށ, <tt>gphys.axis(<i>idim</i>).pos</tt> 
<tt>gphys.coord(<i>idim</i>)</tt> ȁƁ끲́ʁց. 
ǁρʁÁ΁ၤ쁰ʁ偤΁⁤ρʁ. 
ɁÁ́, VArray (Virtual Array) ȁ, 
ǁہ΁󁤁ȁˁ܁ŁˁρƁǁ򁻁ā遥΁ցȁʁց. 
VArray , ΁Á́ǁˁÁ, ́ȁǁՁā΁ց
򁻁āȁЁ́聤. ȁρǁՁ΁́(ʁ΁)ȁÁ́΁ȁ, 
Á́΁Ł́́ NetCDF ȁƁ́́ǁ(Á́1ǁہ΁󁤁ށρʁ΁). 
VArray ΁ǁˁ܁΁ NArray ǁ⁤聤, NetCDF
ՁÁ恤΁ʁс􁤁ǁ⁤聤. ǁρ偼ԁǁ. ΁쁹,
Ɂׁ́ˁʁ끤ށǁǁ΁ƁɁ߁߁ρԁ쁤ʁ. 聤Á,
灤ʁǁՁ끤򁳁ȁāˁၥ⁥ꁡ򁰁ǁ끤ȁˁρʁ遤ʁ. 
ׁ큥遥 58 ԁ́܁ȁЁ΁ρ򁸁ȁ恤ف끤, 
<tt>gphys.coord(0).name</tt> ρ́, 
<tt>gphys.coord(0).get_att('long_name')</tt> ρ long_name 
<tt>gphys.coord(0).max</tt> ρɁÁ́΁ǁÁ́ʁցȁʁɁ끤ǁ큤. 
߁ʁƁɁ߁⁤ȁ끤, ʁցÁ́ nil ȁʁ
(΁びρȁʁ). 
</p><br>

<p>
9ԁ́(<tt>prs = gphys.coord(2).val</tt>)ǁ, (큤避􁤁)2, 
΁ (ʁс́<tt>level</tt>) ΁Á́ƁɁ߁. VArray ΁ၥÁ val 
ǁ΁Á́ NArray ǁʁց. ÁƁǁ (ǁ遤ၤ)
Ձ끤遤΁ʁсÁ́΁ƁɁ߁߁ȁ. 
</p><br>

<p>
10ԁ́(<tt>t_jpn = gphys.cut(135,35,true).val</tt>)ǁ, 
Ɓˁ܁ɁՁၤ΁āׁ큥Ձ끤󁤁偤, ǁƁɁ߁. 
ǁƁɁ߁߁΁Ł́́ˁāƁ, ΁ၤǁ⁤. 
</p><br>

<p>
11ԁ́܁ρ쁤쁤΁́(name)Ɂ, 
1214 ԁ́܁ǁƁʁҁŁǁ΁΁ρȁ΁Á́򁽁񁽁Ё. 
</p><br>

<hr>
<a name="h2:gdir">
<p><h2>ǁ쁥ȁꁡ򁥁ց遥 -- GDir΁́́</h2><br>
</a>

<p>
GPhys-0.5.0 聤ꁡGPhys ́сˁՁ끥ƁÁ恤΁ǁ쁥ȁꁡɁ
끥遥 GDir ƁƁ쁤Ruby ȁ߁߁ Dir ȁƁ́́ǁ끤ǁ灤
つ

<ul>
  <li> GPhysāǁʁʁс􁤁򁼁ၤ끥Ձ끤ρǁ쁥ȁꁡȁ
       GDir ցȁˁǁ
</ul>

<p>
ȁǁ끡NetCDF ʁɁ΁Ձ끤 "cd" ʁс􁤁 "ls" 끤
ȁЁ́聤끡ʁ́, HDF  NetCDF-4 ʁɁՁÁ恤ˁǁ
쁥ȁꁡ򁤁ȁ쁤끷򁥁݁ȁ끺݁ˁρ쁤 GDir ց
ȁˁЁ́聤끤聤ˁ́āꁤǁ끡

<p>
偵ʁ΁灤ʁつˁρ΁聤ˁʁ끡

<ul>
  <li> GDir ˁȁÁƁ root ǁ쁥ȁꁡρՁ끥ƁÁ恤΁ǁ
       ΁ǁ쁥ȁꁡˁ߁āꁤǁ끡΁쁹灡끡ȁǁ쁥ȁꁡ
       āꁡƁ⁤ˁʁǁ쁥ȁꁡρ끤ȁǁʁ
  <li> Dir 遥΁Ɓ΁ၥÁɁ򁥁݁ȁƁ끤ǁρʁ
  <li> Dir 遥ˁρʁၥÁɁǁ끡΁つЁǁ쁥ȁꁡƁ⁤
       ls 끺݁ǁہ΁ǁ쁥ȁꁡʁс(ǁՁ끤Ɂ
       끾쁹)ƁȁՁ끤ȁȁÁǁ쁤끥Ձ끡3򁶁ʁ
       끤ȁǁ끡
</ul>

<p>
܁<a href="http://ruby.gfd-dennou.org/products/gphys/doc/gdir.html">
Gdir΁󁥁遥󁥁ށˁ健</a>򁻁ȁ΁ȁ

<a name="h3:gdir-sample1">
<p><h3>GDiŕ́с΁(1)</h3><br>
</a>

<p>
GDir  irb ́сЁρÁ́́сˁŁƁ끡́́сˁ݁Ɓρ
<a href="#h3:irb_startup_gdir">ȁÁׁՁ끤ˁƁȁ</a>
ȁʁ؁́ǁ끤ǁρԁځȁǁ́́сǁ끤聤
 irb ˁ́́сˁ򁼁

<table width=80%><tr><td><pre class="source">
% <span class="command">pwd</span>
/hogehoge/TUTORIAL
% <span class="command">irb</span>
irb(main):001:0> <span class="command">require "numru/gphys"</span>
=> true
irb(main):002:0> <span class="command">include NumRu</span>
=> Object
irb(main):003:0> <span class="command">GDir.top</span>
=> "/"                      # ǁՁ끥ȁ΁ȁÁׁǁ쁥ȁꁡ
irb(main):004:0> <span class="command">GDir.top = Dir.pwd</span>    # ȁÁׁǁ쁥ȁꁡ򁸁߁΁ǁ쁥ȁꁡˁʁс
=> "/hogehoge/TUTORIAL"
irb(main):005:0> <span class="command">GDir.pwd</span>
=> "/"     # 쁥󁥁ȁǁ쁥ȁꁡ΁ǁՁ끥ȁρȁÁׁʁՁ끥Ɓ끡ȁȁρつ
irb(main):006:0> <span class="command">GDir.ls</span>
Directories:
  'T.jan.ctl/'           # GPhys āǁʁʁс􁤁򁼁ၤՁ끤
  'T.jan.grib/'          # ǁ쁥ȁꁤȁƁɁ쁤
  'T.jan.nc/'
  'testdir/'             # 쁤ρہ󁤁ȁˁǁ쁥ȁ
Text files?:         # Ɂ健ၥ󁥁ȁŁ遤쁤끤聤ˁƁȁՁ끤遤
  'ToDo'             # ⁤΁ρɁ쁤끡΁΁Ձ끤ρ́끤쁤
irb(main):007:0> <span class="command">GDir.ls_l</span>      # 聤ꁾ܁Ɂ
Directories:
         423  Sep 16  2003 T.jan.ctl/       # Ձ끥Ɓ́
       13167  Mar 10 13:03 T.jan.grib/
       26664  Aug 28  2003 T.jan.nc/
         512  Jul 21 13:13 testdir/
Text files?:
         206  Mar 23  2004  ToDo
=> nil
irb(main):008:0> <span class="command">GDir.cd 'T.jan.nc'</span>
=> /T.jan.nc/
irb(main):009:0> <span class="command">GDir.ls</span>
Data:            # Data: ȁƁɁ쁤끤΁ρGPhysāǁʁʁс
  'lon'          # NetCDF ΁쁹灡Ɂʁс􁤁⁤쁼ȁ򁺁Ɂˁ⁤ GPhys 
  'lat'          # ȁƁ끤΁ǁ́Ɂ쁤끡
  'level'
  'T'
=> nil
irb(main):010:0> <span class="command">GDir.ls_l</span>     # 聤ꁾ܁
Data:
  lon   [lon=36]        'Longitude'     (degrees_east)
  lat   [lat=19]        'Latitude'      (degrees_north)
  level [level=9]       'Level' (millibar)
  T     [lon=36,lat=19,level=9] 'Temperature'   (degC)
=> nil
irb(main):022:0> temp = GDir.data 'T'  # 쁥󁥁ȁǁ쁥ȁꁡ΁ʁс􁤁򁳁
=> &lt;GPhys grid=&lt;3D grid &lt;axis pos=&lt;'lon' in '/hogehoge/TUTORIAL/T.jan.nc'  sfloat[36]&gt;&gt;
        &lt;axis pos=&lt;'lat' in '/hogehoge/TUTORIAL/T.jan.nc'  sfloat[19]&gt;&gt;
        &lt;axis pos=&lt;'level' in '/hogehoge/TUTORIAL/T.jan.nc'  sfloat[9]&gt;&gt;&gt;
   data=&lt;'T' in '/hogehoge/TUTORIAL/T.jan.nc'  sfloat[36, 19, 9]&gt;&gt;
</pre></td></tr></table>

<p>
΁聤ˁՁ끤⁴ށၥǁ쁥ȁꁡȁƁȁǁ
؁Łˁ́쁤ǁÁȁ遽ˁ΁ʁс􁤁Á
GPhys ցȁȁƁȁǁ끡

<a name="h3:gdir-sample2">
<p><h3>GDiŕ́с΁(2)</h3><br>
</a>

<p>
偤΁΁つǁρGDir ΁쁥󁥁ȁǁ쁥ȁꁡGDir΁遥ʁс􁤁ˁʁÁƁ
끡ˁ΁߁́с΁ǁGDir ցȁρ́ہˁρ쁤ʁÁŁفρ
GDir ցȁ򁰁΁つ򁼁

<table width=80%><tr><td><pre class="source">
% <span class="command">irb</span>
irb(main):001:0> <span class="command">require "numru/gphys"</span>
=> true
irb(main):002:0> <span class="command">include NumRu</span>
=> Object
irb(main):003:0> <span class="command">GDir.top = Dir.pwd</span>    # ȁÁׁǁ쁥ȁꁡ򁸁߁΁ǁ쁥ȁꁡˁʁс
=> "/hogehoge/TUTORIAL"
irb(main):004:0> <span class="command">dir = GDir.cwd</span>   # 쁥󁥁ȁǁ쁥ȁꁡ򁼁Ɓ
=> /
irb(main):005:0> <span class="command">dir.class</span>
=> NumRu::GDir        # dir  GDir ցȁǁ
irb(main):006:0> <span class="command">dir.ls</span>
Directories:
  'T.jan.ctl/'
  'T.jan.grib/'
  'T.jan.nc/'
  'testdir/'
Text files?:
  'ToDo'
=> nil
irb(main):007:0> <span class="command">dir2 = dir.dir('T.jan.grib/')</span>
=> /T.jan.grib/
irb(main):008:0> <span class="command">dir2.ls_l</span>
Data:
  TMP   [lon=36,lat=19,level=9] 'Temperature'   (K)
=> nil
irb(main):009:0> temp = dir2.data('TMP')
=> &lt;GPhys grid=&lt;3D grid &lt;axis pos=&lt;'lon' in 'TMP'  36&gt;&gt;
        &lt;axis pos=&lt;'lat' in 'TMP'  19&gt;&gt;
        &lt;axis pos=&lt;'level' in 'TMP'  9&gt;&gt;&gt;
   data=&lt;'TMP' in '/hogehoge/TUTORIAL/T.jan.grib'  [36, 19, 9]&gt;&gt;
</pre></td></tr></table>

<p>
΁΁つǁρGDir ΁쁥󁥁ȁǁ쁥ȁꁡρȁÁׁǁ쁥ȁꁡ΁ށށ
ցǁ쁥ȁꁡ GDir ցȁȁƁʁʁс́ dir2ˁ
Á恤΁ǁ GPhys ցȁȁƁ

<hr>
<a name="h2:irb-2">
<p><h2>irb́сЁρÁ́́(2)</h2><br>
</a>

<a name="h3:irb_startup_gdir">
<p><h3>ȁÁׁՁ끤΁́́(2) -- GDir ΁́́</h3><br>
</a>

<p>
<a href="#h4:irb_start_up_no_irbrc">ҁ irb ƁɁ߁߁́сՁ
.irbrc_ggraph</a>  GDir ˁ؁߁āꁤāɁÁƁshell ΁聤
irb 򁻁ȁ끤聤ˁ끡shell ΁聤ˁׁȁρls  ls_l ȁǁ
Ёǁ쁥ȁꁡʁс􁤁ꁥȁ쁡cd ǁǁ쁥ȁꁡʁсÁꁡ
ʁÁ GPhys ʁс􁤁ꁡʁށ󁥁Ɂ́ open ȁ끡ˁ끤ȁ
ǁ끡

<a name="souce .irbrc_ggraph(2)">
<table width=80%><tr><td><pre class="source">
% <span class="command">alias irb_ggraph  'irb -r ~/.irbrc_ggraph'</span>
% <span class="command">cat ~/.irbrc_ggraph.rb</span>
print "Start interactive GGraph session\n"

require "numru/ggraph"
include NumRu
include GGraph

#<< GDir Setting >>
GDir.top='/'
GDir.cd(Dir.pwd)
def cwd; GDir.cwd; end        # returns the current working directory of GDir
def pwd; GDir.pwd; end        # prints the current working directory of GDir
def ls(path=nil); GDir.cwd.ls(path); end         # listing
def ls_l(path=nil); GDir.cwd.ls_l(path); end     # verbose listing
alias dir ls_l
def cd(path); GDir.cd(path); end
def open_all_data; GDir.cwd.open_all_data; end  # --> Hash of GPhys objs in cwd
def data(path); GDir.cwd.data(path); end        # --> GPhys
alias open data

#<< Graphic Setting >>
DCL.swpset('iwidth',700)      # window width
DCL.swpset('iheight',700)     # window height
###DCL.swpset('ldump',true)      # dump image files
DCL.swpset('lwait',false)     # do not wait mouse click to show the next page
###DCL.swpset('lalt',true)       # background plot
DCL.sgscmn(10)                # change colomap (see below)
###DCL.sgscmn(5)                 # change colomap (see below)

DCL.gropn(1)
DCL.sgpset('lfprop',true)   # to use the propotional font
DCL.sgpset('lcorner',false) # do not show the corner mark
DCL.sgpset('isub', 96)      # control character of subscription: '_' --> '`'
DCL.glpset('lmiss',true)    # handle data missing
=begin
遡ށÁׁȁց
 1:  dcl_original
 2:  black-orange-yellow-white
 3:  black-blue-cyan-white
 4:  blue-cyan-white-yellow-red
 5:  gray_scale
 6:  pastel_rainbow
 7:  black-rainbow-black
 8:  white_yellow_red
 9:  white_blue_black
 10: short_green_original
 11: black-rainbow-white
 12: pink-rainbow-pink
=end
</pre></td></tr></table>

<p>ǁρ쁤򁻁ȁÁƁǁɁ聤Ɓ߁聤ށ󁥁Ɂ́ρ
偤ǁ alias ˁ聤ꁡirb_ggraph ǁ끡

<table width=80%><tr><td><pre class="source">
% <span class="command">irb_ggraph</span>
Start interactive GGraph session
 *** MESSAGE (SWDOPN) ***  GRPH1 : STARTED / IWS =  1.                         
irb(main):001:0> <span class="command">ls</span>
Directories:
  'T.jan.ctl/'
  'T.jan.grib/'
  'T.jan.nc/'
  'testdir/'
Text files?:
  'ToDo'
=> nil
irb(main):002:0> <span class="command">cd  'T.jan.nc/'</span>
=> /hogehoge/TUTORIAL/T.jan.nc/
irb(main):003:0> <span class="command">ls</span>
Data:
  'lon'
  'lat'
  'level'
  'T'
=> nil
irb(main):004:0> <span class="command">temp = open 'T'</span>
=> &lt;GPhys grid=&lt;3D grid &lt;axis pos=&lt;'lon' in '/hogehoge/TUTORIAL/T.jan.nc'  sfloat[36]&gt;&gt;
        &lt;axis pos=&lt;'lat' in '/hogehoge/TUTORIAL/T.jan.nc'  sfloat[19]&gt;&gt;
        &lt;axis pos=&lt;'level' in '/hogehoge/TUTORIAL/T.jan.nc'  sfloat[9]&gt;&gt;&gt;
   data=&lt;'T' in '/hogehoge/TUTORIAL/T.jan.nc'  sfloat[36, 19, 9]&gt;&gt;
irb(main):005:0> <span class="command">tone temp</span>
=> nil
</pre></td></tr></table>

<p>΁聤 shell ΁聤ˁǁ쁥ȁꁡÁꁤʁ遡ǁ΁ށ
ρǁ끡

<p><a href='tone_irbggp.png'>偵΁Á灥󁤁΁ԁ끲<br><img src='tone_irbggp_s.png'></a><br>
</p><br>

<hr>
<a name="h2:data sousa">
<p><h2>ǁ΁</h2><br>
</a>

<p>
, GPhys
ˁ끥ǁ΁Á́Ɓ. 
灤ʁǁ򁰁݁ˁˁف, ǁƁɁ߁߁ˁ؁Á큰Ձ⁽ҁف. 

<a name="h3:kiridashi">
<p><h3>ځꁽЁ</h3><br>
</a>

<p>
<a href="#cut introduced">偤ǁ</a>, ၥÁ <tt>cut</tt> ˁ聤 GPhys
΁ځꁽЁԁ끤ȁ򁽁ҁف. GPhys ΁ǁځꁽЁၥÁɁˁ
<tt>cut</tt>  <tt>[]</tt> 2΁. <tt>cut</tt>
ρʁ́ŁʁɁ򁻁؁āꁤƁ΁ځꁽЁ򁹁ԁ, <tt>[]</tt> ρǁ΁ʁҁŁ
΁󁥁ǁÁʁǁہ΁󁤁ȁƁ΁ŁˁˁŁځꁽЁ򁹁ԁ. 
ށρ쁤쁤΁Ł́́΁つǁ. 
</p><br>

<p><a href="kiridashi.rb">kiridashi.rb</a>
<table width=80%><tr><td><pre class="source">
require "numru/gphys"
include NumRu
gphys = GPhys::NetCDF_IO.open('T.jan.nc', 'T')
print "gphys: rank=#{gphys.rank} shape=#{gphys.shape.inspect}\n"

gp135 = gphys.cut('lon'=>0..90)           # lon ȁ́΁ 090 Łفށ
print "gp135: rank=#{gp135.rank} shape=#{gp135.shape.inspect}\n"

gprg1 = gphys.cut( 100.0..150.0, 30..50, 850) # 1,2́܁ρȁρ, 3́܁ρÁ́
print "gprg1 rank=#{gprg1.rank} shape=#{gprg1.shape.inspect}",
      "  0th dim: #{gprg1.coord(0).min} .. #{gprg1.coord(0).max}\n"

gprg2 = gphys[ 0..3, -3..-1, 0]               # 偤ȁƁ́́ǁہ΁Łǁ؁ā
print "gprg2 rank=#{gprg2.rank} shape=#{gprg2.shape.inspect}",
      "  0th dim: #{gprg2.coord(0).min} .. #{gprg2.coord(0).max}\n"
p gprg2     # ށɁ
</pre></td></tr></table>
</p><br>

<p>ʁρԁ끲́
</p><br>

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby -Ke kiridashi.rb</span>
gphys: rank=3 shape=[36, 19, 9]
gp135: rank=3 shape=[10, 19, 9]
gprg1 rank=2 shape=[6, 3]  0th dim: 100.0 degrees_east .. 150.0 degrees_east
gprg2 rank=2 shape=[4, 3]  0th dim: 0.0 degrees_east .. 30.0 degrees_east
&lt;GPhys grid=&lt;2D grid &lt;axis pos=&lt;'lon' shape=[4]  subset of a NumRu::VArrayNetCDF&gt;&gt;
        &lt;axis pos=&lt;'lat' shape=[3]  subset of a NumRu::VArrayNetCDF&gt;&gt;&gt;
   data=&lt;'T' shape=[4, 3]  subset of a NumRu::VArrayNetCDF&gt;&gt;
</pre></td></tr></table>
</p><br>

<p>
ǁ偤΁ԁ p ˁ聤끤ǁɁ (<tt>p gprg2</tt>)
΁끲́, 'lon', 'lat', 'T' ΁ǁ쁤
"subset of a NumRu::VArrayNetCDF" ǁ끤ȁ򁼁
 (<tt>VArrayNetCDF</tt>NetCDFʁс􁤁򁤁
ǁہ΁󁤁΁聤ˁ끤ၤ΁Áȁ΁聤ʁ遥ǁ). 
, GPhys ˁ끡ցځꁽЁׁρ, ΁ǁ؁΁ȁρρ
Áȁāꁵ끤ʁ΁ǁ. 
遤, ΁΁つ΁聤 NetCDF ՁÁ恤΁ǁˁ؁ GPhys
ցȁāꁵ쁹, ȁʁ <tt>VArrayNetCDF</tt>
, ƁɁ􁥁ǁȁƁ NetCDF ʁс􁤁؁΁ȁʁ. 
聤Á, 偵 kiridashi.rb 򁼁ԁǁ, 
ʁс􁤁΁Á́ρƁɁ߁ށ쁤ʁʁρɁׁ́ˁƁƁɁ߁ށ쁤끡. 
Á́΁ƁɁ߁߁, ā끲ʁɁ΁ၤˁ݁ˁɁׁ́ˁʁ끤ށǁԁ쁤ʁ΁ǁ. 
</p><br>

<p>
<a href="#contour1000mb_1">ā끲΁ǁ遤΁΁</a>ˁ
<tt>GGraph.contour( gphys )</tt> ǁ, 
聤ǁ遤ˁ΁ցÁ(ǁ؁ǁ)΁ځꁽЁԁ, 
΁偿ށˁɁׁ́ʁǁ΁߁ƁɁ߁. Á, ˁ΁ǁ
100MB΁ǁÁȁƁ́ꁤʁ. 
</p><br>


<p>
, ځꁽЁρȁǁ끤, ⁤⁾偵 <tt>gprg2</tt>
ˁÁ́򁽁񁤁ၤ <tt>gphys</tt>, Ɓ灸 NetCDF
Ձ끤ˁʁсȁǁ쁤끤ȁˁʁ. 
, ǁՁ끥ȁǁρՁ끤 Read-only ǁׁ󁤁쁤끤΁, 
Ɂԁ́сՁˁՁ끤ʁс끿ǁہρ遤ʁ. 
, GPhys::NetCDF_IO.open ΁聰쁰􁤁, NetCDF ցȁށ
ʁ΁󁤁򁼁聤끤ȁˁʁÁƁ. , ⁤ʁ΁󁤁ʁƁɁ􁤁 read-only 
NetCDF ց 򁥁ׁ󁤁Ɓȁ. 
</p><br>

<p>
񁤁߁򁵁쁤, ʁ΁聤, 
́ၽ񁤁߁āǁȁƁׁ󁤁
NetCDF ցȁ GPhys::NetCDF_IO.open ˁ́Ɂׁ́. 
</p><br>

<table width=80%><tr><td><pre class="source">
file = NetCDF.open('T.jan.nc', 'a')        # 'a' ρՁ끤΁ʁԁ򁵁⁡
gphys = GPhys::NetCDF_IO.open(file, 'T')
</pre></td></tr></table>

<p>
<tt>NetCDF.open</tt> ΁􁤁, Ձ́ȁƁЁ΁ρ⁡Ɂʁʁ΁āˁǁ. 
ƁЁ΁ρ⁡Ɂ Ruby ˁȁ߁߁ File 遥΁Ł́́ȁƁǁ
(Ɓ쁤 C 쁤΁Ł́́ȁƁǁ). Á,
NetCDFρˁЁʁꁡǁ끤 'b' ρɁׁ́,
ށɁ΁⁡ɁǁƁɁ߁߁ρāǁǁ.
</p><br>

<a name="h3:heikin sonota">
<p><h3>ʁс䁤΁΁遻ˁā</h3><br>
</a>

<p>GPhys ǁρځꁽЁǁʁ, ʁс򁼁聤Á
􁳁؁遻Łׁ򁹁ԁȁǁ. 
ځꁽЁށǁρǁˁ؁끱遻Ɂԁׁ́ǁ끤΁, 
GPhysցȁ NetCDF ՁÁ恤΁ʁс
؁΁ȁʁ݁Ɓ끤Á, 
ʁс򁤁ȁ끤ʁɁȁʁ쁤Ё݁΁ǁ΁ƁɁ߁Ёȁ遻ԁ쁤끤ȁˁʁ. 
ǁρ⁤ρ䁥Ձ끤΁, ၥ⁥ꁡ偤ˁʁ݁쁤. , 
GPhys ˁƁ, ၥ⁥ꁡ偤΁ǁ, ՁÁ恤ˁ끥ǁȁƁ́́
쁤. Á, ́́сԁρ΁ԁ򁶁ʁ́Ɂׁ́ρʁ. Á, 灤
ǁ򁰁ÁƁ끺݁ˁ, ၥ⁥ꁡ򁰁ǁʁ聤, Ɂׁ́ʁɁʁځꁽ
Ɓ遱遻끤ȁρ݁ہ΁Ɂ. 
</p><br>

<p> , 遥 GPhys , ǁՁÁ恤ˁ끤΁
NArray Á恤ˁ끤΁, ā܁ˁρÁ΁遤ʁ. 
΁つ, GPhys ǁہ VArray (= Virtual Array)ہ. 
΁つЁҁ VArrayNetCDF , VArray ΁ց遥ǁ. 
ʁ聤Á, ́݁ȁ΁ՁށÁȁ؁΁Ё, Ё VArray
򁺁끤ȁ灤ʁŁȁʁ. 
</p><br>

<p> , ΁ׁ큥遥, ʁс΁āׁ큥Ձ끤Ɂ. 
 <a href="#line_2"><tt>line_2.rb</tt></a>
ȁہȁ󁤁Ɂʁс遤ʁȁˁÁ큰Ձ. 
</p><br>

<p><a href="line_3.rb">line_3.rb</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/ggraph"
 2: include NumRu
 3: gphys = GPhys::IO.open('T.jan.nc', 'T')
 4: DCL.gropn(1)
 5: DCL.sgpset('isub', 96)
 6: DCL.sgpset('lfull',true)
 7: DCL.uzfact(0.6)
 8: GGraph.set_fig( 'itr'=> 2, 'viewport'=>[0.25,0.7,0.15,0.6] )
 9: GGraph.line( gphys.mean(0,1), true, 'exchange'=>true )
10: DCL.grcls
</pre></td></tr></table>

<p>끲́΁ށρ. ρȁ偤΁ʁ󁤁ʁсɁ⁤΁ˁʁсÁƁ끤ȁˁÁ큰. 
</p><br>

<p><a href='line_3.png'>line_3.rbԁ끲<br><img src='line_3s.png'></a><br>
</p><br>

<p>ǁ, mean(0,1)ǁ 1,2 ́܁΁ʁс򁼁聤ÁƁ. 
ǁہ΁ׁ́ǁƁ́,  0 避􁤁끤΁ǁ. 
GPhys΁ၥÁ mean ρƁʁҁŁ΁Ł߁ŁÁʁс򁹁ԁ. 
́́сˁ NArray ΁ၥÁ mean ȁƁǁ끡ʁ, Ɓ́́
sum, max, min, stddev ʁɁ΁ၥÁɁ끡. 
</p><br>

<p>, ݁ˁ, ǁ 90N-90S ǁ΁Łˁ󁥁ׁ끤쁤⁤΁
ƁÁƁ끤, ʁсρ, 恷䁥󁥁ׁ󁸁Łǁсʁ偤, 
āǁ䁤끤΁ǁ. ΁聤ʁցǁ΁ʁсρၥÁ average 
ǁԁȁǁ끡
</p><br>

<table width=80%><tr><td><pre class="source">
9: GGraph.line( gphys.average(1).average(0), true, 'exchange'=>true )
</pre></td></tr></table>
<br>

<p> ΁聤, ցˁ򁹁ԁၥÁɁ, ߁΁ȁ 
average  integrate ΁āǁ. ˁǁՁ끥ȁ΁сʁ끥ꁥ
恷ǁ끡ʁ݁ˁρʁҁ΁ʁˁ聤ÁƁ끥ꁥʁс끤, 
NetCDF΁恡Ɂ΁߁򁲁򁼁ၤƁ끾쁹, ʁҁ΁ʁρÁ΁Ɓʁ
΁ǁʁ끡. 
쁤遤ρƁˁ聤ˁԁɁׁ́끤΁, 
average(1).average(0) ȁŁ́ƁƁ󁤁ǁ. ʁ, ΁쁹灤ǁ, 
ˁɁՁၤ΁ʁҁŁ΁ЁŁفցցÁȁ򁹁́΁ʁсˁρʁ遤ʁȁˁÁ큰. 
́Łˁ, 偺ɁʁɁÁɁρ߁āꁤ, 򁼁ၤ遤쁤끤聤ˁ́āꁤǁ. 
</p><br>

<hr>
<a name="h2:units">
<p><h2>ʁ́΁́΁Á</h2><br>
</a>

<p>
VArray, GPhys , ʁ́΁́΁Á́ǁ. 
</p><br>

<p>
Á́ρ "units" ǁ؁āꁤ, ΁遻<a
href="http://ruby.gfd-dennou.org/products/numru-units" target=_top>
NumRu::Units</a> ԁ. 쁤ˁ聤, ΁つ VAray  GPhys ΁݁
ԁ, Á́΁݁⁹ԁ쁤. ށ, āꁿǁ and/or ՁÁȁʁ΁つ
Á́򁻁āǁ΁ρ, 聣聣΁Á́ˁ灤끴
ԁÁƁ遹ԁʁ΁つ, km  m  degree_C  K ΁ց΁ʁɁ. 
</p><br>

<p>
遤, GPhys ΁сÁƁ⁤ˁ, 쁤́с
<a href="http://ruby.gfd-dennou.org/products/gphys/doc/unumeric.html">
NumRu::UNumeric</a>
ȁ, Á́ɁՁ΁Á(遡)΁遥āꁵ쁤Ɓ. 
GPhys, VArray, UNumeric ρ́ˁ遻򁹁ԁȁǁ. 
ʁ끲́΁遥 GPhys, VArray, UNumeric ΁灤ˁ灤쁤. 
΁つ UNumric  GPhys ΁遻끲́ GPhys. 
</p><br>

<p><a href="op_units.rb">op_units.rb</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/gphys"
 1: include NumRu
 2: temp = GPhys::NetCDF_IO.open('T.jan.nc', 'T')
 3: p( temp.data.get_att('units') )
 4: p( (temp*temp).data.get_att('units') )
 5: p( (temp*temp).units.to_s )
 6: 
 7: R = UNumeric[ 287.04, 'J.K-1.kg-1' ]   # Gas const of dry air
 8: p( (R*temp).data.get_att('units') )  # Bad, because temperature should be in K
 9: zeroK = UNumeric[ 0.0, 'K' ]
10: tempK = zeroK + temp
11: p( (R*tempK).data.get_att('units') )
</pre></td></tr></table>
</p><br>

<p>ʁρԁ끲́
</p><br>

<p><table width=80%><tr><td><pre class="source">
% <span class="command">ruby op_units.rb</span>
"degC"
"degC2"
"degC2"
"J.K^(-1.0).degC.kg-1"
"J.kg-1"
</pre></td></tr></table>
</p><br>

<p>
聣ԁ́܁ <tt>(temp*temp)</tt> ΁끲́ȁ,
΁Á "degC" 2聤쁤 "degC2" ȁʁÁƁ끤ȁ. 
ԁ́܁ǁ,  ΁āꁿ R = 287.04 [J.kg-1.K-1] 򁽁ȁ,
ԁ́܁ǁρȁ݁灤쁤. 
΁끲́΁Á́ "J.K^(-1.0).degC.kg-1" ȁʁÁ. 
K  degC づ󁥁끤Ɓʁ΁ǁˁ,
, ΁Ɂ́끤ȁ΁āꁿ􁤁ˁ݁ƁՁ́끤΁,
ā́ρЁŁفǁ끤ȁ򁻁ׁЁǁ큤ʁց󁡁. 
, 9,10ԁ́܁ǁ, ΁끲́΁Á́聰쁹ˁ灤쁤끤ȁ́́с,
Kelvin ˁʁс끡

<p><pre>
    zeroK = UNumeric[ 0.0, 'K' ]
    tempK = zeroK + temp
</pre>

<p>΁끲́ R 򁳁݁끡11ԁ́܁ˁ, 끲́΁Á́
"J.kg-1" ȁЁ. 
</p><br>

<hr>
<a name="h2:nc kakidashi">
<p><h2>ǁ򁥁Ձ끤ˁ񁽁Ё</h2><br>
</a>

<p> GPhys ́́с끤ȁʁҁŁʁՁ끤΁񁤁Ё́Ɓׁˁԁ.
聤ǁ遤 NetCDF ʁ, ǁˁʁҁŁʁǁ GPhys
ȁƁƁɁ߁󁤁ǁ遡ʁɁׁ́ˁƁÁ΁偡ˁՁ끤ˁЁ΁ρ
򁰁. 偤ǁ聤ˁՁ끤΁ʁс́Ɓׁǁ. 
ā, ȁ󁼁ʁҁŁʁǁŁ򁤁⁤ȁˁ쁤
GPhys ցȁ򁹁偤ǁՁ끤ˁ񁽁Ё΁つ򁼁.
߁΁ȁ큽񁽁ЁՁ끷 NetCDF ށ grib ,
GrADS ΁񁽁Ёρށ݁ȁƁʁ. 

<a name="h3:gphys kakidashi">
<p><h3>GPhysǁ΁񁽁Ё</h3><br>
</a>

<p> GPhys ցȁ΁΁, ʁҁʁ݁Áށ,
Ձ끤ˁ񁽁Ёȁǁ. ΁΁つǁ,
NetCDF Ձ끤ƁɁ߁󁤁, ΁΁聤򁸁ÁɁʁ
NetCDF Ձ끤ˁ񁽁Ё.
񁽁Ё΁΁聤ˁЁƁɁʁс􁤁ځꁽЁ쁤.

<p><a name="ncwrite1"></a>
<a href="ncwrite1.rb">ncwrite1.rb</a>
<table width=80%><tr><td><pre class="source">
1: require "numru/gphys"
2: include NumRu
3: gphys = GPhys::NetCDF_IO.open('T.jan.nc', 'T')
4: outfile = NetCDF.create('tmp.nc')
5: GPhys::NetCDF_IO.write( outfile, gphys.cut('level'=>1000..250).mean(0) )
6: GPhys::NetCDF_IO.write( outfile, gphys.cut('level'=>1000..250).mean(0,1).rename('T00') )
7: outfile.close
</pre></td></tr></table>
<br>

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby ncwrite1.rb</span>
% <span class="command">ncdump -c tmp.nc</span>
netcdf tmp {
dimensions:
        lat = 19 ;
        level = 5 ;
variables:
        float lat(lat) ;
                lat:units = "degrees_north" ;
                lat:actual_range = 90.f, -90.f ;
                lat:long_name = "Latitude" ;
        float level(level) ;
...(Á΁)...
        float T(level, lat) ;
...(Á΁)...
        float T00(level) ;
...(Á΁)...
// global attributes:
                :history = "2004-03-19 19:40:17 JST horinout> NumRu::GPhys::NetCDF_IO.write T" ;
data:

 lat = 90, 80, 70, 60, 50, 40, 30, 20, 10, 0, -10, -20, -30, -40, -50, -60, 
    -70, -80, -90 ;

 level = 1000, 850, 600, 400, 250 ;
}
</pre></td></tr></table>

<p>
<a href="#ncwrite1"></a>΁ 5,6 ԁ́܁΁聤, 
GPhys::NetCDF_IO.write 򁷁ʁց, 쁤ā΁Ձ끤ˁʁ􁸁ā΁ʁс􁤁
񁤁ȁЁ́聤. 
Á, NetCDF ΁́󁤁ǁƁ́΁ʁс􁤁ρ쁤ā񁤁ʁ΁,
ǁ2ȁց́܁ˁ񁤁ǁ 'T00' ȁ́Ɓ. 
́ʁ쁤Ё΁ǁ΁́ρƁʁ΁ǁ΁びȁ. 
ʁ, Ɂʁс􁤁΁쁹灤, ʁ􁤁 GPhys ǁ́Ɓ끾쁹灤΁, 
΁Ɓ́΁⁤΁끾쁹灤ρȁ(shape)򁥁Á, 
Áׁ쁤ЁƁ⁤΁ȁʁ񁤁߁򁾁ʁ΁. 
Áׁʁ쁹灤ρ΁びȁ. 
偤΁΁つǁ, <tt>level</tt>ȁɁʁс􁤁́쁤Ɓ. 

<a name="h3:file type conversion">
<p><h3>Ձ끷΁ʁс</h3><br>
</a>

<p> GPhys򁲁끤ȁ, Ձ끤΁ʁс򁴁ʁÁˁԁȁǁ.

<p><a name="convert.rb"></a>
<a href="convert.rb">convert.rb</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/gphys"
 2: include NumRu
 3: 
 4: usage = "\nUSAGE:\n % #{$0} in_file out_file\n"
 5: ifpath = ARGV.shift || raise(usage)
 6: ofpath = ARGV.shift || raise(usage)
 7: 
 8: raise "File #{ofpath} present. Delete it if needed." if File.exist?(ofpath)
 9: case ofpath
10: when /\.nc$/
11:   ofile = NetCDF.create(ofpath)
12: when /\.grib$/
13:   ofile = Grib.create(ofpath)
14: else
15:   raise "unsupported file type (judged by suffix): "+ofpath
16: end
17: 
18: GPhys::IO.var_names_except_coordinates( ifpath ).each do |varname|
19:   GPhys::IO.write(ofile, GPhys::IO.open(ifpath, varname) )
20: end
21: 
22: ofile.close
</pre></td></tr></table>
<br>

<p> ΁ׁ큥遥ǁ, ʁс聤΁Ձ끤΁,
ՁÁ (.nc  .grib) ˁƁ聤ၤƁ.
Ɓ΁ρՁ끤΁ρƁȁʁ́쁤끤΁, ƁÁˁ⁤ʁƁ聤.
ʁ, 19 ԁ́܁ǁρƁ΁ρ끥ՁÁ恤΁ʁс􁤁򁰁ÁɁ􁥁ၥ⁥ꁡ
ƁɁ߁󁤁ǁ遥Ձ끤ˁ񁽁Ё聤ˁʁÁƁ끤΁,
灥ǁ΁ˁρꁱʁ. 灥ǁ΁聤ꁰʁˁρ偽ҁ.
ʁ, <b>GPhys 0.4.0 ǁρЁ΁, 偵ׁ큥遥ˁ聤
grib Ձ끤؁΁ʁсԁʁ. 健ꁥꁡ쁤 0.4.1
ʁ߁Ɂׁ́ˁʁ.</b>

<p> ԁ΁ (Á, 3ȁց́܁΁ GPhys 0.4.0 ǁρˁԁǁʁ):

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby convert.rb T.jan.grib tmp1.nc</span>
% <span class="command">ruby convert.rb T.jan.ctl tmp2.nc</span>
% <span class="command">ruby convert.rb T.jan.nc tmp.grib</span>
% <span class="command">ls tmp*</span>
tmp.grib  tmp1.nc  tmp2.nc
</pre></td></tr></table>

<p> Ё́聤Ձ끤΁΁ǁ:

<table width=80%><tr><td><pre class="source">
% <span class="command">ncdump -h tmp1.nc </span>
netcdf tmp1 {
dimensions:
        lon = 36 ;
        lat = 19 ;
        level = 9 ;

variables:
        float lon(lon) ;
                lon:long_name = "longitude" ;
                lon:units = "degrees_east" ;
                lon:short_name = "lon" ;
        float lat(lat) ;
                lat:long_name = "latitude" ;
                lat:units = "degrees_north" ;
                lat:short_name = "lat" ;
        long level(level) ;
                level:long_name = "isobaric level" ;
                level:units = "hPa" ;
        double TMP(level, lat, lon) ;
                TMP:time = "0000-01-01 00:00:0.0" ;
                TMP:long_name = "Temperature" ;
                TMP:units = "K" ;
                TMP:standard_name = "air_temperature" ;

// global attributes:
                :history = "2005-03-21 18:06:19 JST horinout> NumRu::GPhys::NetCDF_IO.write TMP" ;
}
</pre></td></tr></table>

<table width=80%><tr><td><pre class="source">
% <span class="command">wgrib tmp.grib</span>
1:0:d=00010100:TMP:kpds5=11:kpds6=100:kpds7=1000:TR=1:P1=0:P2=0:TimeU=0:1000 mb:anl:NAve=0
2:1463:d=00010100:TMP:kpds5=11:kpds6=100:kpds7=850:TR=1:P1=0:P2=0:TimeU=0:850 mb:anl:NAve=0
3:2926:d=00010100:TMP:kpds5=11:kpds6=100:kpds7=600:TR=1:P1=0:P2=0:TimeU=0:600 mb:anl:NAve=0
4:4389:d=00010100:TMP:kpds5=11:kpds6=100:kpds7=400:TR=1:P1=0:P2=0:TimeU=0:400 mb:anl:NAve=0
5:5852:d=00010100:TMP:kpds5=11:kpds6=100:kpds7=250:TR=1:P1=0:P2=0:TimeU=0:250 mb:anl:NAve=0
6:7315:d=00010100:TMP:kpds5=11:kpds6=100:kpds7=150:TR=1:P1=0:P2=0:TimeU=0:150 mb:anl:NAve=0
7:8778:d=00010100:TMP:kpds5=11:kpds6=100:kpds7=70:TR=1:P1=0:P2=0:TimeU=0:70 mb:anl:NAve=0
8:10241:d=00010100:TMP:kpds5=11:kpds6=100:kpds7=30:TR=1:P1=0:P2=0:TimeU=0:30 mb:anl:NAve=0
9:11704:d=00010100:TMP:kpds5=11:kpds6=100:kpds7=10:TR=1:P1=0:P2=0:TimeU=0:10 mb:anl:NAve=0
</pre></td></tr></table>

<a name="h3:others kakidashi">
<p><h3>ȁGPhysǁ΁񁽁Ё -- GPhysցȁ򁰁쁤遺</h3><br>
</a>
<p>
(by ߁́, : ˁفǁƁ)

<p>
쁤NetCDFՁ끤򁽁񁤁Ё݁ˁGPhys򁻁ȁȁʁÁˁ񁤁ȁǁ. 

<p>
ʁ΁ׁ큥遥ǁρՁ끤ρƁɁ߁󁤁ǁ遤,
Ɂʁ󁤁⁴ށၰ쁤 GPhys ցȁ򁹁,
쁤 NetCDF Ձ끤ˁЁ΁ρ. Á GPhys
ցȁ򁷁Ё́끤ȁ, RubyNetCDF
΁ၥÁɁā܁ˁс, ׁ큥遥ʁÁˁʁ.


<p><a name="ncwrite2"></a>
<a href="ncwrite2.rb">ncwrite2.rb</a>
<table width=80%><tr><td><pre class="source">
require "numru/gphys"
include NumRu

nlon = 36
nlat = 18

lon_a = VArray.new( NArray.sfloat(nlon).indgen(0,360.0/nlon),
                    {"long_name"=>"longitude", "units"=>"degrees_east"},
                    "lon" )
lon = Axis.new.set_pos(lon_a)
 
lat_a = VArray.new( NArray.sfloat(nlat).indgen(0,180/nlat),
                    {"long_name"=>"latitude","units"=>"degrees_north"},
                    "lat" )
lat = Axis.new.set_pos(lat_a)
 
data = VArray.new( NArray.sfloat(nlon,nlat).indgen,
                   {"long_name"=>"temperature", "units"=>"K"},
                   "T" )
gphys = GPhys.new( Grid.new(lon,lat), data )
 
file = NetCDF.create("tmp.nc")
GPhys::NetCDF_IO.write(file,gphys)
file.close
</pre></td></tr></table>
<br>

<p> 偵΁ׁ큥遥򁼁ԁ, Ё́聤끥Ձ tmp.nc ΁Á恿ȁ򁳁΁ǁ聤

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby ncwrite2.rb</span>
% <span class="command">ncdump -c tmp.nc</span>
netcdf tmp {
dimensions:
        lon = 36 ;
        lat = 18 ;
variables:
        float lon(lon) ;
                lon:long_name = "longitude" ;
                lon:units = "degrees_east" ;
        float lat(lat) ;
                lat:long_name = "latitude" ;
                lat:units = "degrees_north" ;
        float T(lat, lon) ;
                T:long_name = "temperature" ;
                T:units = "K" ;
 
// global attributes:
                :history = "2004-04-19 12:02:36 JST horinout> NumRu::GPhys::NetCDF_IO.write T" ;
data:
 
 lon = 0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150,
    160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290,
    300, 310, 320, 330, 340, 350 ;
 
 lat = 0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150,
    160, 170 ;
}
</pre></td></tr></table>

Łفʁс􁤁VArray Classցȁ򁺁ÁƁAxis ClassGPhys Classցȁ򁺁. 

<hr>
<a name="h2:big data">
<p><h2>灥ǁ΁</h2><br>
</a>

<p> ʁс􁤁100MBʁ偤΁ǁ򁰁쁹,
ŁفˁƁɁ߁ȁׁ΁ၥ⁥ꁡ򁰁ǁ끤ǁ큤.
GPhys ǁρ쁤ȁ򁤁끤ၤ΁Ɂׁā.

<a name="h3:subset_and_cloning">
<p><h3>GPhysˁ끥ցÁȁȁ큡ˁ󁥁</h3><br>
</a>

<p> ΁聰쁤, ցɁׁ́ˁʁ遤ʁꁥǁρƁɁ߁ށʁׁȁ
GPhys ΁߁ׁʁˁǁ. ΁つ, <tt>[]</tt>  <tt>cut</tt>
ˁ聤끥ցÁȁځ聤ǁρՁ끤΁ƁɁ߁߁ρȁʁ.
΁΁つ򁸁Ɓ́つ. 

<table width=80%><tr><td><pre class="source">
% <span class="command">irb</span>
irb(main):001:0> <span class="command"> require "numru/gphys"</span>
=> true
irb(main):002:0> <span class="command">include NumRu</span>
=> Object
irb(main):003:0> <span class="command">gphys = GPhys::IO.open('T.jan.nc','T')</span>
=> &lt;GPhys grid=&lt;3D grid &lt;axis pos=&lt;'lon' in 'T.jan.nc'  sfloat[36]&gt;&gt;
        &lt;axis pos=&lt;'lat' in 'T.jan.nc'  sfloat[19]&gt;&gt;
        &lt;axis pos=&lt;'level' in 'T.jan.nc'  sfloat[9]&gt;&gt;&gt;
   data=&lt;'T' in 'T.jan.nc'  sfloat[36, 19, 9]&gt;&gt;
irb(main):004:0> <span class="command">sub = gphys.cut('lon'=>0,'lat'=>10..60)</span>
=> &lt;GPhys grid=&lt;2D grid &lt;axis pos=&lt;'lat' shape=[6]  subset of a NumRu::VArrayNetCDF&gt;&gt;
        &lt;axis pos=&lt;'level' shape=[9]  subset of a NumRu::VArrayNetCDF&gt;&gt;&gt;
   data=&lt;'T' shape=[6, 9]  subset of a NumRu::VArrayNetCDF&gt;&gt;
</pre></td></tr></table>

<p> <tt>sub = gphys.cut('lon'=>0,'lat'=>10..60)</tt>
΁끲́΁Ɂˁ, 'lat', 'T' ˁāƁ
<tt>subset of a NumRu::VArrayNetCDF</tt> ȁɁ쁤Ɓ.
쁤, VArray ˁƁցÁȁ끺,
ցȁρÁ́򁥁ԁƁʁ݁끤΁ǁʁ,
΁ցȁ؁΁ȁȁցÁȁ΁́ʁˁʁ݁끤聤ˁʁÁƁ끤遤ǁ.  
<a href="#h3:saisoku contour">偵΁ā끲΁΁</a>ǁ,
ā끲끥ǁ΁ځꁽЁ <tt>[]</tt>  <tt>cut</tt>
ǁԁ, Ձ끤ƁɁ߁ށ쁤끥ǁρ聤ˁȁ쁤ʁ΁߁ǁ.
聤Á, Áˁށ끤ʁ, 灤ʁǁ΁΁ꁼꁤ
GPhys ցȁ򁺁Ɓʁ.
</p><br>

<p> ʁ, ⁤Á́΁ƁɁ߁󁤁ǁԁ򁺁쁤 <tt>copy</tt>
ၥÁɁ́с쁤Ё聤.
쁤ρցȁ쁥ցȁ؁΁ȁ򁴁ށށʁ,
恤 deep clone 򁺁 (ցȁāꁡ򁤁ށ끤ȁʁ).
򁻁ȁ΁.
</p><br>

<p> 偵 irb Á灥󁤁΁:
<table width=80%><tr><td><pre class="source">
irb(main):005:0> <span class="command">csub = sub.copy</span>
=> &lt;GPhys grid=&lt;2D grid &lt;axis pos=&lt;'lat' sfloat[6] val=[60.0,50.0,40.0,30.0,...]&gt;&gt;
        &lt;axis pos=&lt;'level' sfloat[9] val=[1000.0,850.0,600.0,400.0,...]&gt;&gt;&gt;
   data=&lt;'T' sfloat[6, 9]
    val=[4.25522947311401,4.68513584136963,9.936279296875,14.2176637649536,...]&gt;&gt;
</pre></td></tr></table>

<p> ŁفρÁ́΁Ɂ􁤁Ɂ쁤Ɓ. ǁρƁɁ߁ށ쁤, 
NArray ցȁȁƁၥ⁥ꁡ偤ˁʁ݁쁤Ɓ.
</p><br>

<a name="h3:iterator for big data">
<p><h3>灥ǁ́сƁʁ䁥Ɓ쁡</h3><br>
</a>

<p>, 偤ǁցɁׁ́ˁʁ遤ʁꁥǁρƁɁ߁ށʁׁ݁ꁥ́, 
΁ցɁׁׁ́ρЁЁ䁤ÁƁ. ΁つ <tt>gphys.mean(0)</tt> 
<tt>gphys3 = gphys1 + gphys2</tt> ΁聤ˁ遻򁹁ԁ쁹灤ρǁ.
ށ, <a href="#h3:file type conversion">Ձ끷΁ʁс</a>
΁ၤǁҁف聤, Ձ끤ƁɁ󁤁ǁ񁽁Ё݁ˁ, ÁƁɁ߁߁ȁ.
</p><br>

<p>
΁聤ʁ쁹, ƁɁ߁߁򁾁āԁȁ
ၥ⁥ꁡ򁰁ǁʁ聤ˁ끤ȁ́遤쁤.
΁つЁ΁聤 (쁤ρȁ󁼁Ɓ΁. ΁ˁƁ΁つ򁼁).
</p><br>

<p><a name="iterate_over_dim_1.rb"></a>
<a href="iterate_over_dim_1.rb">iterate_over_dim_1.rb</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/gphys"
 2: include NumRu
 3: 
 4: gphys = GPhys::NetCDF_IO.open('T.jan.nc', 'T')
 5: 
 6: #< all at once >
 7: print "Case 1: all at once\n"
 8: p gphys.mean(0,1).val
 9: 
10: #< iterate over the last dimension >
11: print "\nCase 2: iterated\n"
12: nz = gphys.axis(2).length
13: for i in 0...nz
14:   p gphys[false,i].mean(0,1).val
15: end
</pre></td></tr></table>
<br>

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby iterate_over_dim_1.rb</span>
Case 1: all at once
NArrayMiss.sfloat(9):
[ 5.058, -0.5645, -14.03, -32.75, -49.6, -57.47, -61.5, -53.99, -42.25 ]

Case 2: iterated
5.05842492176078
-0.564510100069102
-14.0251893160636
-32.7455883360746
-49.5988384046053
-57.4673908077485
-61.4999143366228
-53.9931640625
-42.247435809576
</pre></td></tr></table>

<p> , 偤΁΁つǁρʁՁˁ끾쁹灤, Ɓ쁡򁻁ȁ쁹灤,
Ɓ遤쁤끷끲́ Ruby ցȁȁƁρƁǁρʁ.
ԁρ쁤ā΁ǁǁ끤΁ˁЁ,
偼ԁρʁ􁤁΁큼ǁ끤.
</p><br>

<p> GPhysˁ,
灥ǁˁЁ끱遻ʁ䁤Ɓԁȁ򁻁ف灤끥Ɓ쁡쁤Ɓ.
쁤ρ΁聤ˁ́с.
</p><br>

<p><a name="iterate_over_dim_2.rb"></a>
<a href="iterate_over_dim_2.rb">iterate_over_dim_2.rb</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/gphys"
 2: include NumRu
 3: gphys = GPhys::NetCDF_IO.open('T.jan.nc', 'T')
 4: 
 5: # < all at once >
 6: ofile1 = NetCDF.create('tmp1.nc')
 7: gp10 = gphys*10
 8: GPhys::NetCDF_IO.write(ofile1, gp10)
 9: ofile1.close
10: 
11: #< iterate over the last dimension >
12: ofile2 = NetCDF.create('tmp2.nc')
13: GPhys::NetCDF_IO.each_along_dims_write(gphys, ofile2, -1) do |sub|
14:   sub10 = sub*10
15:   [sub10]
16: end
17: ofile2.close
</pre></td></tr></table>
<br>

<p>
ȁǁ, ǁ΁Á́10ǁ܁, "tmp1.nc"
ȁՁ끤ˁ񁽁Ё΁ρ́ǁ򁤁ǁ큤.
ȁρʁꁤˁ⁤쁤ʁ, ρƁׁ򁤁,
"tmp2.nc" ȁՁ끤ˁ񁽁Ё. ,
΁, ǁ偤΁ˁ؁Ɓ끡ׁ򁲁󁤁.
<tt>GPhys::NetCDF_IO.each_along_dims_write</tt> ,
1ȁց́܁΁􁤁ǁ؁āꁤ GPhys ցȁ,
3ȁց́܁΁􁤁ǁ؁āꁤˁÁƁʁ䁤Ɓց큥Á΁􁤁ȁ
(偤΁΁つǁρʁс <tt>sub</tt>),
ց큥Á΁ʁցÁ (偤ǁ15ԁ́܁ [sub10])  2 ȁց́܁΁􁤁ǁ؁āꁤՁ끤ˁ񁤁. 
Ձ끤ˁ񁤁ǁρ쁤āȁρ遤ʁ΁,
ʁցÁ́ GPhys ցȁ΁ǁہ΁󁤁ȁ.
΁݁ʁցÁ́ρ΁΁ցÁȁǁ끤ρǁ끤,
΁Ɂ偤ǁ񁤁߁򁹁ԁ. ΁ǁ偤΁Ł݁󁥁ȁ,
΁ˁȁ΁΁つȁƁ́́, 끲́ρʁ䁽́򁹁ԁʁÁ쁹灤ȁƁˁʁ끤΁ǁ.
</p><br>

<p>
偤ǁ <tt>sub</tt> , ǁ偤΁΁āˁʁ. 灻ǁāˁ,
ʁ΁끡ׁ򁼁ԁƁ끤聤ʁ⁤΁ǁ.
<table width=80%><tr><td><pre class="source">
for i in 0...gphys.shape[-1]
  sub = gphys[false, i..i]   # i..i ˁ聤, ǁ偤΁򁾁Áāˁ.
  ...
end
</pre></td></tr></table>
<p>
΁΁Ɂ΁, ց큥Á΁́ၤÁ́ˁƁ,
ʁ䁤쁤ÁƁƁρʁ遤ʁ.
</p><br>

<p>
ʁ, <tt>GPhys::NetCDF_IO.each_along_dims_write</tt>
΁聰쁰􁤁ρ쁤ā GPhys ցȁǁ,
ʁ􁤁 GPhys ցȁƁ쁤ǁہ΁󁤁ǁ⁤聤. Ɓ΁ρ GPhys
ցȁ΁􁤁ˁ, ց큥Á΁􁤁΁􁤁.
ށ, ρȁց恤ǁʁ́ǁ؁āꁤ끤ȁ⁤ǁ.
ρ΁΁:
<table width=80%><tr><td><pre class="source">
GPhys::NetCDF_IO.each_along_dims_write([gp1,gp2,gp3], ofile2, 'level') do
    |sub1, sub2, sub3|
    ....
</pre></td></tr></table>

<p>
ǁ gp1, gp2, gp3 ā́΁ 'level' ˁ聤ÁƁʁ䁤쁤.
⁤큤Ɓ 'level' ȁ򁻁ÁƁ,
΁āŁ΁ǁʁ쁤Ё遡ˁʁ.
</p><br>

<p>
Ё΁ρ끥Ձ끤ʁ􁻁؁āꁤƁԁ聤ʁ끤ȁ⁤ǁ.
ށʁ䁤ˁȁʁ􁻁؁āꁤ끤ȁ⁽Ё́聤:
<table width=80%><tr><td><pre class="source">
GPhys::NetCDF_IO.each_along_dims_write(gp, [ofile1, ofile2], 'lat', 'level') do
    |sub|
    ....
    [res1, res2]
end
</pre></td></tr></table>
<p> ǁ <tt>res1</tt>  <tt>ofile1</tt>, <tt>res2</tt>
 <tt>ofile2</tt> ˁ񁤁쁤. ʁցÁ́΁ā􁤁Ձ끿􁤁聤灤쁹灤,
ʁ􁤁΁ցȁށȁၤ(؁āꁤǁ偤)Ё΁ρՁ끤ˁƁ.
</p><br>

<p>
<tt>GPhys::NetCDF_IO.each_along_dims_write</tt>
ρ끲́ NetCDF Ձ끤ˁ񁽁Ё. ́Łˁ, Ձ끤ˁ񁽁Ёʁ
<tt>GPhys::each_along_dims</tt> ȁၥÁɁ⁺́āꁤǁ.
쁤ρƁ΁ρǁρ灤, ́΁끲́ρȁ쁹灤ˁ́́сǁ큤.
(끲́⁵灤ʁ遥Ձ끤ˁЁ끤Ɓʁ΁, ށ遤򁼁΁ǁ.)
</p><br>

<hr>
<a name="h2:file bunkatsu">
<p><h2>ʁ䁥Ձ끤򁥁Ёづ끤ˁҁȁށȁ</h2><br>
</a>

<p> GPhys ρ끥ǁ΁ցÁȁ,
΁ǁ끤ȁ끤ȁρˁ́.
쁤ȁρՁ,
݁ˁρ쁤ā΁ǁʁ􁤁΁Ձ끤ˁʁ䁤쁤Ɓ끾쁹灤⁰ȁЁ́聤.
<b>Á, ߁΁ǁ NetCDF ΁߁ˁ؁쁤Ɓ.</b>
</p><br>

<p> ΁つ, Ɓʁс΁΁ǁǁȁ <tt>T.2001.nc</tt>,
<tt>T.2002.nc</tt>, <tt>T.2003.nc</tt> ȁʁ쁤Ɓ끤ȁ聤.
΁ǁʁ΁ǁ΁ʁс򁤁ȁ끤ȁ 2001 ǁ 11 
2002 ǁ 2 ށǁ΁ʁс򁼁聤큤ȁׁ (݁؁΁́ρ΁Ɂꁤށ?), 
ā́΁ׁꁥ灥󁥁ׁ큥遥ǁ,
ށ쁤遤΁Ձ끤򁤁ÁāɁׁ́끤큤.
, GPhys ǁ, ʁ΁聤ˁ쁤Ё΁Ɂ

<p><table width=80%><tr><td><pre class="source">
gphys = GPhys::IO.open(['T.2001.nc','T.2002.nc','T.2002.nc'], 'T')
</pre></td></tr></table>

<p>ށ

<p><table width=80%><tr><td><pre class="source">
gphys = GPhys::IO.open( /T.(\d\d\d\d).nc/, 'T')
</pre></td></tr></table>

<p> ԁρՁ끤򁰁쁼΁ǁہ΁󁤁ˁၤ끤ȁ,
쁼΁ʁ䁤ǁ끤ȁ GPhys::IO.open ˁƁ. 
2ʁ䁤ʁ2ǁہ΁󁤁́с.
偼ԁ, ɁǁՁ끤򁻁؁āꁤƁ.
ǁρՁ끤ˁ聤ÁƁʁс끥с󁤁򁳁灸́ǁρȁɁׁ́ǁ.
灸́쁤āǁ쁤Ё쁼ʁ䁤ǁ끤ȁ򁰁Ձ́.

<p> ǁ, 쁤ށǁȁƁǁ򁻁ȁÁ,
ʁ䁥Ձ끤΁ƁɁ߁߁΁ǁ⁤򁤁聤.
ށρၤˁՁ끤ʁ䁤, ၤƁ쁤ƁɁ߁ށɁȁˁ.

<p><a href="multiple_files.rb">multiple_files.rb</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/ggraph"
 2: include NumRu
 3: gp = GPhys::IO.open('T.jan.nc', 'T')
 4: 
 5: # < create test files: divide into 4 files (2 by 2) >
 6: 
 7: GPhys::IO.write( f=NetCDF.create('tmp00.nc'), gp[0..17,0..9,{0..6,6}] )
 8: f.close
 9: GPhys::IO.write( f=NetCDF.create('tmp01.nc'), gp[0..17,10..-1,{0..6,6}])
10: f.close
11: GPhys::IO.write( f=NetCDF.create('tmp10.nc'), gp[18..-1,0..9,{0..6,6}])
12: f.close
13: GPhys::IO.write( f=NetCDF.create('tmp11.nc'), gp[18..-1,10..-1,{0..6,6}])
14: f.close
15: 
16: # < open two-dimentionally divided data >
17: 
18: files = /tmp(\d)(\d).nc/
19: p gpcompo = GPhys::IO.open( files, 'T' )
20: 
21: # < test graphics >
22: 
23: DCL.gropn(1)
24: DCL.sgpset('lcntl', false) ; DCL.uzfact(0.7)
25: DCL.sldiv('y',2,1)
26: GGraph.contour( gpcompo )
27: GGraph.contour( gpcompo[false,1] )
28: DCL.grcls
29: 
30: # < clean up >
31: 
32: File.unlink('tmp00.nc')
33: File.unlink('tmp01.nc')
34: File.unlink('tmp10.nc')
35: File.unlink('tmp11.nc')
</pre></td></tr></table>
<br>

<p> 偤ǁρЁŁفށŁفˁ؁Ɓ쁤쁥ǁ򁣁ʁ䁤,
tmp00.nc, tmp01.nc, tmp10.nc, tmp11.nc ȁā΁Ձ끤ˁၤƁ.
쁤, Ɂ򁻁ȁÁ <tt>/tmp(\d)(\d).nc/</tt>
ȁǁ؁āꁤ, GPhys ց <tt>gpcompo</tt>
򁳁Ɓ.
΁끲́򁿁ށ끤ȁ΁聤ˁ偤΁ŁفʁɁہɁ쁤.
ʁ, 3́(΁)ˁ؁Ɓρǁ؁ʁӁˁ
7ȁց́܁΁؁ځꁽЁƁ. ΁ށ2ˁ́܁ 70 mb
΁ށȁʁÁƁ끤ȁˁÁ큰.
ׁ큥遥΁ǁ偤, Ձ <tt>tmp??nc</tt> 򁾁ÁƁ.

<p><a href='multiple_files.png'>multiple_files.rbԁ끲<br>
<img src='multiple_files_s.jpg'></a><br>

<hr>
<a name="h2:ggraph konasi1">
<p><h2>GGraph򁻁ȁʁ(1)</h2><br>
</a>

<p> ƁӁā끲΁ρÁꁤˁ́ၤ. 

<a name="h3:graph_startup">
<p><h3>ƁɁ߁߁Ձ끤΁́</h3><br>
</a>

<p>
偽ҁ <a href="#souce .irbrc_ggraph">GGraph ́ irb ȁÁׁՁ</a>
΁́́с irb ΁߁ˁɁׁ́ρʁ. ΁聤ˁā́ׁ큥遥ˁƁ,
GGraph ́́с΁́򁤁ށȁၤ⁤΁ȁƁ́с끤ȁǁ.
Á, ȁÁׁՁ끤΁Á恿ȁ򁽁񁤁끤ȁԁƁ́Ɓʁс끤΁,
ā聤ÁƁׁ큥遥ˁ́́с끤ȁρၤʁ.
ށ, ЁρÁ́ȁׁ큥遥ԁǁρہʁ߁āꁤށ쁹灤⁤끤큤
(΁つ DCL ΁с遥ၥ 'lwait' , ā́ρʁсʁ΁聤큤),
݁ˁ irb ́с΁ȁρʁ́ˁȁÁׁՁ끤́сՁ끤΁΁Ɂ큤.

<a name='contour1000mb_2.rb'></a>
<p><a href="contour1000mb_2.rb">contour1000mb_2.rb</a>
<table width=80%><tr><td><pre class="source">
 1: require File.expand_path("~/.irbrc_ggraph.rb")  # irb́с΁΁́
 2: gphys = GPhys::IO.open('T.jan.nc', 'T')
 3: GGraph.contour( gphys )
 4: DCL.grcls
</pre></td></tr></table>
</p><br>

<p>  <tt>File.expand_path</tt>  <tt>~</tt>
򁥁ہǁ쁥ȁꁡȁƁŁ끤ၤˁ́сƁ.

<a name="h3:graph option">
<p><h3>Ɂ聥ׁ灥</h3><br>
</a>

<p> ȁꁤ, <a href="#line_2">偤ǁ񁤁ށ</a>ˁ, 
ρȁ΁ၥÁ"lon=130.0 degrees_east" Ł Ɂʁ
ˁƁ߁聤. 쁤ЁɁʁˁ󁥁ށށ쁤ʁʁ끤΁, 
ʁ򁼁ၤ́ށʁƁ΁Ɂ
</p><br>

<p><a href="line_4.rb">line_4.rb</a>
<table width=80%><tr><td><pre class="source">
1: require "numru/ggraph"
2: include NumRu
3: gphys = GPhys::IO.open('T.jan.nc', 'T')
4: DCL.gropn(1)
5: DCL.uzfact(0.7)
6: GGraph.set_fig( 'itr'=> 2 )
7: GGraph.line( gphys.cut(135,35,false), true, 'exchange'=>true, 'annot'=>false )
8: DCL.grcls
</pre></td></tr></table>
<br>

<p> ǁρׁ灥 'annotate'  false ˁ. ׁ灥́, ʁÁׁǁ
큤򁾁ʁ΁ǁ(́ށρ2āʁ偤΁ׁ灥́ˁށÁ끤聤ʁʁ΁ρǁʁ). 
</p><br>

<p><a href='line_4.png'>line_4.rbԁ끲<br><img src='line_4s.jpg'></a><br>


<a name="h3:option shikumi">
<p><h3>Ɂ聥ၥÁɁ΁ׁ灥󁤁΁Łȁ</h3><br>
</a>

<p> 쁤ށ, Ɂ聥ၥÁɁ΁ׁ灥󁤁āЁƁ, 
<tt>'exchange'=>true</tt> ȁÁ񁼁ˁ́ρǁÁ⁤쁤ʁ΁, ⁤. 
偤΁ׁ큥遥ˁ

<table width=80%><tr><td><pre class="source">
GGraph.line( gphys.cut(135,35,false), true, 'exchange'=>true, 'annot'=>false )
</pre></td></tr></table>

<p>, 

<table width=80%><tr><td><pre class="source">
GGraph.line( gphys.cut(135,35,false), true, {'exchange'=>true, 'annot'=>false})
</pre></td></tr></table>

<p>΁ʁ΁ǁ(Ruby΁ʁˁ偤ʁÁƁ). , 

<table width=80%><tr><td><pre class="source">
{'exchange'=>true, 'annot'=>false}
</pre></td></tr></table>

<p>, ρہǁہ΁(Hash)΁āꁵ򁰁Ձ́. āށ, 
􁤁΁ǁ偤 key => value ρ́⁤΁, ρہǁہ΁󁤁΁āꁵ
ʁ쁤끤΁ǁ. 
偤΁΁つǁ, ʁ΁ 'exchange' ˁЁ true , ʁ΁ 'annot' ˁЁ false
򁳁䁤ŁƁρہǁہ΁󁤁遤쁤. 
ȁ, ΁聤ˁʁ򁤁끤ȁʁꁤ䁤ǁ큤. 

<table width=80%><tr><td><pre class="source">
hash = {'exchange'=>true, 'annot'=>false}
GGraph.line( gphys.cut(135,35,false), true, hash )
</pre></td></tr></table>

āށ, GGraph.line ΁ȁց́܁΁􁤁ˁρہǁہ΁󁤁́Ɓ끤, 
Ɂ􁡁ʁȁցǁʁ́ǁʁ́끰􁡁ˁ򁻁ȁÁƁ끤
ǁρʁ. Ruby ΁ʁˁˁρɁ􁤁ρ߁ʁ, 
ρہǁہ΁󁤁򁻁ȁÁ

<table width=80%><tr><td><pre class="source">
GGraph.line( gphys.cut(135,35,false), true, 'exchange'=>true, 'annot'=>false )
</pre></td></tr></table>

΁聤ˁɁǁ끤ȁȁ, ŁˁρɁ􁤁ȁ끤聤
ʁÁƁ끤΁ǁ. 
</p><br>

<p> ρہǁہ΁ Hash ˁƁ, ցׁρÁׁǁʁ쁤Ёʁ遤ʁ, 
GGraph ǁρʁÁׁǁс聤ɁׁƁ. 쁤򁻁ف끤΁, 
GPhys ˁ܁΁ǁρʁ <a href="http://ruby.gfd-dennou.org/products/misc" target=_top>
Misc 遥ց遥ꁡ</a> ˁށށ쁤Ɓ, KeywordOpt ʁӁˁ΁ց遥
ǁ KeywordOptAutoHelp ǁ. Misc遥ց遥ꁡ, Rubyׁ큥遥߁
ȁ́򁻁ف灤, ȁ́΁⁤遥ց遥ꁡ򁽁ၤ⁤΁ǁ. 

<a name="h3:option default">
<p><h3>ׁ灥󁤁΁ǁՁ끥ȁÁ́Á΁</h3><br>
</a>

<p> ƁၥÁɁ΁ׁ灥󁤁΁ǁՁ끥ȁÁ́, 
<a href="http://ruby.gfd-dennou.org/products/gphys/doc/ggraph.html" target=_top>GGraph
ށˁ健</a>ˁ܁ÁƁ끤, ʁ΁聤ˁāف遤쁤. 
ǁ, Ruby ΁ЁρÁ irb 򁻁ȁ. ʁ <tt>irb(main):001:0></tt>
Ł irb ΁ׁ큥󁥁ׁȁǁ. ׁ큥󁥁ׁȁ΁ʁԁ, irb ˁ聤끽Ё΁ρǁ. 
</p><br>

<table width=80%><tr><td><pre class="source">
% <span class="command">irb</span>
irb(main):001:0> <span class="command">require "numru/ggraph"</span>
=> true
irb(main):002:0> <span class="command">include NumRu</span>
=> Object
irb(main):003:0> <span class="command">GGraph.line( nil, true, 'help'=>true )</span>
<< Description of options >>
  option name   default value   # description:
  "title"       nil     # Title of the figure(if nil, internally
                        # determined)
  "annotate"    true    # if false, do not put texts on the right
                        # margin even when newframe==true
  "exchange"    false   # whether to exchange x and y axes
  "index"       1       # line/mark index
  "type"        1       # line type
  "label"       nil     # if a String is given, it is shown as the label
  "max" nil     # maximam data value
  "min" nil     # minimam data value
  "help"        false   # show help message if true
 Current values={"annotate"=>true, "help"=>true, "title"=>nil, "type"=>1, "max"=>nil, "exchange"=>false, "index"=>1, "min"=>nil, "label"=>nil}
NumRu::Misc::HelpMessagingException: ** help messaging done **
        from /usr/local/lib/ruby/site_ruby/1.8/numru/misc/keywordopt.rb:343:in `interpret'
        from /usr/local/lib/ruby/site_ruby/1.8/numru/ggraph.rb:2389:in `line'
        from (irb):3
irb(main):004:0>
</pre></td></tr></table>
<br>

<p> 偤ǁ, ށ́΁ԁ<tt>require "numru/ggraph"</tt> 
<tt>include NumRu</tt>ˁǁ󁤁, <tt>GGraph.line</tt> 
ׁ灥 <tt>'help'=>true</tt> 򁻁؁āꁤƁԁƁ. 끤, 
΁΁ˁ쁤聤ʁၥÁɁ쁤. ΁ȁԁρÁÁǁ, 
Ɂ聤ρԁ쁤ʁ΁, ǁρ߁ǁ΁Ɂ. 偤ǁ, nil ́Ɓ
(<tt>GGraph.line</tt>΁聣). 
</p><br>

<p> 쁤ǁρ, ΁Ɂ聥ၥÁɁ΁ׁ灥󁤁ɁƁ߁聤. 
</p><br>

<table width=80%><tr><td><pre class="source">
irb(main):004:0> <span class="command">GGraph.contour( nil, true, 'help'=>true )</span>
<< Description of options >>
  option name   default value   # description:
  "title"       nil     # Title of the figure(if nil, internally
                        # determined)
  "annotate"    true    # if false, do not put texts on the right
                        # margin even when newframe==true
  "transpose"   false   # if true, exchange x and y axes
  "min" nil     # minimum contour value
  "max" nil     # maximum contour value
  "nlev"        nil     # number of levels
  "interval"    nil     # contour interval
  "nozero"      nil     # delete zero contour
  "coloring"    false   # set color contours with ud_coloring
  "clr_min"     13      # (if coloring) minimum color id
  "clr_max"     100     # (if coloring) maximum color id
  "help"        false   # show help message if true
  "levels"      nil     # contour levels (Array/NArray of Numeric)
  "index"       nil     # (if levels) line index(es) (Array/NArray of
                        # integers, Integer, or nil)
  "line_type"   nil     # (if levels) line type(s) (Array/NArray of
                        # integers, Integer, or nil)
  "label"       nil     # (if levels) contour label(s) (Array/NArray of
                        # String, String, true, false, nil). nil is
                        # recommended.
  "label_height"        nil     # (if levels) label height(s) (Array/NArray
                        # of Numeric, Numeric, or nil). nil is recommended.
 Current values={"label_height"=>nil, "annotate"=>true, "help"=>true, "title"=>nil, "coloring"=>false, "transpose"=>false, "max"=>nil, "nlev"=>nil, "line_type"=>nil, "min"=>nil, "clr_max"=>100, "index"=>nil, "levels"=>nil, "interval"=>nil, "nozero"=>nil, "label"=>nil, "clr_min"=>13}
NumRu::Misc::HelpMessagingException: ** help messaging done **
        from /usr/local/lib/ruby/site_ruby/1.6/numru/misc/keywordopt.rb:343:in `interpret'
        from /usr/local/lib/ruby/site_ruby/1.6/numru/ggraph.rb:1350:in `contour'
        from (irb):4
irb(main):005:0> 
</pre></td></tr></table>
<br>

<p>΁끲́遤끤聤, 
ԁÁÁǁ <tt>NumRu::Misc::HelpMessagingException</tt> 
ȁ΁び򁾁偤끤ȁǁԁ쁤. irb 򁻁ȁÁƁ끾쁹, ΁び偤끤
恤恡ˁ́ၤꁼ΁ׁ큥󁥁ׁȁɁ쁤. ׁ큥遥򁥁Ձ끤
끾쁹, ā́ρ΁び偤끤ȁԁÁÁǁ. ÁÁǁʁ쁹, 
΁聤 begin  rescure  end ၤǁʁ݁쁤Ё聤. 
</p><br>

<a name='help_ggraph'></a>
<p><a href="help_ggraph.rb">help_ggraph.rb</a>
<table width=80%><tr><td><pre class="source">
require "numru/ggraph"
include NumRu
begin
  print "\n** optoions of  GGraph.line **\n"
  GGraph.line( nil, true, 'help'=>true )
rescue
end
begin
  print "\n** optoions of  GGraph.contour **\n"
  GGraph.contour( nil, true, 'help'=>true )
rescue
end
</pre></td></tr></table>
<br>

<p>ԁ끲́ irb ΁쁹灤ȁƁ́́ʁ΁ǁʁ΁. 
helpׁ灥󁤁ɁՁ遤쁤끤΁΁ၥÁɁ, 
<tt>GGraph.fig</tt>, <tt>GGraph.axes</tt>, <tt>GGraph.mark</tt>,
<tt>GGraph.tone</tt> ǁ. 
</p><br>


<hr>
<a name="h2:ggraph konasi2">
<p><h2>GGraph򁻁ȁʁ(2)</h2><br>
</a>

<p> 偵 help ၥÁɁǁʁ끤聤, 
GGraph ΁Ɂ聥ၥÁɁˁρ́́ʁׁ灥󁤁. 
ׁ灥󁤁ˁ聤끻؁āꁤρ΁ˁꁤ, 
ǁՁ끥ȁÁ́ʁс끤ȁ, ΁偤Áȁ́ʁ߁āꁤ⁤ǁ. 
ʁˁ΁つ򁼁. 

<a name="h3:contour-tone auto">
<p><h3>󁥁ȁ (쁥ف끼Ɓ)</h3><br>
</a>

<p>΁ׁ큥遥򁼁ԁ聤. 

<a name='contour101'>
<p><a href="contour101.rb">contour101.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/ggraph"
 1: include NumRu
 2: gphys = GPhys::IO.open('T.jan.nc', 'T')
 3: 
 4: #< DCL΁ׁ󁤁ȁ߁ā >
 5: DCL.gropn(1)
 6: DCL.sldiv('y',2,2)           # 2x2ˁ́́ʁ, 'y'=yoko: 偢偢...
 7: DCL.sgpset('lcntl', false)   # ʁ򁲁򁼁ၤʁ
 8: DCL.sgpset('lfull',true)     # ́́Ɂ
 9: DCL.uzfact(0.75)             # Ɂ΁ʁ΁󁥁 0.75 ǁ
10: DCL.sgpset('lfprop',true)    # ׁ큥݁灥ʁ끥Ձ󁥁ȁ򁻁ȁ
11: 
12: #< GGraph ˁ聤 Ɂ >
13: GGraph.set_fig('viewport'=>[0.15,0.75,0.15,0.6])    # set_*: Áȁ́ʁ߁ā
14: # 1ˁ́
15: GGraph.contour( gphys )
16: GGraph.tone( gphys, false, 'ltone'=>false )        # 큰ʁˁǁ󁥁
17: # 2ˁ́
18: GGraph.next_fig('itr'=>2 )                         # next_*: ́ʁ߁ā
19: GGraph.contour( gphys.average(0), true, 'color'=>true )        # Ɓ󁥁
20: # 3ˁ́
21: GGraph.set_axes('xunits'=>'','yunits'=>'')  # ʁ΁ --> ΁Á́ρ񁤁ʁ
22: GGraph.tone( gphys.cut(true,true,70) )        # tone ΁ǁՁ끥ȁρ遡Ɂ
23: GGraph.contour( gphys.cut(true,true,70), false )  # 2 false -> Ł́񁤁
24: # 4ˁ́
25: GGraph.set_linear_contour_options( 'min'=>0, 'nlev'=>20 )  
26:                  # contour΁ǁՁ끥ȁʁс. 󁤁΁߁́next_linear..⁤
27: GGraph.contour( gphys.average(0) )
28: 
29: #< ށ >
30: DCL.grcls
</pre></td></tr></table>

<p>ԁ끤, ΁聤ˁ󁥁ځӁŁɁꁤ΁ށ4ˁɁ쁤끤
ǁ. 
Ɓԁ΁⁤ρׁ큥遥Á恤ˁ񁤁Ɓ끤΁ǁށɁׁ́ʁ큤. 
ǁρɁ􁤁⁤. 
16ԁ́܁ǁ <tt>'ltone'=>false</tt> ˁ聤, 
Á́큰ʁ΁΁΁聤ˁЁ끥ǁ󁥁ȁʁ. 
쁤 DCL ΁ȁ󁥁遥ց遥ꁡ UEPACK ΁ׁ灥󁤁΁ށށǁ. 
Á, UEPACK ǁ 'ltone' == false ǁՁ끥ȁǁ끤΁ˁЁ, 
GGraph ǁ 'ltone' == true 򁥁ǁՁ끥ȁˁƁ. 
</p><br>

<p>
遤, ȁ́ˁ끤ȁʁ. GGraphǁ, ȁ́ˁɁ聥ၥÁ 
<tt><i>hogehoge</i></tt> ˁЁ, ׁ灥󁤁΁ǁՁ끥ȁÁ́ʁс
<tt>set_<i>hogehoge</i></tt> ߁. ށ, ׁ灥󁤁ȁ끤ˁ
ā, 끤ρׁ灥󁤁򁻁ȁȁ΁߁ǁʁ́΁ၤ, 
<tt>next_<i>hogehoge</i></tt> ȁၥÁɁ́сՁƁ, 
󁤁 <tt><i>hogehoge</i></tt> ΁߁ˁƁ́
ʁāށꁷ끲́ <tt><i>hogehoge</i></tt> ˁׁ灥󁤁́끤΁ȁƁ. 
, <tt>contour</tt>΁쁹, Ɓ쁥فˁ؁
<tt>(set|next)_linear_contour_options</tt> , 쁥ف끤́ہˁ؁āꁤ
<tt>(set|next)_contour_levels</tt> ˁʁ쁤Ɓ. ŁɁꁡǁ󁥁
򁹁ԁ <tt>tone</tt> ˁāƁƁ́. 
</p><br>

<p><a href='contour101.png'>contour101.rbԁ끲<br>
   <img src='contour101s.png'></a><br>
</p><br>

<p>
<tt>contour</tt> ǁ, ׁ灥
<tt>coloring</tt>߁āꁤ끤, 遡󁥁. ΁쁹, 
ׁ灥󁤁ǁ󁥁΁ǁÁ́ȁǁÁ́ˁ䁤ŁƁ끿򁻁؁āꁤǁ
(<tt>clr_min</tt>  <tt>clr_max</tt>). 
</p><br>

<p>
󁥁ȁ󁥁쁥ف끤, ǁ́́Łʁ쁥ف끻؁āꁤ򁹁ԁʁ쁤, 
Łցցˁ쁤. 
΁, ǁ⁽Ё́聤끤, (1)ǁÁ(<tt>min</tt>), 
(2)ǁÁ(<tt>max</tt>), (3)ց(<tt>interval</tt>)ށρˁ܁
(<tt>nlev</tt>), ΁ā΁с遥ၥ
ǁՁā򁻁؁āꁤƁ恤끤ȁ⁤ǁ. 
ցցȁˁ܁􁤁΁΁ʁ򁻁؁āꁤ끤, 偼ԁρ́끤쁤. 
ǁŁʁ <tt>DCL.udgcl[ab]</tt>, <tt>DCL.uegtl[ab]</tt>
ˁǁ쁤끤΁, ؁āꁤǁ灡ǁÁ́ρځꁤ΁聤Á́ˁʁс쁤. 
Ł, <tt>icycle</tt> ʁɁ <tt>(UD|UE)PACK</tt> ΁с遥ၥ⁲򁼁ၤ쁤. 
<tt>tone</tt> ˁƁǁ󁥁򁹁ԁၤ, ׁ灥
<tt>ltone</tt>  <tt>false</tt> ˁ끤, Áˁ쁥ف򁤁䁤ၤ끤
ʁ΁, ρ⁤ <tt>UEPACK</tt> ΁с遥ၥ <tt>ltone</tt>  
<tt>true</tt> ˁʁÁƁ쁤, 䁤ρꁥ遡ȁ󁤁Ɂ쁤끤ȁˁʁ
ʁȁÁ큰Ձ򁴁끤, Ɓ΁ʁꁤˁ́򁤁΁ށށ΁́
Ɓ끡. 
<tt>contour</tt> ˁ, Á́큤΁󁥁򁼁聤ꁽׁ灥󁤁
(<tt>nozero</tt>). 
</p><br>

<a name="h3:color bar">
<p><h3>遡Ё</h3><br>
</a>

<p> <tt>GGraph.coloar_bar</tt> ρā tone
Ɂ聤ˁ؁끥遡ЁɁ
(ā΁́с, ́ہˁ쁥ف끤ȁс󁤁򁻁؁āꁤ끤ȁ⁤ǁ끤,
ށꁻȁʁ큤). ˁ遡Ё΁Ɂ΁つ򁼁.
́ʁ؁āꁤЁ́聤끤ȁʁ끤ǁ큤.
</p><br>

<a name='color_bar.rb'>
<p><a href="color_bar.rb">color_bar.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/ggraph"
 2: include NumRu
 3: gphys = GPhys::IO.open('T.jan.nc', 'T')
 4: 
 5: #< DCL΁ׁ󁤁ȁ߁ā >
 6: DCL.gropn(1)
 7: DCL.sldiv('y',2,2)           # 2x2ˁ́́ʁ, 'y'=yoko: 偢偢...
 8: DCL.sgpset('isub', 96)       # ɁՁ򁼁ʁʁс: '_' --> '`'
 9: DCL.sgpset('lfull',true)     # ́́Ɂ
10: DCL.uzfact(0.75)             # Ɂ΁ʁ΁󁥁 0.75 ǁ
11: DCL.sgpset('lfprop',true)    # ׁ큥݁灥ʁ끥Ձ󁥁ȁ򁻁ȁ
12: 
13: #< GGraph ˁ聤 Ɂ >
14: GGraph.set_fig('viewport'=>[0.15,0.7,0.2,0.6])    # set_*: Áȁ́ʁ߁ā
15: # 1ˁ́
16: GGraph.tone( gphys.cut(true,true,850) )
17: GGraph.contour( gphys.cut(true,true,850), false )
18: GGraph.color_bar                          # 遡Ё (ǁՁ끥ȁρ)
19: 
20: # 2ˁ́
21: GGraph.next_fig('viewport'=>[0.2,0.75,0.2,0.6])
22: GGraph.tone( gphys.cut(true,true,850) )
23: GGraph.contour( gphys.cut(true,true,850), false )
24: GGraph.color_bar('left'=>true,'labelintv'=>1)   # ˁɁ, Ɂ􁥁遥ف(1ā)
25: 
26: # 3ˁ́
27: GGraph.next_fig('itr'=>2 )
28: GGraph.tone( gphys.mean(0), true, 'int'=>4)
29: GGraph.color_bar('vlength'=>0.5,"landscape"=>true,'tickintv'=>0)
30:                     # ā؁ā, ˁɁ, tick markʁ(0΁쁹灤΁ƁÁ΁)
31: 
32: # 4ˁ́
33: GGraph.next_fig('itr'=>2 )
34: rmiss = DCL.glpget('rmiss')
35: GGraph.tone( gphys.mean(0), true, 'levels'=>
36:              [rmiss,-70,-60,-50,-40,-30,-20,-10,0,10,20,rmiss] )
37: GGraph.color_bar("voff"=>0.04)        # 灤Áȁ́ʁˁˁ΁
38:                                       # ށ́灤 GrADS Ɂˁсˁʁ
39: 
40: #< ށ >
41: DCL.grcls
</pre></td></tr></table>

<p><a href='color_bar.png'>color_bar.rbԁ끲<br>
   <img src='color_bar_s.png'></a><br>
</p><br>

<a name="h3:map projection">
<p><h3>ÁρށŁꁱ</h3><br>
</a>

<p> DCL ˁρÁρށŁꁱƁǁ끡
GGraph ǁρ쁤򁻁ȁ䁤ˁ遥ÁׁƁā󁶁끡
ŁꁱƁˁρɁʁсȁց恤ǁ؁āꁤ끡
GGraph ǁ΁ÁρށŁꁱƁ΁ˁށρ<a 
href="http://ruby.gfd-dennou.org/products/ruby-dcl/ruby-dcl-doc/grph1/node8.html">DCLˁÁρށŁꁱƁˁ΁</a> 򁰁ƁɁ쁤
</p><br>

<p>
DCL݁ȁÁρށŁꁱƁˁρǁ끡
<ul> 
<li><b>߁Łށˁ</b> 
     <div ALIGN="CENTER"> 
<table CELLPADDING="3" BORDER="1"> 
<tr><td ALIGN="CENTER">ȁց</td> 
<td ALIGN="CENTER">   ˁ</td> 

<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
</tr> 
<tr><td ALIGN="CENTER">10</td> 
<td ALIGN="CENTER">߁Łށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER">Ё</td> 

</tr> 
<tr><td ALIGN="CENTER">11</td> 
<td ALIGN="CENTER">ၥ끥ȁ끿ށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
</tr> 
<tr><td ALIGN="CENTER">12</td> 
<td ALIGN="CENTER">⁥끥ǁށˁ</td> 
<td ALIGN="CENTER"></td> 

<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
</tr> 
<tr><td ALIGN="CENTER">13</td> 
<td ALIGN="CENTER">ρ󁥁ၥ끿ށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
</tr> 
<tr><td ALIGN="CENTER">14</td> 

<td ALIGN="CENTER">Á끥ȁ6ށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
</tr> 
<tr><td ALIGN="CENTER">15</td> 
<td ALIGN="CENTER">ˁ́Łāʁ߁ށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 

<td ALIGN="CENTER"></td> 
</tr> 
</table></div> 
<p> 
<li><b>߁큿ށˁ</b> 
     <div ALIGN="CENTER"> 
<table CELLPADDING="3" BORDER="1"> 
<tr><td ALIGN="CENTER">ȁց</td> 
<td ALIGN="CENTER">    ˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 

<td ALIGN="CENTER"></td> 
</tr> 
<tr><td ALIGN="CENTER">20</td> 
<td ALIGN="CENTER">߁큿ށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER">Ё</td> 
</tr> 
<tr><td ALIGN="CENTER">21</td> 
<td ALIGN="CENTER">遥󁥁ف끥ȁс߁큿ށˁ</td> 

<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
</tr> 
<tr><td ALIGN="CENTER">22</td> 
<td ALIGN="CENTER">遥󁥁ف끥ȁс߁큿ށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 

</tr> 
<tr><td ALIGN="CENTER">23</td> 
<td ALIGN="CENTER">܁󁥁́ށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
</tr> 
</table></div> 
<p> 
<li><b>ʁ́ށˁ</b> 
     <div ALIGN="CENTER"> 

<table CELLPADDING="3" BORDER="1"> 
<tr><td ALIGN="CENTER">ȁց</td> 
<td ALIGN="CENTER">    ˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
</tr> 
<tr><td ALIGN="CENTER">30</td> 
<td ALIGN="CENTER">́ށˁ</td> 
<td ALIGN="CENTER"></td> 

<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
</tr> 
<tr><td ALIGN="CENTER">31</td> 
<td ALIGN="CENTER">݁遡Ɓ쁥ށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
</tr> 
<tr><td ALIGN="CENTER">32</td> 

<td ALIGN="CENTER">ʁ́ށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER">ʁ́</td> 
</tr> 
<tr><td ALIGN="CENTER">33</td> 
<td ALIGN="CENTER">遥󁥁ف끥ȁсʁ́ށˁ</td> 
<td ALIGN="CENTER"></td> 
<td ALIGN="CENTER"></td> 

<td ALIGN="CENTER"></td> 
</tr> 
</table></div></ul> 
</p><br>

<p>
GGraph ǁρ쁤쁤ˁЁց聤ˁׁ遤ׁǁՁ끥ȁ߁āꁤ́с
Ɓ끡ށρʁÁʁׁ큥遥ǁā΁ŁꁱƁˁǁɁ聤Ɓ߁聤
</p><br>

<a name='map_proj1.rb'>
<p><a href="map_proj1.rb">map_proj1.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
 1: itr = ARGV[0] ? ARGV[0].to_i : 10
 2: 
 3: require "numru/ggraph"
 4: include NumRu
 5: gphys = GPhys::IO.open('T.jan.nc', 'T')
 6: DCL.gropn(1)
 7: DCL.sgpset('lcntl', false)
 8: DCL.sgpset('lclip', true)
 9: DCL.uzfact(0.7)
10: DCL.sgpset('lfull',true)
11: GGraph.set_fig 'itr'=>itr, 'viewport'=>[0.15,0.85,0.1,0.6]
12: GGraph.set_map 'coast_world'=>true
13: GGraph.tone( gphys )
14: DCL.grcls
</pre></td></tr></table>

΁ׁ큥遥ρ聰쁰􁤁ȁƁÁρށŁꁱƁȁց恤򁤁ȁ끡
߁Łށˁ߁큿ށˁʁ́ށˁɁƁ߁Łށˁ(10), 
߁큿ށˁ(20), ́ށˁ(30) 򁻁Ɓ߁끡

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby map_proj1.rb 10</span>
% <span class="command">ruby map_proj1.rb 20</span>
% <span class="command">ruby map_proj1.rb 30</span>
</pre></td></tr></table>
<br>

<p> 쁤쁤΁끲́򁼁
<table><tr><td>
<a href='map_proj1_itr10.png'><br>
<img src='map_proj1_itr10_s.png'><br>ruby map_proj1.rb 10 ԁ끲</a>
</td>
</tr><tr>
<td>
<a href='map_proj1_itr20.png'><br>
<img src='map_proj1_itr20_s.png'><br>ruby map_proj1.rb 20 ԁ끲</a>
</td>
<td>
<a href='map_proj1_itr30.png'><br>
<img src='map_proj1_itr30_s.png'><br>ruby map_proj1.rb 30 ԁ끲</a>
</td></table>
</p><br>

<p>
<h4>ā΁ƁÁʁ́ʁŁꁱƁˁˁā</h4>

<p> 

݁遡Ɓ쁥ށˁ(ȁց31)΁쁹灡ǁՁ끥ȁǁρ́́΁ˁށ쁤
ʁāꁵȁρρ́󁤁ށǁˁӁ偡݁ȁˁɁ聤ǁၤ끤ၤˁρ

<table width=80%><tr><td><pre class="source">
DCL.sgpset('lclip', true)
</pre></td></tr></table>

򁻁؁āꁤ끡
</p><br>

<p> 
߁Łށˁʁȁց10ˁρ恤끰ށŁفЁŁفɁǁ끡΁쁹灡
linear-linearā򁺁Ɂʁȁց10ˁ́с΁Ɂ򁽁񁤁ȁǁ끡
<tt>GGraph</tt> ΁ၥÁ <tt>contour, tone, line</tt> ˁƁׁ灥
<tt>'map_axes'</tt>  <tt>true</tt> ˁ؁āꁤ끡
</p><br>

<a name='map_axes_itr10.rb'>
<p><a href="map_axes_itr10.rb">map_axes_itr10.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/ggraph"
 2: include NumRu
 3: gphys = GPhys::IO.open('T.jan.nc', 'T')
 4: DCL.gropn(1)
 5: DCL.sgpset('lcntl', false)
 6: DCL.sgpset('lclip', true)
 7: DCL.uzfact(0.7)
 8: DCL.sgpset('lfull',true)
 9: GGraph.set_fig 'itr'=>10, 'viewport'=>[0.15,0.85,0.1,0.6]
10: GGraph.set_map 'coast_japan'=>true
11: GGraph.tone( gphys.cut('lon'=>120..150,'lat'=>20..50), true, 'map_axes'=>true )
12: DCL.grcls
</pre></td></tr></table>

<p><a href='map_axes_itr10.png'>map_axes_itr10.rbԁ끲<br>
   <img src='map_axes_itr10_s.png'></a><br>
</p><br>


<p>
<h4>ÁρށŁꁱƁ؁ρׁ灥</h4>
</p><br>

<p>
ÁρށŁꁱƁ؁΁ׁ灥󁤁ρ<tt>GGraph::fig</tt> 
<tt>GGraph::map</tt> ˁ끡
<tt>GGraph::fig</tt>΁Áρށ؁ׁ灥󁤁ρ
<ul>
 <li> <tt>map_radius</tt>: ߁/ʁ́ށˁ΁쁹灤΁ÁρށȁʁŁف
 <li> <tt>window</tt>, <tt>map_window</tt>: ߁ŁɁρ΁쁹灤΁΁ށŁفځŁفȁρ
      (<tt>map_fit=true</tt>΁쁹ԁ́с쁤Ё΁Ɂ)
 <li> <tt>map_axis</tt> Áρށ΁ցׁˁ؁ DCL::umscnt ΁с遥ၥ
</ul>

<p>
<tt>GGraph::map</tt>΁灤ʁׁ灥󁤁ρ

<ul>
 <li> <tt>coast_world</tt>, <tt>coast_japan</tt>,
      <tt>border_world</tt>, <tt>plate_world</tt>, 
      <tt>state_usa</tt>, <tt>pref_japan</tt> : true ʁÁρށƁˁ܁Áρށ
      񁶁ׁ쁡ȁʁƁ񁽁򁤁
 <li> <tt>fill</tt> : ÁρށŁɁāف
 <li> <tt>grid</tt>: ށŁفЁŁفʁҁ򁤁
 <li> <tt>dgridmj</tt>, <tt>dgridmn</tt> : ށŁفЁŁفʁҁց(ف)
</ul>

<p>
܁ρ΁聤ˁׁ灥 <tt>help</tt> ǁɁ쁤끡

<table width=80%><tr><td><pre class="source">
>> <span class="command">require "numru/ggraph"</span>
=> true
>> <span class="command">NumRu::GGraph.fig nil, nil, 'help'=>true</span>
<< Description of options >>
  option name   default value   # description:
  "new_frame"   true    # whether to define a new frame by DCL.grfrm
                        # (otherwise, DCL.grfig is called)
  "itr" 1       # coordinate transformation number
  "viewport"    [0.2, 0.8, 0.2, 0.8]    # [vxmin, vxmax, vymin, vymax]
  "window"      nil     # (for itr<10,>50) [uxmin, uxmax, uymin, uymax].
                        # each element allowd nil (only for itr<5,>50)
  "xreverse"    "positive:down,units:hPa"       # (for itr<10,>50) Assign
                        # max value to UXMIN and min value to UXMAX if
                        # condition is satisfied (nil:never, true:always,
                        # String: when an attibute has the value specified
                        # ("key:value,key:value,..")
  "yreverse"    "positive:down,units:hPa"       # (for itr<10,>50) Assign
                        # max value to UYMIN and min value to UYMAX if
                        # condition is satisfied (nil:never, true:always,
                        # String: when an attibute has the value specified
                        # ("key:value,key:value,..")
  "similar"     nil     # 3-element float array for similar
                        # transformation in a rectangular curvilinear
                        # coordinate, which is fed in
                        # DCL:grssim:[simfac,vxoff,vyoff],  where simfac
                        # and [vxoff,vyoff] represent scaling factor and
                        # origin shift, respectively.
  "map_axis"    nil     # (for all map projections) 3-element float
                        # array to be fed in DCL::umscnt: [uxc, uxy, rot],
                        # where [uxc, uyc] represents the tangential point
                        # (or the pole at top side for cylindrical
                        # projections), and rot represents the rotation
                        # angle. If nil, internally determined. (units:
                        # degrees)
  "map_radius"  nil     # (for itr>=20: conical/azimuhal map
                        # projections) raidus around the tangential point.
                        # (units: degrees)
  "map_fit"     nil     # (Only for itr=10(cylindrical) and 11
                        # (Mercator)) true: fit the plot to the data window
                        # (overrides map_window and map_axis); false: do
                        # not fit (then map_window and map_axis are used);
                        # nil: true if itr==10, false if itr==11
  "map_window"  [-180, 180, -75, 75]    # (for itr<20: cylindrical
                        # map projections) lon-lat window [lon_min,
                        # lon_max, lat_min, lat_max ] to draw the map
                        # (units: degres)
  "help"        false   # show help message if true
 Current values={"map_window"=>[-180, 180, -75, 75], "help"=>true, "similar"=>nil, "map_axis"=>nil, "window"=>nil, "new_frame"=>true, "itr"=>1, "map_fit"=>nil, "yreverse"=>"positive:down,units:hPa", "viewport"=>[0.2, 0.8, 0.2, 0.8], "xreverse"=>"positive:down,units:hPa", "map_radius"=>nil}
NumRu::Misc::HelpMessagingException: ** help messaging done **
        from /usr/local/lib/ruby/site_ruby/1.8/numru/misc/keywordopt.rb:386:in `interpret'
        from /usr/local/lib/ruby/site_ruby/1.8/numru/ggraph.rb:2261:in `fig'
        from (irb):5
>> <span class="command">NumRu::GGraph.map 'help'=>true</span>
<< Description of options >>
  option name   default value   # description:
  "lim" true    # draw map lim (t or f)
  "grid"        true    # draw map grid (t or f)
  "vpt_boundary"        false   # draw viewport boundaries (f, t or
                        # 1,2,3.., representing the line width)
  "wwd_boundary"        false   # draw worksation window boundaries (f, t
                        # or 1,2,3.., representing the line width)
  "fill"        false   # fill the map if coast_world or coast_japan is
                        # true (t or f)
  "coast_world" false   # draw world coast lines (t or f)
  "border_world"        false   # draw nation borders (t or f)
  "plate_world" false   # draw plate boundaries (t or f)
  "state_usa"   false   # draw state boundaries of US (t or f)
  "coast_japan" false   # draw japanese coast lines (t or f)
  "pref_japan"  false   # draw japanese prefecture boundaries (t or
                        # f)
  "dgridmj"     nil     # the interval between the major lines of
                        # latitudes and longitudes. If nil, internally
                        # determined. (units: degrees) (this is a UMPACK
                        # parameter, which is nullified when uminit or
                        # grfrm is called)
  "dgridmn"     nil     # the interval between the minor lines of
                        # latitudes and longitudes. If nil, internally
                        # determined. (units: degrees) (this is a UMPACK
                        # parameter, which is nullified when uminit or
                        # grfrm is called)
  "help"        false   # show help message if true
 Current values={"dgridmn"=>nil, "help"=>true, "border_world"=>false, "lim"=>true, "wwd_boundary"=>false, "fill"=>false, "coast_japan"=>false, "dgridmj"=>nil, "vpt_boundary"=>false, "coast_world"=>false, "plate_world"=>false, "grid"=>true, "state_usa"=>false, "pref_japan"=>false}
NumRu::Misc::HelpMessagingException: ** help messaging done **
        from /usr/local/lib/ruby/site_ruby/1.8/numru/misc/keywordopt.rb:386:in `interpret'
        from /usr/local/lib/ruby/site_ruby/1.8/numru/ggraph.rb:2546:in `map'
        from (irb):6
</pre></td></tr></table>


<h4>遤ʁ끥󁥁ׁ</h4>

<p> <a href='map_projection.rb'>΁󁥁ׁ끥ׁ큥遥<a>
    遤ȁ΁ˁ灤΁ށƁ遤쁤끡ہǁ򁻁ȁÁƁʁɁʁ
    쁤Ё́ˁ쁤
<table>
 <tr>
   <td> 
    <a href='map_projection_p1.png'><img src='map_projection_p1_s.png'><br>1ˁ́</a>
   </td><td>
    <a href='map_projection_p2.png'><img src='map_projection_p2_s.png'><br>2ˁ́</a>
  </td><td>
    <a href='map_projection_p3.png'><img src='map_projection_p3_s.png'><br>3ˁ́</a>
  </td></tr><tr><td>
    <a href='map_projection_p4.png'><img src='map_projection_p4_s.png'><br>4ˁ́</a>
  </td><td>
    <a href='map_projection_p5.png'><img src='map_projection_p5_s.png'><br>5ˁ́</a>
  </td><td>
 </tr>
</td></table>
</p><br>

<a name="h3:pressure why">
<p><h3>΁ρρÁ́΁灤ہˁ́聤끤΁ρʁ</h3><br>
</a>

<p>
΁ρρ΁ˁ灤ہɁŁفāつ΁, ʁ끤ȁŁԁ灤ǁρ끤, 
⁻؁āꁤʁ΁ˁʁ끤΁ρɁԁƁ́ʁԁ쁤Ɓ끤遤ǁ큤
, فȁȁ,  NetCDF Ձ끤ˁ񁤁Ɓ끤΁, 
쁤򁲁򁼁ၤƁ끤ށǁǁ. <a href="#ncdump T.jan.nc">T.jan.nc 
ncdump ˁ聤Ɂ</a>򁤁߁끤, ʁс <tt>level</tt> ˁ, 
<tt>positive</tt> , Á́ <tt>"down"</tt> ȁʁÁƁ. 
쁤, NetCDF 恡Ɂˁʁ⁤΁, 
΁󁥁ف󁥁灥󁤁ǁɁŁʁȁʁÁƁ
(<a href="http://www.gfd-dennou.org/arch/gtool4/conventions/" target=_top>gtool4
NetCDF ́</a>򁻁ȁ΁). 
</p><br>

<p>ǁ, <tt>positive</tt> ɁՁƁʁǁρɁ쁤Ё
΁큤. GGraph ρ쁤ǁہ΁Ɓ遤쁤Ɓ끤΁ǁ灾Ɂׁǁ. 
΁Łˁ, ၥÁ <tt>fig</tt> ΁с遥ၥ΁ǁՁ끥ȁÁ́ʁс쁤Ё聤. 
</p><br>

<p> ށρ, Á2ԁ΁ׁ큥遥򁼁ԁƁ߁聤. 
ʁՁ끤ˁʁƁ irb ǁʁǁ끡
</p><br>

<a name='fig_help'>
<p><a href="fig_help.rb">fig_help.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
require "numru/ggraph"
NumRu::GGraph.fig( nil, true, 'help'=>true )
</pre></td></tr></table>
<br>

<p>
끤, ʁ΁聤ˁׁ灥󁤁΁ၥˁ偡Ɂ쁤. 
</p><br>

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby fig_help.rb</span>
<< Description of options >>
  option name   default value   # description:
  "new_frame"   true    # whether to define a new frame by DCL.grfrm
                        # (otherwise, DCL.grfig is called)
  "itr" 1       # coordinate transformation number
  "viewport"    [0.2, 0.8, 0.2, 0.8]    # [vxmin, vxmax, vymin, vymax]
  "window"      nil     # (for itr<10,>50) [uxmin, uxmax, uymin, uymax].
                        # each element allowd nil (only for itr<5,>50)
  "xreverse"    "positive:down,units:hPa"       # (for itr<10,>50) Assign
                        # max value to UXMIN and min value to UXMAX if
                        # condition is satisfied (nil:never, true:always,
                        # String: when an attibute has the value specified
                        # ("key:value,key:value,..")
  "yreverse"    "positive:down,units:hPa"       # (for itr<10,>50) Assign
                        # max value to UYMIN and min value to UYMAX if
                        # condition is satisfied (nil:never, true:always,
                        # String: when an attibute has the value specified
                        # ("key:value,key:value,..")
  "similar"     nil     # 3-element float array for similar
                        # transformation in a rectangular curvilinear
                        # coordinate, which is fed in
                        # DCL:grssim:[simfac,vxoff,vyoff],  where simfac
                        # and [vxoff,vyoff] represent scaling factor and
                        # origin shift, respectively.
  "map_axis"    nil     # (for all map projections) 3-element float
                        # array to be fed in DCL::umscnt: [uxc, uxy, rot],
                        # where [uxc, uyc] represents the tangential point
                        # (or the pole at top side for cylindrical
                        # projections), and rot represents the rotation
                        # angle. If nil, internally determined. (units:
                        # degrees)
  "map_radius"  nil     # (for itr>=20: conical/azimuhal map
                        # projections) raidus around the tangential point.
                        # (units: degrees)
  "map_lat_range"       nil     # (for itr<20: cylindrical map projections)
                        # latitudinal range to draw the map. By default
                        # (nil), the map is drawn between 75E and 75S.
                        # (units: degres)
  "help"        false   # show help message if true
 Current values={"help"=>true, "similar"=>nil, "map_axis"=>nil, "window"=>nil, "new_frame"=>true, "itr"=>1, "map_lat_range"=>nil, "yreverse"=>"positive:down,units:hPa", "viewport"=>[0.2, 0.8, 0.2, 0.8], "xreverse"=>"positive:down,units:hPa", "map_radius"=>nil}
/usr/local/lib/ruby/site_ruby/1.8/numru/misc/keywordopt.rb:343:in `interpret': ** help messaging done ** (NumRu::Misc::HelpMessagingException)
        from /usr/local/lib/ruby/site_ruby/1.8/numru/ggraph.rb:2083:in `fig'
        from fig_help.rb:2
</pre></td></tr></table>
<br>

<p>ށ΁偲΁Á΁ɁÁ (<tt>uxmin, uxmax, uymin, uymax</tt>)
ρׁ灥 <tt>window</tt> ǁ聤ށ끤΁, Ɂ΁偲Ɓ
쁤, 쁤́ہˁ߁āꁤ끤ȁ΁ˁǁ. 
, 쁤ǁρ́́ʁށ򁽁񁤁쁹灤ρɁԁʁ؁ǁ. 
, <tt>window</tt> ߁āꁤ, ƁȁÁǁ΁ʁс聤. 
쁤򁹁ԁ΁, ׁ灥 <tt>xreverse</tt>, <tt>yreverse</tt> ǁ. 
偤΁Ё΁ρ, ǁՁ끥ȁÁ́ȁ⁤ "positive:down,units:hPa"
ȁʁÁƁ끤ȁ. 쁤,  positive ߁
Ɓ΁Á́ "down" ǁ끤, ށ  units ߁Ɓ΁Á́
"hPa" ǁ끾쁹灤, ށρ偲򁵁Ձˁ끤ȁՁ́ǁ. 
ȁȁ, ρ䁤Áсꁰ΁ρƁÁʁ́Ɓ΁ǁ끤, 
́сǁǁ
<tt>level</tt> ΁Á́ hPa ǁʁ milibarȁʁÁƁ끤΁, 
쁤ǁρʁ. 
</p><br>

<p>
ǁՁ끥ȁÁ́΁つ "units:mb,units:hPa,units:milibar" ˁʁс쁤, 
 units  "mb", "hPa", "milibar" ΁쁤΁쁹灤ˁÁʁց
߁āꁤˁʁ끡

<table width=80%><tr><td><pre class="source">
GGraph.set_fig( "xrev"=>"units:mb,units:hPa,units:milibar",
                "yrev"=>"units:mb,units:hPa,units:milibar")
</pre></td></tr></table>

<p> ʁ, ΁ρƁÁʁ́끤, み聤 postive ǁɁ遤쁤, 
"positive:down" ȁ쁤Ё΁Ɂ. 
ʁ, <tt>xreverse</tt>, <tt>yreverse</tt>  <tt>nil</tt>
߁āꁤ쁤ЁˁÁʁց򁹁ԁ, <tt>true</tt> ȁ쁤ЁˁÁʁց. 
ȁÁƁ́ށρ <tt>window</tt> ́ہˁ؁āꁤ쁤쁤, 쁤ˁ. 

</p><br>

<a name="h3:tone levels">
<p><h3>ȁ󁥁쁥ف끤΁恡؁ā</h3><br>
</a>

<p>
GGraphǁ, 󁥁䁥ȁ(ŁɁ)΁쁥ف끤ǁہ΁󁤁ǁ́ہˁ؁āꁤ끤ȁЁ́聤. 
</p><br>

<p>ȁ󁤁ρ쁥ف끤ȁсȁց恤ǁ؁āꁤ쁤. сȁց恤ρȁȁ󁥁с
󁤁Ɓˁ؁āꁤ. ΁Ł́́<a
href="http://ruby.gfd-dennou.org/products/ruby-dcl/ruby-dcl-doc/" target=_top>
RubyDCL΁ށˁ健</a> (GRPH1΁ցׁ́)򁻁ȁ΁. 
GGraph ǁ, ȁ󁤁 <tt>GGraph.set_tone_levels</tt>
ǁ߁āꁤ끤(ʁ偷сŁˁ́с끾쁹), <tt>GGraph.tone</tt> ΁ׁ灥
<tt>'levels'</tt>  <tt>'patterns'</tt> ˁ聤ꁻ؁āꁤ(΁쁸). 
ʁʁ, ߁΁ǁ, 偼ԁ򁻁ȁȁ쁰ʁ
<tt>GGraph.set_tone_levels</tt> ρ́ˁʁ끤, 
ʁ遤ʁ聤ˁā́āꁡ

<p>쁤ǁ, 䁤ʁ΁つǁ. 

<a name='tone201'>
<p><a href="tone201.rb">tone201.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/ggraph"
 2: include NumRu
 3: gphys = GPhys::NetCDF_IO.open('T.jan.nc', 'T')
 4: 
 5: #< DCL΁ׁ󁤁ȁ߁ā >
 6: DCL.gropn(1)
 7: DCL.sldiv('y',2,2)           # 2x2ˁ́́ʁ, 'y'=yoko: 偢偢...
 8: DCL.sgpset('lcntl', false)   # ʁ򁲁򁼁ၤʁ
 9: DCL.sgpset('lfull',true)     # ́́Ɂ
10: DCL.sgpset('lfprop',true)    # ׁ큥݁灥ʁ끥Ձ󁥁ȁ򁻁ȁ
11: 
12: #< GGraph ˁ聤 Ɂ >
13: GGraph.set_fig('viewport'=>[0.15,0.82,0.15,0.6])
14: # 1ˁ́
15: GGraph.set_tone_levels( 'levels'=>[-20,-15,-10,-5,0],
16:                         'patterns'=>[10999,20999,30999,40999] )
17: GGraph.tone( gphys )
18: # 2ˁ́
19: GGraph.tone( gphys, true, 'lev'=>[-20,0,20],     # 쁥ف끡с󁤁́ہˁ؁ā
20:              'pat'=>[20999,40999,70999,80999] ) # с󁤁΁ʁ1āށ灤ށ
21: GGraph.contour( gphys, false, 'lev'=>[-20,0,20], 'index'=>3 )      # ́ށ
22: # 3ˁ́
23: GGraph.tone( gphys, true, 'lev'=>[-20,0,20], 
24:                     'pat'=>[40999,70999,80999] ) # 쁥ف끤ȁƁ􁢁܁灤ށǁȁā
25: # 4ˁ́
26: GGraph.tone( gphys, true, 'lev'=>[-20,0,20], 
27:                     'pat'=>[40999,70999] )    # с󁤁΁ہ1āցŁɁ
28: #< ށ >
29: DCL.grcls
</pre></td></tr></table>
<br>

<p>15ԁ́܁聤ꁲ⁤. 1516ԁ́܁ǁ, ȁ󁤁΁쁥ف끤ȁсȁց恤߁āꁤƁ. 
<tt>GGraph.set_tone_levels</tt> ǁ, 'levels'  'patterns'
΁΁ʁ΁с遥ၥǁہ΁󁤁ǁ؁āꁤ. <tt>GGraph.tone</tt>
䁸偽ҁ끥󁥁΁쁹灤ȁȁ끤ၥׁ灥󁤁΁򁼁聤ÁƁ끤, 
΁ʁȁ⁾ʁ΁Ё́聤ʁʁāށˁ܁Łρׁ灥󁤁ǁρʁ. 
쁥ف끤߁āꁤ끤ʁ避Ɓˁ؁āꁤʁ쁤Ёʁ遤ʁ. 
17ԁ́܁, ā΁߁āꁤˁÁ1ˁ́܁΁ށɁ聤. 
1920ԁ́܁ǁ, 쁥ف끤ȁс󁤁 <tt>GGraph.tone</tt> ΁ׁ灥󁤁ȁ
́ہˁ؁āꁤ, ˁ́܁Ɂ聤Ɓ. 
؁āꁤс󁤁ρ쁥ف끤聤ׁ́ǁā, 
΁쁹, ݁, levels[0], levels[1], .., levels[-1], ܁
΁ցŁɁ遤쁤. ׁ灥́΁偤큤ʁ΁Ё́聤끤΁ρˁҁفā́. 
ʁ, ȁ󁥁쁥ف끤ʁꁤ䁤聤󁥁
Ł́񁤁. 󁥁΁쁥ف߁āꁤˁāƁρ偽ҁ. 
2324ԁ́܁ρˁ́܁Ɂ聤. 쁥ف끤ȁс󁤁΁ׁ́ǁ􁤁Ł, 
΁쁹 levels[0], levels[1], .., levels[-1], ܁ ΁ցŁɁ遤쁤. 
2627ԁ́܁4ˁ́܁ǁ, с󁤁΁ہāׁ́ǁʁ΁, 
levels ΁ցŁɁ遤쁤. 쁥ف끤ȁс󁤁΁ׁ́ǁ􁤁΁؁
쁤遰ʁ΁쁹灤ρ΁びȁ. 


<p><a href='tone201.png'>tone201.rbԁ끲<br>
   <img src='tone201s.png'></a><br>
</p><br>

<tt></tt>

<a name="h3:contour levels">
<p><h3>󁥁쁥ف끤΁恡؁ā</h3><br>
</a>

<p> 
󁥁쁥ف끤ǁہ΁󁤁ǁ́ہˁ؁āꁤʁˁ́. 
󁥁΁쁹灤, ˁ܁ˁ܁ˁ΁Ł, ́́ʁс遥ၥ, 
쁤遤⁷聤ၤ́Ёʁ遤ʁ, 
GGraph ǁ, ́́сԁ΁ʁ؁򁹁́Ɓāǁʁꁾʁ΁ށρʁ΁ǁ끤聤ˁʁÁƁ. 
ȁ󁤁΁쁹灤ȁƁ́, 쁥ف끤΁߁āꁤ <tt>GGraph.set_contour_levels</tt>
ǁ߁āꁤ끾쁹(ʁ偷сŁˁ́с끾쁹), 
<tt>GGraph.contour</tt> ΁ׁ灥󁤁ǁ؁āꁤ끾쁹 (΁쁸)
΁ā́ꁤ. ؁āꁤ끥с遥ၥ, ɁɁׁ́ <tt>'levels'</tt>
ˁÁ, ׁ灥󁤁 <tt>'index'</tt>, <tt>'line_type'</tt>,
<tt>'label'</tt>, <tt>'label_height'</tt> ǁ. 
ʁ쁤遤 <tt>DCL.udsclv</tt> ΁с遥ၥǁ. 
GGraph , ʁ΁쁤⁤΁򁰁ʁ΁聤ˁˁÁƁāꁤ, 
<tt>DCL.udsclv</tt> 򁸁Ɓ. 

</p><br>

<p>
쁤ǁ, ʁ΁ׁ큥遥򁼁ԁ聤. 

<a name='contour201'>
<p><a href="contour201.rb">contour201.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
 1: require "numru/ggraph"
 2: include NumRu
 3: gphys = GPhys::NetCDF_IO.open('T.jan.nc', 'T')
 4: 
 5: #< DCL΁ׁ󁤁ȁ߁ā >
 6: DCL.gropn(1)
 7: DCL.sldiv('y',2,2)           # 2x2ˁ́́ʁ, 'y'=yoko: 偢偢...
 8: DCL.sgpset('lcntl', false)   # ʁ򁲁򁼁ၤʁ
 9: DCL.sgpset('lfull',true)     # ́́Ɂ
10: DCL.sgpset('lfprop',true)    # ׁ큥݁灥ʁ끥Ձ󁥁ȁ򁻁ȁ
11: 
12: #< GGraph ˁ聤 Ɂ >
13: GGraph.set_fig('viewport'=>[0.15,0.82,0.15,0.6])
14: levels = 5*( NArray.float(7).indgen! )                # NArray: [0,5,10,...]
15: mj = DCL.udpget('indxmj')
16: mn = DCL.udpget('indxmn')
17: # 1ˁ́
18: GGraph.set_contour_levels( 'levels'=>levels, 'index'=>mj )    # 󁥁߁ā
19: GGraph.contour( gphys )
20: # 2ˁ́
21: GGraph.contour( gphys, true, 'lev'=>levels, 
22:                 'index'=>[mj,mn], 'line_type'=>[1,2,2,2] )
23: # 3ˁ́
24: GGraph.contour( gphys, true, 'lev'=>levels, 
25:                 'index'=>mn, 'label'=>true )
26: # 4ˁ́
27: GGraph.contour( gphys, true, 'lev'=>levels, 
28:                 'index'=>mn, 'label'=>['A','B','C','D'],
29:                 'label_height'=>[0.015,0.02,0.025,0.03] )
30: #< ށ >
31: DCL.grcls
</pre></td></tr></table>
<br>

<p> 14ԁ́܁ǁ, Á恿ȁ [0,5,10,...] ǁ NArray
1ǁہ΁󁤁Ɓ. <tt>indgen!</tt>
ρÁ恿ȁ <tt>[0,1,2,..]</tt> ǁÁց끥ၥÁɁ, NArray ǁρ΁Ɂȁ쁤. 
󁥁ˁ遥ف끤򁽁񁤁Ɂ, ǁՁ끥ȁǁρ΁ (index) , 
UDPACK ΁с遥ၥ 'indxmj' ˁŁɁǁȁÁǁƁ (遴Á́3). 
18ԁ́܁ǁρׁ灥 'index' ˁ쁤򁻁؁āꁤƁ끤΁, 
19ԁ́܁ǁ񁤁쁤끥󁥁ˁ, 󁥁쁥فÁ́򁼁遥ف끤ɁՁƁ. 
'index' Ł΁ׁ灥󁤁ǁ, 遡؁āꁤ쁤쁤ЁƁ΁󁥁
ˁ΁Á́Ł́с끤聤ˁʁÁƁ. 

<p> 2ˁ́܁΁ށʁ߁, contour ΁ׁ灥󁤁ǁ́ہˁ쁥فŁ򁻁؁āꁤƁɁ
Ɓ. 2ˁ́܁ǁ, index  <tt>[mj, mn]</tt> ȁǁہ΁󁤁ǁ́遤쁤Ɓ. 
΁쁹, [mj, mn, mj, mn,...] ȁʁցȁ򁼁ၤ쁤. 
΁ׁ灥󁤁ˁāƁƁ́́ǁ. line_type  <tt>[1,2,2,2]</tt>
ʁ΁, <tt>[1,2,2,2, 1,2,2,2,..]</tt> ȁ򁼁ၤ쁤. 
3ˁ́܁΁ށǁ, label  true ȁ؁āꁤƁ끤΁, Ɓ΁󁥁ˁ遥ف
򁽁񁤁. 4ˁ́܁ǁρ遥ف끤΁ʁ΁󁤁́ہˁ؁āꁤƁ (label
<tt>true</tt> ʁ遥󁥁쁥ف끤Ɂʁ΁󁤁ƁɁ􁤁ǁƁ񁤁, 
ʁ΁󁤁́遤쁤쁹灤ρ쁤򁻁ȁ). 4ˁ́܁ǁ, label_height ˁ聤
ʁ΁󁤁΁灤򁸁āˁ߁āꁤƁ. , Ɂā́ρ΁ˁʁс큤. 
΁쁹 label_height 򁻁ȁ, UDPACK ΁с遥ၥ RSIZEL
ʁс끤ȁ򁴁ၤ. 

<p><a href='contour201.png'>contour201.rbԁ끲<br>
   <img src='contour201s.png'></a><br>
</p><br>

<a name="h3:layout">
<p><h3>쁥ȁˁŁ</h3><br>
</a>

<p> ŁꁹƁρʁˁЁ́с΁ށǁ, 쁥ȁˁŁꁤ큤. 
GGraph, DCL΁΁ρʁ쁥ȁǁ򁳁聤ׁ聤ˁʁÁƁ. 
</p><br>

<p> ΁΁つǁ, ʁ􁤁΁с́끤Ɂׁ́ʁɁȁ끡遥ف끤
́ƁÁꁤ, ށځ́󁤁. 
ځ́󁤁, DCL.sldiv 򁻁ȁ,
1Ձ쁡Á恤ˁʁ􁤁΁ށǁہÁց끤ȁǁԁ. 
΁ၤˁƁށ΁Ӂ偡݁ȁ́ہˁ߁āꁤ, 
遤ˁȁ끤΁񁤁ʁ⁺فāƁ끤΁, 
ρāʁÁƁ. 
Ɓ΁ށ󁥁Ɂˁ؁Ɓ RubyDCL ΁ށˁ健끤򁻁ȁ΁. 

<a name='layout1'>
<p><a href="layout1.rb">layout1.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
require "numru/ggraph"
include NumRu
gphys = GPhys::NetCDF_IO.open('T.jan.nc', 'T')

DCL.gropn(1)
DCL.sgpset('lcntl', false)   # ʁ򁲁򁼁ၤʁ
DCL.sgpset('lfull',true)     # ́́Ɂ
DCL.sgpset('lcorner',false)  # ʁށ򁽁񁤁ʁ
DCL.uzfact(0.35)             # Ɂ΁ʁ΁󁥁āꁿǁ
DCL.sgpset('lfprop',true)    # ׁ큥݁灥ʁ끥Ձ󁥁ȁ򁻁ȁ
DCL.udpset('lmsg',false)     # 󁥁ցցȁɁ

vpt = NArray[0.05, 0.45, 0.05, 0.25]             # Ӂ偡݁ȁ (2:1)
vpt00 = ( vpt + ([0.050]*2 + [0.32]*2) ).to_a    # x,yʁˁ遤Array
vpt01 = ( vpt + ([0.474]*2 + [0.32]*2) ).to_a    # x,yʁˁ遤Array
vpt10 = ( vpt + ([0.050]*2 + [0.10]*2) ).to_a    # x,yʁˁ遤Array
vpt11 = ( vpt + ([0.474]*2 + [0.10]*2) ).to_a    # x,yʁˁ遤Array

GGraph.set_fig('viewport'=>vpt00)
GGraph.set_axes('xunits'=>'','yunits'=>'','xtitle'=>'') 
DCL.uzpset('labelxb',false)
GGraph.contour( gphys.cut(true,true,1000), true, 'annot'=>false, 'titl'=>'' )
DCL.uzpset('pad1',0.2) ; DCL.uxsttl('t','1000 hPa',-1) ; DCL.uzpset('pad1',0.7)

GGraph.set_fig('viewport'=>vpt01, 'new_frame'=>false)
GGraph.set_axes('ytitle'=>'')
DCL.uzpset('labelyl',false)
GGraph.contour( gphys.cut(true,true,250), true, 'annot'=>false, 'titl'=>'' )
DCL.uzpset('pad1',0.2) ; DCL.uxsttl('t','250 hPa',-1) ; DCL.uzpset('pad1',0.7)

GGraph.set_fig('viewport'=>vpt10, 'new_frame'=>false)
GGraph.set_axes('ytitle'=>nil,'xtitle'=>nil)
DCL.uzpset('labelyl',true); DCL.uzpset('labelxb',true)
GGraph.contour( gphys.cut(true,true,70), true, 'annot'=>false, 'titl'=>'' )
DCL.uzpset('pad1',0.2) ; DCL.uxsttl('t','70 hPa',-1) ; DCL.uzpset('pad1',0.7)

GGraph.set_fig('viewport'=>vpt11, 'new_frame'=>false)
GGraph.set_axes('ytitle'=>'')
DCL.uzpset('labelyl',false)
GGraph.contour( gphys.cut(true,true,10), true, 'annot'=>false, 'titl'=>'' )
DCL.uzpset('pad1',0.2) ; DCL.uxsttl('t','10 hPa',-1) ; DCL.uzpset('pad1',0.7)

DCL::sgtxzv(0.5,vpt00[3]+0.028,'January Monthly Mean Temperature',
	    1.15*DCL.uzpget('rsizec2'),0,0,3)

DCL.grcls

print "\n** PRESSURE LEVELS ** " ; p gphys.coord(2).val
</pre></td></tr></table>
<br>

<p><a href='layout1.png'>layout1.rbԁ끲<br>
   <img src='layout1s.jpg'></a><br>
</p><br>


<a name="h3:zahyou jiku">
<p><h3>ɁˁŁ</h3><br>
</a>

<p> GGraph ρɁɁ聤 DCL  USPACK ˁǁ끡<tt>DCL.usxaxs</tt>,
<tt>DCL.usyaxs</tt>򁸁Ɓց. ǁ, ƁɁՁɁՁꁡUCPACḰ́с, U[XY]PACK
򁻁ȁÁƁ聤ꁺفɁ恤끤ˁρɁ쁤Ё΁큤
΁Ł, ΁ȁ, GGraph ˁ񁤁ʁǁ񁤁, ǁ. 
GGraph ǁ򁽁񁤁ၥÁ axes Ɂ, 
ʁ΁聤ˁׁ灥 <tt>'xside'</tt>, <tt>'yside'</tt>
ǁ恤ǁ. ΁つ X 򁲁Ɂʁ, <tt>'xside'=>'b'</tt>
ǁ. ǁՁ끥ȁ΁遴Á́ <tt>'xside'=>'tb'</tt>,
<tt>'yside'=>'lr'</tt>. 

<a name='axes1'>
<p><a href="axes1.rb">axes1.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
require "numru/ggraph"
include NumRu
gphys = GPhys::IO.open('T.jan.nc', 'T')
DCL.gropn(1)
DCL.sgpset('lfull',true) ; DCL.uzfact(0.6)
GGraph.set_fig( 'itr'=> 2, 'viewport'=>[0.25,0.7,0.15,0.6] )
GGraph.set_axes( 'xside'=>'b', 'yside'=>'l' )
GGraph.line( gphys.mean(0,1), true, 'exchange'=>true, 'annot'=>false )
DCL.grcls
</pre></td></tr></table>

<p><a href='axes1.png'>axes1.rbԁ끲<br>
   <img src='axes1s.png'></a><br>
</p><br>

<p>
GGraph 򁻁ȁÁƁ񁤁ʁÁȁ큤 UCPACK Łǁ偤遺Ɂ򁽁񁤁Ё΁Ɂ. 
</p><br>

<hr>
<a name="h2:dRuby">
<p><h2>󁳁ցǁˁ끡</h2><br>
</a>

<p> GPhys , 큡끤ʁǁ偤΁Ձ끤ǁʁ, 󁳁ցЁ
Áցǁˁ끤ၤ΁ρȁȁ߁ꁤˁ́򁤁ā聤ˁЁ́聤Ɓ. 
ʁǁ, OPeNDAP/DODS ȁ cgi ˁ聤끱󁳁ցցȁā󁶁ʁӁ
dRuby ȁ Ruby
ˁʁցȁ遥ց遥ꁡ́́с΁つ򁼁.
</p><br>

<p>dRuby򁻁ȁÁ遥󁥁ȁЁׁ
<a href="#h3:dRuby-1">ʁԁ΁</a>, <a href="#h3:dRuby-2">ʁԁ
</a> ǁρ󁳁ցā󁶁 GPhys ցȁ򁸁ǁāꁤʁÁʁ΁つ́с
Łȁ߁́끡Łȁ߁ρȁ⁤ȁ쁹灤ρȁЁƁ
<a href="#h3:druby_gdir_services">GDir򁻁ȁÁށʁ</a> ˁʁ
΁ɁGDir 򁻁ȁÁƁǁ쁥ȁꁡāꁡˁ󁳁ց끤ၤ
GPhys ȁ߁߁遥ց遥ꁡ gphys-remote ˁāƁ́끡
</p><br>

<p>
偤ρCGI 䁥ꁥ쁡灥ʁ끥ǁف΁́́сցӁ
ˁāƁ⁽񁤁́āꁤǁ끡
</p><br>

<a name="h3:opendap">
<p><h3>OPeNDAP/DODŚс󁳁ցǁ</h3><br>
</a>

<p><a href="http://www.opendap.org/">OPeNDAP/DODS</a> ρCGI ˁ聤
󁳁ցǁā󁶁Ӂǁ끡ǁ NetCDF Ł΁Ձ끤ˁށ
ʁ́΁́΁Á́ǁǁ́́ʁЁǁ́с遤쁤Ɓ끡
Ł遤ρ́΁؁ԁȁ򁤁ρၤ⁤΁ǁ(DODS=Distributed Ocean Data 
Sytem)ǁցŁ΁Ɓ灥󁥁ǁȁʁҁŁǁǁƁˁ
ȁ쁤Ɓ끡GPhys ȁƁ́́ʁՁ́ǁ΁ǁ΁Áꁾ݁򁹁ԁȁǁ
ʁ􁤁΁Ձ끷ƁŁˁ݁ȁƁ끡
</p><br>

<p>OPeNDAP/DODS  "Grid" ȁƁցǁ(遥)ˁ聤ꁡɁÁ́ȁ
ҁŁÁ́遤ʁ GPhys ȁƁ́́ʁցȁ򁹁ԁOPeNDAP/DODS Ё
ˁ聤Á NetCDF Ձ끤ǁ쁤ЁƁŁˁɁʁс􁤁΁򁼁ၤ򁹁ԁ Grid 
ցȁ򁷁끡
</p><br>

<p> ށOPeNDAP/DODS Ё NetCDF 遥󁥁ȁ遥ց遥ꁡ
ā󁶁쁤Ɓꁡ쁤́с끤 NetCDF ΁Ձ́΁偤ꁤ
OPeNDAP/DODS  URL ́끤ȁǁ󁳁ցǁ򁥁󁥁큡Ɂ끤ȁ
ā܁ƁɁȁǁ끡΁݁Ёˁ끥Ձ끤 NetCDF ǁ
Ɓ΁ɁNetCDF Łʁǁ򁻁ÁƁɁׁ́끡Ɓ
󁥁ǁ HDF ǁ΁ρ쁤ˁʁ
</p><br>

<p> GPhys ΁ǁ Ruby/NetCDF ρOPeNDAP/DODS Ё NetCDF
遥󁥁ȁ󁥁ȁ끤쁤Ɓ끾쁹灡
󁥁с끻ˁ遤򁥁ꁥ󁥁끤聤ʁ߁āꁤˁʁÁƁ끡Vine 
Debian ́с΁ЁʁꁡсÁǁ⁡ʁÁƁ끡΁쁹灡
Ձ́ȁ OPeNDAP/DODS URL ́끤ǁ큡끤
NetCDF Ձ끤ȁƁ́́΁ƁɁ߁񁤁ǁ끡
</p><br>

<p> 쁤ǁρǁˁƁ߁聤ǁ
<a href="http://davis.rish.kyoto-u.ac.jp/" target=_top>ŁŁǁ恳ځɁ􁥁ǁЁ</a>
偤΁݁ā́ʁ󁥁ǁ́с끡OPeNDAP/DODS ǁρǁ쁥ȁꁡ
ʁہ끥ˁρā́ html ЁȁƁ́́ˁց遥끤ȁǁ끡
<a
href="http://davis-dods.rish.kyoto-u.ac.jp/cgi-bin/nph-dods/jmadata/gpv/latest/gpv/"  target=_top>ǁၣցց󁤁΁ǁ</a>
聥⁥ǁ RSM ΁ǁ΁́ʁ󁥁ǁ΁́́ǁ
<a href="http://davis-dods.rish.kyoto-u.ac.jp/cgi-bin/nph-dods/jmadata/gpv/latest/gpv/latest/RSM_P_latest.nc.html" target=_top>
ǁՁ끤΁ʁ</a> ˁƁ߁聤ǁၤ遤쁤Ɓ
NetCDF Ձ끤΁؁Áʁ󁤁 html ⁤΁Ɂ쁤끤ρ
ʁс́ˁ temp ʁɁ끤ȁ끡
</p><br>

<p> 
ǁρ쁤򁲁ā끲聤<a href="#h3:irb_startup_gdir">ցȁ
ׁՁ끤΁́́(2) -- GDir ΁́́с</a>ǁҁ irbrc_ggraph
́сЁρÁŁˁԁ끤ȁˁ끡
</p><br>

<table width=80%><tr><td><pre class="source">
% <span class="command">irb_ggraph --simple-prompt</span>
Start interactive GGraph session
 *** MESSAGE (SWDOPN) ***  GRPH1 : STARTED / IWS =  1.                         
>> <span class="command">GPhys::IO.var_names('http://davis-dods.rish.kyoto-u.ac.jp/cgi-bin/nph-dods/jmadata/gpv/latest/gpv/latest/RSM_P_latest.nc')</span>
=> ["lon", "lat", "p", "time", "ref_time", "z", "u", "v", "temp", "rh", "omega"]
>> <span class="command">temp = GPhys::IO.open('http://davis-dods.rish.kyoto-u.ac.jp/cgi-bin/nph-dods/jmadata/gpv/latest/gpv/latest/RSM_P_latest.nc', 'temp')</span>
=> &lt;GPhys grid=&lt;4D grid &lt;axis pos=&lt;'lon' in 'http://davis-dods.rish.kyoto-u.ac.jp/cgi-bin/nph-dods/jmadata/gpv/latest/gpv/latest/RSM_P_latest.nc'  sfloat[60]&gt;&gt;
        &lt;axis pos=&lt;'lat' in 'http://davis-dods.rish.kyoto-u.ac.jp/cgi-bin/nph-dods/jmadata/gpv/latest/gpv/latest/RSM_P_latest.nc'  sfloat[75]&gt;&gt;
        &lt;axis pos=&lt;'p' in 'http://davis-dods.rish.kyoto-u.ac.jp/cgi-bin/nph-dods/jmadata/gpv/latest/gpv/latest/RSM_P_latest.nc'  sfloat[16]&gt;&gt;
        &lt;axis pos=&lt;'time' in 'http://davis-dods.rish.kyoto-u.ac.jp/cgi-bin/nph-dods/jmadata/gpv/latest/gpv/latest/RSM_P_latest.nc'  sfloat[18]&gt;&gt;&gt;
   data=&lt;'temp' in 'http://davis-dods.rish.kyoto-u.ac.jp/cgi-bin/nph-dods/jmadata/gpv/latest/gpv/latest/RSM_P_latest.nc'  sfloat[60, 75, 16, 18]&gt;&gt;
>> <span class="command">set_fig 'itr'=>10</span>
=> {"itr"=>1}
>> <span class="command">set_map 'coast_japan'=>true</span>
=> {"coast_japan"=>false}
>> <span class="command">tone temp</span>
=> nil
>> <span class="command">contour temp, false</span>
=> nil
</pre></td></tr></table>

<p>
ʁ偤ǁ΁聤ʁށ끡
</p><br>

<p><a href='opendap1.png'>ԁ끲<br>
<img src='opendap1_s.png'></a><br>

<a name="h3:dRuby-1">
<p><h3>dRuby򁻁ȁÁ遥󁥁ȁЁʁʁԁ΁</h3><br>
</a>

<p> <b>Á큰ՁꁤÁ聤ၤȁˁρρȁ􁤁Ё
<a href="#h3:druby_gdir_services">GDir򁻁ȁÁށʁ</a>
ˁʁȁ΁Ɂ</b>
</p><br>

<p> <a href="http://www2a.biglobe.ne.jp/~seki/ruby/druby.html" target=_top>
dRuby</a> , Ruby΁ၥÁɁƁЁ򁳁ȁā, ́ÁȁہˁၥÁɁƁЁ
򁹁ԁ끤聤ˁ遥ց遥ꁡǁ. Ruby 1.8 ˁ, ɁŁɁՁ
Ɓ. Ruby 1.6 ށǁǁ⁥󁥁큡ɁƁ󁥁ȁ끤쁤Ё΁Ɂ. 
dRuby 򁻁ȁȁꁥ⁡ȁׁ큥偤΁ցȁ؁΁, 
큡끤ʁցȁ؁΁ȁƁ聤ˁǁ. 
ā́ꁼꁤƁƁ끥ށ󁤁 OS ŁہʁÁƁ́ꁤʁ. 
...ʁɁȁ쁤Ɓ, Ɂ́򁤁ˁ΁ā΁ԁ󁤁ȁ́聤ʁ⁤쁤ʁ΁, ΁つǁ. 
</p><br>

<p>ʁρʁÁʁЁׁ큥遥ǁ. 쁤ށǁȁÁƁ <tt>T.jan.nc</tt>
Á恤΁ǁ򁥁ꁥ⁡ȁׁ큥ˁā󁶁. 
⁤⁼́сŁʁЁ򁺁끤ʁ, ʁ􁤁΁ǁā󁶁, ށɁ쁤򁻁ȁЁ끤ǁ큤, ǁ dRuby ΁āǁ򁼁ȁ򁼁灴つ, 
ǁ聤ǁ΁ʁÁʁ΁つȁ. 

<a name='druby_serv1'>
<p><a href="druby_serv1.rb">druby_serv1.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
1: require "drb/drb"
2: require "numru/gphys"
3: include NumRu
4: gp = GPhys::IO.open("T.jan.nc","T")
5: DRb.start_service(nil, gp)
6: puts 'URI: '+DRb.uri
7: puts '[return] to exit'
8: gets
</pre></td></tr></table>

<p>1ԁ́܁ dRuby ΁큡Ɂǁ. 24ԁ́܁ρƁ. ǁ, 
Ձ <tt>T.jan.nc</tt> Á恤΁ʁс T  GPhys ցȁ򁹁, 
ʁс gp ˁ䁤ŁƁƁ. ΁, 聤 dRuby ΁ŁЁ쁤ǁ. 
5ԁ́܁ǁρ聤ˁÁ GPhys ցȁ򁡁ցՁ큥󁥁ȁ󁥁Ɂׁȁ
dRuby Ӂ򁵁ƁƁ. 끤, ʁ́΁ׁ큥Ɓ
ˁށǁ遤ˁʁց΁,  GPhys ցȁ؁΁ȁȁʁ. 
<tt>DRb.start_service</tt> ΁聣􁤁 nil ˁƁ끤΁, 
ā́ˁȁ݁ȁρƁŁˁ聤ၤ遤쁤끡ʁ݁ȁ򁻁؁āꁤ끤ȁ⁽Ё́聤끡. 
6ԁ́܁ǁ, ΁݁ȁȁց恤򁴁ށ, 
΁ၤ URI (URL) Ɂ. ׁ큥򁽁΁ʁ聤, 
8ԁ́܁ gets ǁƁ΁ρԁˁƁ. ԁ򁲁Ё΁끤΁, 7ԁ́܁ǁ 
'[return] to exit' ȁɁ. 쁤ǁρށ, 
΁Ё遤Ɓ߁聤. 

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby druby_serv1.rb</span>
URI: druby://horihost:45461
[return] to exit
</pre></td></tr></table>

<p> Ɂ쁤 URI , ׁ큥ȁ끤 druby , ہȁ́ horihost, 
䁤ŁƁ遤쁤݁ȁȁց恤 45461 ǁ끤ȁ򁰁Ձ́. 
Łہȁ́ρށ󁰁́ǁ끤, 
݁ȁȁց恤ρʁƁ΁ǁˁԁ΁Łفˁʁсꁤ. 

<p> , ΁Ёˁ܁끥遥󁥁ȁ΁ʁÁʁ΁つ򁼁. 

<a name='druby_cli1'>
<p><a href="druby_cli1.rb">druby_cli1.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
1: require "drb/drb"
2: DRb.start_service
3: uri = ARGV.shift || raise("Usage: % #{$0} uri")
4: gp = DRbObject.new(nil, uri)
5: p gp.class
6: p gp.name
7: p gp.rank
8: p gp.shape
9: print gp.coord(2).name,"\n"
</pre></td></tr></table>

<p>ׁ큥遥򁲁⁤, 쁤򁼁ԁ쁹灤΁끲́򁼁. 
聤ہɁЁ URI  <tt>druby://horihost:45461</tt> ȁЁ΁, 
쁤ˁف, ΁聤ˁ遤. 

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby druby_cli1.rb druby://horihost:45461</span>
DRb::DRbObject
"T"
3
[36, 19, 9]
level
</pre></td></tr></table>

<p> , ȁԁ끲́򁲁⁤. 
1ԁ́܁ρЁȁƁǁ. 2ԁ́܁ǁ <tt>DRb.start_service</tt>
򁸁Ɓ󁤁ǁ. 􁤁ʁ΁쁹灤, Ձ큥󁥁ȁ󁥁Ɂցȁʁǁ. 
΁ׁ큥<b></b>΁܁򁼁ʁ遥󁥁ȁȁƁρ쁤ǁ΁Ɂ. 
3ԁ́܁ǁ, ԁˁ́􁤁ƁɁ߁󁤁ǁ. <tt>||</tt> ʁ, 
⁤⁰􁤁ʁÁ쁹灤ˁ΁び򁾁偤Ɓԁ򁻁߁ၤ. 偤΁ԁ΁つǁ
􁤁 <tt>druby://horihost:45461</tt> ʁ΁, 쁤ʁ΁󁤁ȁ
ʁс uri ˁƁ쁤. ԁ́܁ǁ, <tt>DRbObject.new(nil, uri)</tt>
ˁ聤,  uri ˁЁƁ܁򁳁΁΁. ΁끲, 
Ёˁ끥Ձ큥󁥁ȁ󁥁Ɂցȁ؁΁ȁ́сցȁ
遤, ʁс <tt>gp</tt> ˁƁ쁤. Á, ǁ <tt>gp</tt>
, ЁǁGPhys ցȁˁɁ끤ȁˁʁ. 
5ԁ́܁ʁ߁ǁ, ΁Ձ큥󁥁ȁ󁥁ɁˁЁ, 
́́ʁၥÁɁՁ, ΁끲́ɁЁ΁ρˁЁ΁ρ. 
ȁЁ΁ρ򁸁ȁ恤فƁ߁聤. 5ԁ́܁ǁ <tt>gp</tt>
ˁ遥́䁹灤Ɓ. ၥÁ <tt>class</tt> ρ큡끤ˁ́, dRuby
΁ꁥ⁡ȁցȁǁ끤ȁ򁼁 <tt>DRb::DRbObject</tt>
Ɂ쁤끡class ρƁ΁ցȁÁƁ끤΁, 
<tt>DRb::DRbObject</tt> ŁÁƁ끡. 
6ԁ́܁ʁ߁, name Ł΁ၥÁɁ, 
<tt>DRb::DRbObject</tt> ˁρʁ΁, Ёˁ遤쁤Ɓԁ, 
΁끲́遥󁥁ȁˁā́쁤. 
΁聤ˁ, 
́ "T" 3ǁǁ끤ȁʁɁ́遤ˁʁ끤΁ǁ. 
ʁ, 遥󁥁ȁׁ큥遥ǁ GPhys 遥ց遥ꁡ
큡ɁƁʁȁˁÁ큰Ձ. 遥󁥁ȁɁׁ́ʁ΁ GPhys
ցȁˁЁ끻ȁǁ끾쁹灤, Ɂׁ́ʁ΁ǁ. 

<p> ʁ偤聤, dRuby 򁻁ȁ, ꁥ⁡ȁׁ큥Ɓ⁤΁ցȁ, 
ׁ큥Ɓ⁤΁ցȁȁƁ聤ˁЁ́聤끤ȁÁǁ
큤. ʁ, 偤΁Ёȁ遥󁥁ȁ򁰁쁤āˁށȁၤƁƁȁ򁤁끡ʁāށʁ́ʁˁ, 
ʁ΁聤ˁʁ. Ёȁ遥󁥁ȁ, 
쁤ȁȁȁ򁷁ҁǁ끤ȁʁ끤ǁ큤. 

<a name='druby_self-contained1'>
<p><a href="druby_self-contained1.rb">druby_self-contained1.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
1: require "numru/gphys"
2: include NumRu
3: gp = GPhys::IO.open("T.jan.nc","T")
4: p gp.class
5: p gp.name
6: p gp.rank
7: p gp.shape
8: print gp.coord(2).name,"\n"
</pre></td></tr></table>

<p> ԁ끲́ρʁ΁ā́. Ё΁ρ쁤끥遥́ GPhys ˁʁÁ
ʁρƁǁ. 

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby druby_self-contained1.rb </span>
NumRu::GPhys
"T"
3
[36, 19, 9]
level
</pre></td></tr></table>
<br>

<a name="h3:dRuby-2">
<p><h3>dRuby򁻁ȁÁ遥󁥁ȁЁʁʁԁ΁</h3><br>
</a>

<p>
偤΁΁つȁŁ, ǁ΁ށ򁽁񁤁Ɓ߁聤. 
ǁ򁻁ā΁ρЁ, ށ򁽁񁤁΁ρ遥󁥁ȁǁ. 
ǁ, ށЁׁ큥遥򁼁. 
Ɂၤ΁ǁہ΁󁥁ǁ(NArray), 
遥󁥁ȁˁ DCL ˁŁρɁׁ́끤, 
NArray ρ΁ށށǁ dRuby ǁ쁤ʁ. 
聤Á, NArray 򁳁ȁāƁ쁤끤聤ˁɁׁ́, ぴԁ. 
ʁ΁,  58 ԁ́܁쁤ǁ. ʁ߁ˁ쁤ρȁ߁߁΁⁥偡
Marshal  NArray Ё끤ၤ΁ȁāǁ. 
΁āɁÁʁ druby_serv1.rb ȁƁ. 聤Á, ԁʁˁƁ. 

<a name='druby_serv2'>
<p><a href="druby_serv2.rb">druby_serv2.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
 1: require "drb/drb"
 2: require "numru/ggraph"
 3: include NumRu
 4: 
 5: class NArray
 6:   def self._load(o); to_na(*Marshal::load(o)).ntoh; end
 7:   def _dump(limit); Marshal::dump([hton.to_s, typecode, *shape]); end
 8: end
 9: 
10: gp = GPhys::IO.open("T.jan.nc","T")
11: DRb.start_service(nil, gp)
12: puts 'URI: '+DRb.uri
13: puts '[return] to exit'
14: gets
</pre></td></tr></table>

<p> , 遥󁥁ȁǁ. 遤Ɓ́́ NArray 򁳁ȁā. 

<a name='druby_cli2'>
<p><a href="druby_cli2.rb">druby_cli2.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
 1: require "drb/drb"
 2: require "numru/ggraph"
 3: include NumRu
 4: 
 5: class NArray
 6:   def self._load(o) to_na(*Marshal::load(o)).ntoh end
 7: end
 8: 
 9: DRb.start_service
10: uri = ARGV.shift || raise("Usage: % #{$0} uri")
11: gp = DRbObject.new(nil, uri)
12: DCL.gropn(1)
13: DCL.sldiv('y',2,1)
14: DCL.sgpset('lcntl',false)
15: DCL.uzfact(0.7)
16: GGraph.set_fig('viewport'=>[0.15,0.75,0.2,0.8])
17: GGraph.contour( gp.cut('level'=>100) )
18: GGraph.next_fig('itr'=>2)
19: GGraph.contour( gp.mean(0) )
20: DCL.grcls
</pre></td></tr></table>

<p> Ё

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby druby_serv2.rb</span>
URI: druby://horihost:45469
[return] to exit
</pre></td></tr></table>

<p> 遥󁥁ȁ

<table width=80%><tr><td><pre class="source">
% <span class="command">ruby druby_cli2.rb druby://horihost:45469</span>
 *** MESSAGE (SWDOPN) ***  GRPH1 : STARTED / IWS =  1.      
 *** WARNING (STSWTR) ***  WORKSTATION VIEWPORT WAS MODIFIED.
 *** MESSAGE (SWPCLS) ***  GRPH1 : PAGE =   1 COMPLETED.
 *** MESSAGE (SWDCLS) ***  GRPH1 : TERMINATED.
</pre></td></tr></table>

<p><a href='druby_cli2.png'>druby_cli2.rbԁ끲<br>
   <img src='druby_cli2s.png'></a><br>
</p><br>

<p> 聤ہɁ΁΁つȁƁ́, 遥󁥁ȁǁ, 
ҁȁŁفЁ΁Ձ큥󁥁ȁցȁ򁼁Ɓ偤, 
ǁ큡끤ˁ끤΁ȁƁ́́ˁÁƁ. 
</p><br>

<p> ΁聤ˁȁȁʁ΁ʁ́򁤁Ɂׁ́끾쁹灤ρ끤, 
ȁꁤ, Ɂ́΁ၤˁŁρ⁤΁ρʁ끤ȁЁƁЁ΁Ɂ큤. 
ȁ⁤, 偤΁΁つ聤ꁥꁥ⁡ȁǁ΁ā끲ʁÁˁǁ끤ȁ
ʁÁ큤. ́ށǁ, 偤΁Ёȁ遥󁥁ȁ򁰁΁
ȁʁȁǁ΁򁼁. ⁤ρ <tt>copy</tt> ρɁׁ́ʁ, ΁ށށā. 
ԁƁǁ끿ށρ́ށρƁǁ. 

<a name='druby_self-contained2'>
<p><a href="druby_self-contained2.rb">druby_self-contained2.rb</a>
</a>
<table width=80%><tr><td><pre class="source">
require "numru/ggraph"
include NumRu
gp = GPhys::IO.open("T.jan.nc","T")
DCL.gropn(1)
DCL.sldiv('y',2,1)
DCL.sgpset('lcntl',false)
DCL.uzfact(0.7)
GGraph.set_fig('viewport'=>[0.15,0.75,0.2,0.8])
GGraph.contour( gp.cut('level'=>100) )
GGraph.next_fig('itr'=>2)
GGraph.contour( gp.mean(0).copy )
DCL.grcls
</pre></td></tr></table>

<a name="h3:druby_gdir_services">
<p><h3>dRuby򁻁ȁÁ遥󁥁ȁЁGDir򁻁ȁÁށʁԁ</h3><br>
</a>

<p> GPhys-0.5.0 聤ꁡ<a
href="http://ruby.gfd-dennou.org/products/gphys-remote/">
gphys-remote</a> ȁʁ́сÁȁƁȁ쁤Ɓ dRuby ́́
끥遥ց遥ꁡȁށ󁥁Ɂ΁сÁ GPhys ˁ聤ꁹށ쁤
gphys-remote ΁Ёρ<a href="#h2:gdir">GDir</a>  dRuby ΁Ձ
󁥁ȁ󁥁Ɂցȁ끤ȁǁŁŁʁŁʁ΁ǁ쁥ȁꁡāꁡ
΁򁡁󁳁ցāǁˁ끤⁤΁ǁ끡read-onlyǁ끡ˁʁ
ǁҁ<a href="#h3:irb_startup_gdir">GDir 򁻁ȁၤirb́с
ȁÁׁՁ</a>  dRuby 遥󁥁ȁȁǁ́сՁ쁤Ɓ끤΁ǁ
򁻁ȁȁǁ큡끥Ձ끥ƁˁÁց GDir 򁻁ȁ΁ȁƁ́́ˁ
ցǁˁǁ끡聤ÁƁftp ΁聤ˁ󁳁ցՁ끥Ɓ
ց遥ǁāǁ΁ρā끲ԁ끡
ʁ<a href="http://ruby.gfd-dennou.org/products/gave/"
target=_top>gave</a> gphys-remote Ёˁ܁āǁǁ.
</p><br>

<p>GPhys-remote 򁥁󁥁ȁ끤끤, ށ󁥁 gdir_server 
gdir_client 󁥁ȁ끤쁤끡ԁ GDir 󁳁ցā󁶁΁ၤ΁Ё
ׁ큥遥ǁꁡ偼ԁρԁˁ끤ၤ΁遥󁥁ȁׁ큥遥
ǁ끡ށ󁥁 gdir_client ΁Á恿ȁρÁ

<table width=80%><tr><td><pre class="source">
irb -r numru/gdir_connect_ftp-like
</pre></td></tr></table>

<p> ȁʁÁƁ끡āށꁡ"numru/gdir_connect_ftp-like"  require 
偤ǁirb 遤끤ȁ΁΁ǁ끡ā끲΁ʁ́΁ȁ
ׁՁ끤ƁɁ߁߁쁹灤ρށ󁥁Ɂ遥󁤁

<table width=80%><tr><td><pre class="source">
% <span class="command">irb -r ~/.irbrc_ggraph -r numru/gdir_connect_ftp-like</span>
</pre></td></tr></table>

<p>
ʁɁȁ끤ȁ΁Ɂ
</p><br>

<p>
쁤ǁρށЁ΁偤聤GPhys ǁہɁہсÁˁށށ쁤끥ǁ
򁻁ȁȁˁ끤΁ǁ쁤ŁȁÁׁǁ쁥ȁꁡ cd 
򁥁Ё΁끡ȁǁ쁥ȁꁡȁƁӁ΁Łˁ끡

<table width=80%><tr><td><pre class="source">
% <span class="command">cd gphys-0.5.0</span>
% <span class="command">gdir_server . -a all</span>
URI: druby://horihost:45954
[return] to exit
</pre></td></tr></table>

<p> gdir_server ΁ǁ遤΁􁡁ʁǁ "."ˁρ끡ȁǁ쁥ȁꁡ
؁āꁤǁ끡-a ǁ؁āꁤ끤΁ρ܁򁵁ہȁǁ끡ǁՁ끥ȁρ큡
끥ہȁ΁߁ǁ偤΁΁つǁρفƁ΁ہȁ遤΁򁵁΁ǁ
ށʁ-a ׁ灥󁤁ρʁցƁ؁āꁤǁ끤΁ǁ
<table width=80%><tr><td><pre class="source">
% <span class="command">gdir_server . -a '192.168.1.*' -a localhost</span>
</pre></td></tr></table>
ʁɁȁ܁ہȁ΁󁵁󁤁끤ȁ΁Ɂ큤
</p><br>

<p> 偵 gdir_server ԁ끲́΁Ɂ遡Ё URL  
druby://horihost:45954 ȁʁÁȁ.
݁ȁȁց 45954 ρƁŁˁ䁤ꁿ遤쁤݁ȁǁ끡݁ȁ䁥ہ
ȁ́́ہˁ؁āꁤ끤ˁρʁ΁聤ˁ끡

<table width=80%><tr><td><pre class="source">
% <span class="command">gdir_server . 12345</span>
% <span class="command">gdir_server . localhost:12345</span>
</pre></td></tr></table>
</p><br>

<p> 
ǁgdir_client (ށ irb -r numru/gphys_connect_ftp-like)
́сƁ΁Ёˁ܁聤.
ǁ遤ˁЁ URL ˁ́遤쁤끤΁ǁƁ΁ρ.
ȁ help ȁ쁤Ёȁ끤ǁ큤.

<table width=80%><tr><td><pre class="source">
% <span class="command">gdir_client</span>
** A GPhys service client. To conetct, type in server's URI(return)
   (format: druby://host:port). Type in help to see usage.
URI>> <span class="command">druby://horihost:45954</span>
***************************************************************
*                          WELCOME!
*
*  You logged in druby://tsudalx3:45954 
*  with /usr/local/lib/ruby/site_ruby/1.8/numru/gdir_connect_ftp-like.rb: 
*  an irb-based ftp-like client of a gphys service (such as gdir_server.rb).
*
*  This client is to be started as
*
*    % irb --noinspect -r "numru/gphys_connect_ftp-like"
*
*  if you are running on a interactive ruby shell such as irb,
*  quit and start again like this.
***************************************************************

Type in
  help
for available methods 

irb(main):001:0> <span class="command">help</span>

= irb start-up program numru/gdir_connect_ftp-like

A ftp-like client of GPhys directory services (e.g., gdir_server.rb).
Connection is based on dRuby.

== Usage
    At command line,
     % irb --noinspect -r numru/gphys_connect_ftp-like
    then type in the URI of the server.

== Available Methods
    Native methods:
      help  help_more  ls  dir  pwd  cd(path)  open(name)  readtext(name)
      start_dcl(iws=1, iwidth=500, iheight=500, uzfact=1.0)

    All GGraph methods:
      contour(gphys)  line(gphys)  etc.etc.


Type in
  help_more
For more info.
=> nil
irb(main):002:0> <span class="command">help_more</span>

== Methods
---help
    Show a help message
---help_more
    Show a further help message
---ls
    List the directory.
---dir
---ls_l
    Like ls but with a long descriptive format
---pwd
    Prints the path of the current directory.
---open(name)
    opens a GPhys, where name is a variable name in the current directory
    (shown by ls without trailing "/").
---readtext(name)
    prints the contents of the text file in the current directory
    (shown by ls with remarks as such).
---start_dcl(iws=1, iwidth=500, iheight=500, uzfact=1.0)
    To start RubyDCL (Calls DCL.gropn(iws)).
    Call this before using GGraph module functions such as contour.
---contour
---line
      GGraph methods

=> nil
irb(main):003:0> <span class="command">ls</span>
Directories:
  'bin/'
  'doc/'
  'lib/'
  'sample/'
  'test/'
  'testdata/'
Text files?:
  'ChangeLog'
  'README'
  'TODO_ep_flux'
=> nil
irb(main):004:0> <span class="command">cd 'testdata'</span>
/testdata/
=> nil
irb(main):005:0> <span class="command">ls</span>
Directories:
  'T.jan.ctl/'
  'T.jan.grib/'
  'T.jan.nc/'
  'T.jan.packed.withmiss.nc/'
=> nil
irb(main):006:0> <span class="command">cd 'T.jan.ctl/'</span>
/testdata/T.jan.ctl/
=> nil
irb(main):007:0> <span class="command">ls</span>
Data:
  'T'
=> nil
irb(main):008:0> <span class="command">gphys = open 'T'</span>
=> #<DRb::DRbObject:0x40a092ac @uri="druby://horihost:45954", @ref=541737212>
irb(main):009:0> <span class="command">start_dcl(1, 700, 700)</span>
 *** MESSAGE (SWDOPN) ***  GRPH1 : STARTED / IWS =  1.                         
=> nil
irb(main):010:0> <span class="command">contour gphys</span>
 *** WARNING (STSWTR) ***  WORKSTATION VIEWPORT WAS MODIFIED.                  
irb(main):011:0> contour gphys.mean(0)
 *** MESSAGE (SWPCLS) ***  GRPH1 : PAGE =   1 COMPLETED.                       
=> nil
=> nil
</pre></td></tr></table>

<p> 쁤ǁ΁聤ʁށɁ쁤. 큡끤ʁǁˁЁ
GDir ́́с끤΁ȁƁ聤ˁȁ끤ȁʁ끤ǁ큤
ǁ遤΁Ɂ聤ˁƁρā́쁤끤΁ρɁ聤쁤끣Á
́́ʁ΁߁΁ǁǁꁡށ΁Ɂ聤ˁƁρЁŁفˁ؁
ʁсρЁǁԁ쁤끡΁ၡ쁤ā́΁́ρ

<table><tr><td>
<p><a href='gphys-remote_sample1.png'>偤 irb Á灥󁤁΁ԁ끲(1)<br>
   <img src='gphys-remote_sample1s.png'></a>
</p><br>
</td><td>
<p><a href='gphys-remote_sample1.png'>偤 irb Á灥󁤁΁ԁ끲(2)<br>
   <img src='gphys-remote_sample2s.png'></a>
</p><br>
</td></tr></table>

ʁ遥ՁÁ΁߁āꁤ΁ʁ́΁ȁÁׁՁ끤ƁɁ߁߁
쁹灤ρށ󁥁 gdir_client ǁʁ΁Á恿ȁǁ
irb -r numru/gdir_connect_ftp-like ˁ遤 -r ׁ灥󁤁Ɓ

<table width=80%><tr><td><pre class="source">
% <span class="command">irb -r ~/.irbrc_ggraph -r numru/gdir_connect_ftp-like</span>
</pre></td></tr></table>

<p>
ʁɁȁ끤ȁ΁Ɂ
</p><br>


<a name="h3:druby_ssh_tunneling">
<p><h3>dRubý́с΁Ձ䁥끱ہ (ssh ȁ󁥁́ꁥ󁥁)</h3><br>
</a>

<p>
dRuby ρǁՁȁց恤΁݁ȁǁā́ǁ끡ƁƁȁ́恡ˁ
1000ȁցʁ偤΁݁ȁǁɁ􁤁ȁ΁ā́򁵁Ɓ끤ȁ큤ρǁ큤
΁쁹灡ssh ˁ聤끥݁ȁՁǁ󁥁ʁȁ󁥁́ꁥ󁥁ˁ򁻁ȁȁ΁Ɂ
ssh ȁ끤΁ρ󁥁ȁ끥ށ󁤁ˁЁƁǁ끡
dRuby 򁤁΁ށށȁ́ˁʁƁ́с끤΁ρ健ꁥƁ́́避
ǁʁ΁ǁ쁤ˁ큡󁥁ȁ΁끥恡ˁ򁸁
ہ΁Ɂǁ큤
</p><br>

<p>
ssh ΁݁ȁՁǁ󁥁ρ΁聤ˁԁ

<ul>

<li> 큡끥ہȁ port 12300 ȁց؁΁򁡁
󁳁ցہȁ port 12300 ȁցˁŁ끡
      
<table width=80%><tr><td><pre class="source">
% ssh -L 12300:localhost:12300 remotehost
</td></tr></table>

<li> 󁳁ցہȁ port 12300 ȁց؁΁򁡁
큡끥ہȁ port 12300 ȁցˁŁ끡
      
<table width=80%><tr><td><pre class="source">
% ssh -R 12300:localhost:12300 remotehost
</td></tr></table>

</ul>

</p><br>

<p>
݁΁Ё΁偤ȁρ΁聤ˁԁ

<ul>
  <li> localhost ΁󁥁Ɂ(ktermʁ) :
<table width=80%><tr><td><pre class="source">
localhost% <span class="command">ssh -L 12300:localhost:12300 user@remotehost</span>
Password: ********

큥󁥁ၥÁ...

remotehost% <span class="command">cd ....</span>    # Ɂʁꁤ
remotehost% <span class="command">gdir_server . localhost:12300</span>    # Ё΁偤
</td></tr></table>
</ul>

<p>
΁聤GDirЁ򁥁ꁥ⁡ȁǁ΁偤
큡끥ہȁ遥끡

<ul>
<li> localhost ΁󁥁Ɂ(ktermʁ) :

<table width=80%><tr><td><pre class="source">
localhost% <span class="command">gdir_client</span>
** A GPhys service client. To conetct, type in server's URI(return)
   (format: druby://host:port). Type in help to see usage.
URI>> <span class="command">druby://localhost:12300</span>
***************************************************************
*                          WELCOME!
*
*  You logged in druby://localhost:12300
..΁..
</td></tr></table>
</ul>

<p>
聤ˁ󁥁Ɂǁ큡끥ہȁ遱󁳁ցہȁ؁΁݁ȁՁǁ
󁥁򁳁΁΁Ɓ끤΁ǁ큡끤 12300 ȁց؁΁ā́ρ󁳁ցہȁˁŁ쁤끡
󁳁ցہȁ 12300 ȁց݁ȁǁ gdir_server ā́򁹁ԁفԁ
끤΁ǁ쁤ǁ܁ǁ끤΁ǁ끡
</p><br>


<a name="h3:druby_ssh_dual_tunneling">
<p><h4>Ձȁ󁥁́ꁥ󁥁聣ہȁЁ́ȁ󁥁́ꁥ󁥁</h4><br>

<p>
󁳁ցہȁɁ􁤁遤΁݁ȁՁǁ󁥁򁵁Ɓʁ쁹灤⁤Ɓ
끡΁쁹灡󁳁ցہȁˁƁȁ󁥁́끤򁷁쁤Ё΁Ɂ

<p> 󁥁Ɂ:
<table width=80%><tr><td><pre class="source">
remotehost% <span class="command">ssh -R 12300:localhost:12300 user@localhost</span>
Password: ********
큥󁥁ၥÁ...
</td></tr></table>

<p> 󁥁Ɂ:
<table width=80%><tr><td><pre class="source">
remotehost% <span class="command">gdir_server . localhost:12300</span>    # Ё΁偤
</td></tr></table>

<p> 󁥁Ɂ:
<table width=80%><tr><td><pre class="source">
localhost% <span class="command">gdir_client</span>
** A GPhys service client. To conetct, type in server's URI(return)
   (format: druby://host:port). Type in help to see usage.
URI>> <span class="command">druby://localhost:12300</span>
***************************************************************
*                          WELCOME!
*
*  You logged in druby://localhost:12300
..΁..
</td></tr></table>
</p><br>

<p>
⁤⁡큡끥ہȁՁ䁥Ɓ⁤ˁÁƁ큡Ё IP Ɂ쁥
򁻁ʁ쁹灡偵 ssh -R 12300:localhost:12300 user@localhost 
ԁʁ΁쁹灡󁥁ȁꁥ큡Ё끤ʁɁ쁥΁聣΁
ȁ򁷁Ё́끤ȁꁤ끡

<p> 󁥁Ɂ:
<table width=80%><tr><td><pre class="source">
remotehost% <span class="command">ssh -R 12300:localhost:12300 user@thirdhost</span>
Password: ********
큥󁥁ၥÁ...
</td></tr></table>

<p> 󁥁Ɂ:
<table width=80%><tr><td><pre class="source">
localhost% <span class="command">ssh -L 12300:localhost:12300 user@thirdhost</span>
Password: ********
큥󁥁ၥÁ...
</td></tr></table>

<p> 󁥁Ɂ:
<table width=80%><tr><td><pre class="source">
remotehost% <span class="command">gdir_server . localhost:12300</span>    # Ё΁偤
</td></tr></table>

<p> 󁥁Ɂ:
<table width=80%><tr><td><pre class="source">
localhost% <span class="command">gdir_client</span>
** A GPhys service client. To conetct, type in server's URI(return)
   (format: druby://host:port). Type in help to see usage.
URI>> <span class="command">druby://localhost:12300</span>
***************************************************************
*                          WELCOME!
*
*  You logged in druby://localhost:12300
..΁..
</td></tr></table>

<a name="h3:dRuby-chuui">
<p><h3>dRuby ́́сˁ؁Á큰</h3><br>
</a>

<p> dRuby ǁρ󁳁ցׁ큥ˁɁׁ́ʁցȁ Ruby ΁߁(GC)
ˁ󁼁쁤Ɓށ聤ЁɁׁ́ǁ끡gdir_server ǁρdRuby ɁՁ
 TimerIdConv ȁ⁤΁́сƁ20ʁցρ󁼁쁤ʁ聤ˁ߁āꁤ
끡ՁˁЁ20ʁÁցȁρЁǁ߁ȁƁ󁼁
쁤Ɓށǁʁȁāǁ끡́Łˁρ΁ցρ
灥󁤁ǁ؁āꁤǁ끤聤ˁ
</p><br>

<p>
dRuby Ё΁健ꁥƁρʁ݁ځ.
Ёρȁ́ˁفǁρʁ
ށЁρ΁偤Áʁˁ, Ł΁聤.
</p><br>

<p>
dRuby ρǁŁ򁹁ԁȁ, Marshal ȁ Ruby ΁ȁ߁߁遥ց遥ꁡ
ˁ聤Á, ցȁ򁥁Ёȁ΁󁤁ˁʁс. Marshal ΁ՁށÁȁ
Ruby 1.6  Ruby 1.8 ǁʁс쁤΁, āǁʁ, 
ā́ 1.6 Ɓցށ 1.8 Ɓցˁ遤쁤. 
</p><br>

<p> gdir_server ǁρ߁ρՁ끤ƁɁ߁ށ쁤 NArray 
ǁρفƁ́ÁȁŁ΁Ё݁ȁʁ끡쁤ˁЁ
ف쁹灡āŁفˁʁ끤ށǁρЁ
Ёʁ聤ʁ߁āꁤˁ끤ȁ́ǁ끡gdir_server ˁ
NArray ΁ၥÁɁāꁵ΁Ձꁤ򁡁΁聤ˁ񁤁끤ȁ
ǁā40000āʁЁȁǁʁā􁡁ˁʁ偤΁ǁρŁ쁤ʁʁ
΁ǁЁˁ΁ށ끤聤ˁʁ끡

<p>
<table width=80%><tr><td><pre class="source">
class NArray
  DUMP_SIZE_LIMIT = 40000
  def self._load(o) to_na(*Marshal::load(o)).ntoh end
  def _dump(limit) 
    if size <= DUMP_SIZE_LIMIT
      Marshal::dump([hton.to_s, typecode, *shape]) 
    else
      raise "size of the NArray (#{size}) is too large to dump "+
            "(limit: #{DUMP_SIZE_LIMIT})"
    end
  end
end
</pre></td></tr></table>


<a name="h3:cgi-rdbms">
<p><h3>CGIȁꁥ쁡灥ʁ끥ǁف</h3><br>
</a>

<p> <b>ԁ -- ˁ܁ʁρ偺΁́āꁤǁ</b>

<p> <a href="http://www.rubyonrails.com/">Ruby on Rails</a>򁻁ȁȁ
ǁفȁρȁāǁʁǁā󁶁Ё򁺁끤ȁǁށ
ށ΁つ򁽁Ёʁ΁ǁށ΁ʁρ߁ށ󁤁΁ρǁꁤށ
Ruby on Rails ρȁ󁾁ˁ΁ɁǁƁƁȁ䁤ǁ
</p><br>


<hr>

<p>Copyright (C) 2003 GFD Dennou Club. All Rights Reserved.<p>

</body>
</html>
